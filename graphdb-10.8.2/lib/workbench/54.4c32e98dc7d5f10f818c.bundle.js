(window.webpackJsonp=window.webpackJsonp||[]).push([[54,79,105,272,273,274],{110:function(t,e,s){"use strict";s.r(e),s.d(e,"ChatModel",(function(){return h})),s.d(e,"ChatByDayModel",(function(){return n})),s.d(e,"ChatsListModel",(function(){return r}));var a=s(95),i=s(20);class h{static getEmptyChat(){const t={name:"· · ·",timestamp:Math.floor(Date.now()/1e3)};return new h(t,Object(i.md5HashGenerator)())}constructor(t,e){this.hashGenerator=e,this._id=t.id,this._name=t.name,this._timestamp=t.timestamp,this._chatHistory=t.chatHistory||new a.ChatItemsListModel,this.hash=this.generateHash()}generateHash(){return this.hashGenerator(JSON.stringify(this))}get id(){return this._id}set id(t){this._id=t}get name(){return this._name}set name(t){this.generateHash(),this._name=t}get timestamp(){return this._timestamp}set timestamp(t){this._timestamp=t}get chatHistory(){return this._chatHistory}set chatHistory(t){this._chatHistory=t||new a.ChatItemsListModel}toRenameRequestPayload(){return{name:this._name}}}class n{constructor(t){this._day=t.day,this._timestamp=t.timestamp,this._chats=t.chats}get day(){return this._day}set day(t){this._day=t}get timestamp(){return this._timestamp}set timestamp(t){this._timestamp=t}get chats(){return this._chats}set chats(t){this._chats=t}}class r{constructor(t){this._chats=t||[],this._chatsByDay=[],this.sortByTime(),this.updateChatsByDay()}sortByTime(){this._chats.sort((t,e)=>e.timestamp-t.timestamp)}updateChatTimestamp(t,e){const s=this._chats.find(e=>e.id===t);s&&(s.timestamp=e,this.sortByTime(),this.updateChatsByDay())}updateChatName(t,e){const s=this._chats.find(e=>e.id===t);s&&(s.name=e)}deleteChat(t){this._chats=this._chats.filter(e=>e.id!==t.id),this.sortByTime(),this.updateChatsByDay()}updateChatsByDay(){this._chatsByDay=[],this._chats.forEach(t=>{const e=new Date(1e3*t.timestamp).toDateString(),s=this._chatsByDay.find(t=>t.day===e);s?s.chats.push(t):this._chatsByDay.push(new n({day:e,timestamp:1e3*t.timestamp,chats:[t]}))})}appendChat(t){this._chats.push(t),this.sortByTime(),this.updateChatsByDay()}replaceChat(t,e){this._chats=this._chats.map(s=>s.id===e.id?t:s),this.sortByTime(),this.updateChatsByDay()}isEmpty(){return 0===this._chats.length}getFirstChat(){return this._chats[0]}deselectAll(){this._chats.forEach(t=>{t.selected=!1})}selectChat(t){this.deselectAll(),this._chats.forEach(e=>{e.selected=e.id===t.id})}getChat(t){return this._chats.find(e=>e.id===t)}getNonPersistedChat(){return this._chats.find(t=>!t.id)}renameChat(t){const e=this._chats.find(e=>e.id===t.id);e&&(e.name=t.name)}get chats(){return this._chats}set chats(t){this._chats=t}get chatsByDay(){return this._chatsByDay}set chatsByDay(t){this._chatsByDay=t}}},131:function(t,e,s){"use strict";s.r(e),s.d(e,"ExplainResponseModel",(function(){return a})),s.d(e,"ExplainQueryMethodsListModel",(function(){return i})),s.d(e,"ExplainQueryMethodModel",(function(){return h})),s.d(e,"ExplainQueryType",(function(){return n}));class a{constructor(t={}){this._chatId=t.chatId,this._answerId=t.answerId,this._queryMethods=t.queryMethods,this._expanded=void 0===t.expanded||t.expanded}get chatId(){return this._chatId}set chatId(t){this._chatId=t}get answerId(){return this._answerId}set answerId(t){this._answerId=t}get queryMethods(){return this._queryMethods}set queryMethods(t){this._queryMethods=t}get expanded(){return this._expanded}set expanded(t){this._expanded=t}}class i{constructor(t=[]){this._items=t}get items(){return this._items}set items(t){this._items=t}}class h{constructor(t={}){this._name=t.name,this._rawQuery=t.rawQuery,this._query=t.query,this._queryType=t.queryType,this._errorMessage=t.errorOutput}get name(){return this._name}set name(t){this._name=t}get rawQuery(){return this._rawQuery}set rawQuery(t){this._rawQuery=t}get query(){return this._query}set query(t){this._query=t}get queryType(){return this._queryType}set queryType(t){this._queryType=t}get errorMessage(){return this._errorMessage}set errorMessage(t){this._errorMessage=t}}const n={SPARQL:"sparql",JSON:"json",OTHER:"other"}},199:function(t,e,s){"use strict";s.r(e);s(209);var a=s(87),i=s(88),h=s(95),n=s(18),r=s(0),c=s(110);function o(t,e,s){return{restrict:"E",templateUrl:"js/angular/ttyg/templates/chat-panel.html",link:(t,o,d)=>{t.chat=void 0,t.selectedAgent=void 0,t.chatItem=void 0,t.askingChatItem=void 0,t.waitingForLastMessage=!1,t.loadingChat=!0,t.ask=()=>{t.chatItem.question.timestamp=Date.now(),t.askingChatItem=Object(n.cloneDeep)(t.chatItem),t.chatItem.chatId?m(t.chatItem):u(),t.chatItem=_(),p(),y()},t.regenerateQuestion=e=>{const s=_();s.setQuestionMessage(e.getQuestionMessage()),s.question.timestamp=Date.now(),t.askingChatItem=s,m(s),p()},t.onKeypressOnInput=e=>{"Enter"!==e.key||e.shiftKey||e.ctrlKey||t.ask()},t.onAskHowDeliveredAnswer=()=>{const s=_();s.setQuestionMessage(e.instant("ttyg.chat_panel.btn.derive_answer.label")),s.question.timestamp=Date.now(),t.askingChatItem=Object(n.cloneDeep)(s),m(s),p()},t.getAgentName=t=>{const a=s.getAgent(t);return a?a.name:Object(r.decodeHTML)(e.instant("ttyg.chat_panel.deleted_agent"))};const u=()=>{t.waitingForLastMessage=!0,s.emit(a.TTYGEventName.CREATE_CHAT,t.chatItem)},m=e=>{t.waitingForLastMessage=!0,s.emit(a.TTYGEventName.ASK_QUESTION,e)},g=()=>{t.chatItem=Object(n.cloneDeep)(t.askingChatItem),t.askingChatItem=void 0,t.waitingForLastMessage=!1},_=()=>{const e=new h.ChatItemModel;return e.question=new i.ChatMessageModel({role:i.CHAT_MESSAGE_ROLE.USER}),t.chat&&(e.chatId=t.chat.id),t.selectedAgent&&(e.agentId=t.selectedAgent.id),e},y=()=>{const t=o.find(".question-input");t.length&&t[0].focus()},p=()=>{setTimeout(()=>{const t=o.find(".chat-details")[0];t&&(t.scrollTop=t.scrollHeight)})},l=()=>{t.chat=c.ChatModel.getEmptyChat(),t.loadingChat=!1,t.chatItem=_(),t.askingChatItem=void 0,t.waitingForLastMessage=!1,y()},I=[];I.push(t.$watchCollection("chat.chatHistory.items",p)),I.push(s.onSelectedChatUpdated(e=>{if(t.chat=e,e&&(e.id||!t.askingChatItem)){if(t.loadingChat=!1,t.chatItem=_(),t.askingChatItem=void 0,t.chat){const e=t.chat.chatHistory.getLast();e&&e.agentId&&s.selectAgent(s.getAgent(e.agentId))}y()}})),I.push(s.onLastMessageReceived(()=>{t.waitingForLastMessage=!1})),I.push(s.onSelectedAgentChanged(e=>{t.selectedAgent=e,t.selectedAgent&&t.chatItem&&(t.chatItem.agentId=t.selectedAgent.id)})),I.push(s.onSelectedChatChanged(e=>{e?(t.loadingChat=e&&e.id,t.chatItem=_(),y()):l()})),I.push(s.subscribe(a.TTYGEventName.LOAD_CHAT_FAILURE,()=>{t.loadingChat=!1,t.chatItem=_(),y()})),I.push(s.subscribe(a.TTYGEventName.ASK_QUESTION_FAILURE,g)),I.push(s.subscribe(a.TTYGEventName.CREATE_CHAT_FAILURE,g)),I.push(s.subscribe(a.TTYGEventName.DELETE_CHAT_SUCCESSFUL,e=>{t.chat&&e.id===t.chat.id&&l()})),t.$on("$destroy",()=>{I.forEach(t=>t())}),t.chat=c.ChatModel.getEmptyChat(),t.chatItem=_(),y()}}}angular.module("graphdb.framework.ttyg.directives.chat-panel",["graphdb.framework.ttyg.directives.chat-item-detail"]).directive("chatPanel",o),o.$inject=["toastr","$translate","TTYGContextService"]},88:function(t,e,s){"use strict";s.r(e),s.d(e,"ChatMessageModel",(function(){return a})),s.d(e,"CHAT_MESSAGE_ROLE",(function(){return i}));class a{constructor(t){this._id=t.id,this._role=t.role,this._message=t.message,this._timestamp=1e3*t.timestamp}get id(){return this._id}set id(t){this._id=t}get role(){return this._role}set role(t){this._role=t}get message(){return this._message}set message(t){this._message=t}get timestamp(){return this._timestamp}set timestamp(t){this._timestamp=t}}const i={USER:"user",ASSISTANT:"assistant"}},95:function(t,e,s){"use strict";s.r(e),s.d(e,"ChatItemModel",(function(){return i})),s.d(e,"ChatItemsListModel",(function(){return h}));var a=s(88);class i{constructor(t,e){this._chatId=t,this._agentId=void 0,this._question=e,this._answers=[]}get chatId(){return this._chatId}set chatId(t){this._chatId=t}get agentId(){return this._agentId}set agentId(t){this._agentId=t}get question(){return this._question}set question(t){this._question=t}get answers(){return this._answers}set answers(t){this._answers=t}setQuestionMessage(t){this._question||(this._question=new a.ChatMessageModel({role:a.CHAT_MESSAGE_ROLE.USER})),this._question.message=t}getQuestionMessage(){return this._question.message}toCreateChatRequestPayload(){return{agentId:this._agentId,question:this._question.message}}toAskRequestPayload(){return{conversationId:this._chatId,agentId:this._agentId,question:this._question.message,tzOffset:-(new Date).getTimezoneOffset()}}toExplainResponsePayload(t){return{conversationId:this._chatId,answerId:t}}}class h{constructor(t=[]){this._items=t}isEmpty(){return 0===this._items.length}appendItem(t){this._items.push(t)}get items(){return this._items}set items(t){this._items=t||[]}getLast(){if(!this.isEmpty())return this._items[this._items.length-1]}}}}]);