(window.webpackJsonp=window.webpackJsonp||[]).push([[16,87,133,134,136,138,139,293],{108:function(e,t,r){"use strict";r.r(t),r.d(t,"UPDATE_CLUSTER",(function(){return n})),r.d(t,"DELETE_CLUSTER",(function(){return o})),r.d(t,"CLICK_IN_VIEW",(function(){return s})),r.d(t,"NODE_SELECTED",(function(){return a})),r.d(t,"CREATE_CLUSTER",(function(){return i})),r.d(t,"MODEL_UPDATED",(function(){return l}));const n="updateCluster",o="deleteCluster",s="clickInView",a="nodeSelected",i="createCluster",l="modelUpdated"},113:function(e,t){angular.module("graphdb.framework.rest.cluster.service",[]).factory("ClusterRestService",r),r.$inject=["$http"];function r(e){return{getClusterConfig:function(){return e.get("rest/cluster/config")},createCluster:function(t){return e.post("rest/cluster/httpConfig",t)},updateClusterConfiguration:function(t){t.nodes&&delete t.nodes;return e.patch("rest/cluster/config",t)},deleteCluster:function(t){const r=$.param({force:t});return e.delete("rest/cluster/config?"+r)},replaceNodesInCluster:function(t){return e.patch("rest/cluster/httpConfig",t)},getClusterStatus:function(){return e.get("rest/cluster/group/status")},getNodeStatus:function(){return e.get("rest/cluster/node/status")},addCusterTag:function(t){return e.post("rest/cluster/config/tag",t)},deleteClusterTag:function(t){return e({method:"DELETE",url:"rest/cluster/config/tag",data:{tag:t},headers:{"Content-type":"application/json;charset=utf-8"}})},disableSecondaryMode:function(){return e.delete("rest/cluster/config/secondary-mode")},enableSecondaryMode:function(t){return e.post("rest/cluster/config/secondary-mode",t)}}}},217:function(e,t,r){"use strict";r.r(t);r(50);function n(e,t,r,n,o){return{addLocationHttp:function(e){let r;return n.addLocation(e).catch(e=>{const r=getError(e.data,e.status);return t.error(r,o.instant("common.error")),!1}).then(e=>!!e&&s()).then(t=>{if(!1!==t)return r=t.find(t=>t.endpoint===e.uri),r})},getLocationsWithRpcAddresses:s,createNewLocation:function(e){return{uri:e,authType:"signature",username:"",password:"",active:!1,clusterMode:!0,isLocal:!1}},isInCluster:function(e,t){return e.some(e=>t.rpcAddress===e.address)}};function s(){return n.getLocations().then((function(e){return e.data.map(e=>({isLocal:e.local,endpoint:e.uri,rpcAddress:e.rpcAddress||"",error:e.errorMsg}))})).catch((function(e){const r=getError(e.data,e.status);t.error(r,o.instant("common.error"))})).then(e=>{if(e)return function(e){const t=e.filter(e=>!e.isLocal&&!e.error).map(e=>function(e){return n.getLocationRpcAddress(e.endpoint)}(e).then(t=>(e.rpcAddress=t.data,e.isAvailable=!0,e)).catch(t=>{e.isAvailable=!1,e.error=getError(t.data,t.status)}));return Promise.allSettled(t).then(()=>e)}(e)})}}angular.module("graphdb.framework.clustermanagement.services.remote-locations",[]).factory("RemoteLocationsService",n),n.$inject=["$http","toastr","$uibModal","LocationsRestService","$translate"]},218:function(e,t){function r(e){let t,r=!1;function n(){return r}function o(t){r=t,e.emit("showClusterConfigurationPanel",n())}function s(){return t}return{updateClusterViewD3Container:function(r){t=r,e.emit("clusterViewD3ContainerChanged",s())},getClusterViewD3Container:s,onClusterViewD3ContainerUpdated:function(t){return e.subscribe("clusterViewD3ContainerChanged",()=>t(s()))},getShowClusterConfigurationPanel:n,setShowClusterConfigurationPanel:o,showClusterConfigurationPanel:function(){o(!0)},hideClusterConfigurationPanel:function(){o(!1)},onShowClusterConfigurationPanel:function(t){return e.subscribe("showClusterConfigurationPanel",()=>t(n()))}}}angular.module("graphdb.framework.clustermanagement.services.cluster-view-context-service",[]).factory("ClusterViewContextService",r),r.$inject=["EventEmitterService"]},219:function(e,t,r){"use strict";r.r(t);r(113);function n(e,t,r,n,o,s,a){e.pageTitle=s.instant("cluster_management.cluster_page.edit_page_title"),e.errors=[],e.clusterConfiguration=_.cloneDeep(a.clusterConfiguration),e.loader=!1,e.configFields=[{id:"election-minimum-timeout",name:"electionMinTimeout",label:"cluster_management.cluster_configuration_properties.election_min_timeout",tooltip:"cluster_management.cluster_configuration_properties.election_min_timeout_tooltip",errorMsg:"cluster_management.cluster_page.errors.only_positive_integers"},{id:"election-range-timeout",name:"electionRangeTimeout",label:"cluster_management.cluster_configuration_properties.election_range_timeout",tooltip:"cluster_management.cluster_configuration_properties.election_range_timeout_tooltip",errorMsg:"cluster_management.cluster_page.errors.only_positive_integers"},{id:"heartbeat-interval",name:"heartbeatInterval",label:"cluster_management.cluster_configuration_properties.heartbeat_interval",tooltip:"cluster_management.cluster_configuration_properties.heartbeat_interval_tooltip",errorMsg:"cluster_management.cluster_page.errors.only_positive_integers"},{id:"message-size",name:"messageSizeKB",label:"cluster_management.cluster_configuration_properties.message_size_kb",tooltip:"cluster_management.cluster_configuration_properties.message_size_kb_tooltip",errorMsg:"cluster_management.cluster_page.errors.only_positive_integers"},{id:"verification-timeout",name:"verificationTimeout",label:"cluster_management.cluster_configuration_properties.verification_timeout",tooltip:"cluster_management.cluster_configuration_properties.verification_timeout_tooltip",errorMsg:"cluster_management.cluster_page.errors.only_positive_integers"},{id:"transaction-log-max-size",name:"transactionLogMaximumSizeGB",label:"cluster_management.cluster_configuration_properties.transaction_log_maximum_size_gb",tooltip:"cluster_management.cluster_configuration_properties.transaction_log_maximum_size_gb_tooltip",pattern:"-?[1-9][0-9]*(\\.[0-9]+)?",errorMsg:"cluster_management.cluster_page.errors.small_transaction_log_max_size"},{id:"batch-update-interval",name:"batchUpdateInterval",label:"cluster_management.cluster_configuration_properties.batch_update_interval",tooltip:"cluster_management.cluster_configuration_properties.batch_update_interval_tooltip",errorMsg:"cluster_management.cluster_page.errors.only_positive_integers"}],e.updateClusterConfiguration=()=>(e.setLoader(!0,s.instant("cluster_management.cluster_page.updating_cluster_loader")),n.updateClusterConfiguration(e.clusterConfiguration).then(()=>{o.success(s.instant("cluster_management.cluster_page.notifications.update_success")),t.close()}).catch((function(e){i(e.data,e.status)})).finally(()=>e.setLoader(!1))),e.isClusterConfigurationValid=()=>!e.clusterConfigurationForm.$invalid,e.setLoader=(t,n)=>{r.cancel(e.loaderTimeout),t?e.loaderTimeout=r(()=>{e.loader=t,e.loaderMessage=n},300):e.loader=!1},e.ok=()=>{e.isClusterConfigurationValid()?e.updateClusterConfiguration():o.warning(s.instant("cluster_management.cluster_page.notifications.form_invalid"))},e.cancel=()=>{t.dismiss("cancel")},e.onClick=e=>{e.stopPropagation()};const i=(t,r)=>{delete e.preconditionErrors,o.error(s.instant("cluster_management.cluster_page.notifications.update_failed")),e.errors.splice(0),409===r||"string"==typeof t?e.errors.push(t):412===r?e.preconditionErrors=Object.keys(t).map(e=>`${e} - ${t[e]}`):400===r&&e.errors.push(...t)}}angular.module("graphdb.framework.clustermanagement.controllers.edit-cluster",[]).controller("EditClusterCtrl",n),n.$inject=["$scope","$uibModalInstance","$timeout","ClusterRestService","toastr","$translate","data"]},220:function(e,t){function r(e,t){e.forceDelete=!1,e.ok=()=>{t.close(e.forceDelete)},e.cancel=()=>{t.dismiss("cancel")},e.onClick=e=>{e.stopPropagation()}}angular.module("graphdb.framework.clustermanagement.controllers.delete-cluster",[]).controller("DeleteClusterCtrl",r),r.$inject=["$scope","$uibModalInstance"]},221:function(e,t,r){"use strict";r.r(t);r(222);var n=r(18);function o(e,t,r,o,s,a){const i=[];e.isValid=s.isValid(),e.ok=()=>{const e=s.getClusterView();e.hasCluster()?t.close(Object(n.cloneDeep)(e.getUpdateActions())):t.close(Object(n.cloneDeep)(e.getUpdateActions().clusterConfiguration))},e.cancel=()=>{e.isChanged?a.openSimpleModal({title:r.instant("common.warning"),message:r.instant("page.leave.pristine.warning"),warning:!0}).result.then(()=>{t.dismiss("cancel")}):t.dismiss("cancel")};const l=()=>{i.forEach(e=>e())};i.push(s.onClusterValidityChanged(t=>{e.isValid=t})),i.push(s.onClusterViewChanged(()=>{if(!e.hasCluster&&0===s.getAttached().length){const e=s.getLocalNode();s.addLocation(e)}e.isChanged=s.isChanged()})),e.$on("$destroy",()=>{l(),s.setClusterView(void 0)}),s.setClusterView(o.clusterModel),e.hasCluster=o.clusterModel.hasCluster}angular.module("graphdb.framework.clustermanagement.controllers.edit-cluster-nodes-modal",["graphdb.framework.clustermanagement.services.cluster-context"]).controller("EditClusterNodesModalController",o),o.$inject=["$scope","$uibModalInstance","$translate","data","ClusterContextService","ModalService"]},316:function(e,t,r){"use strict";r.r(t);r(113),r(217),r(218),r(219),r(220),r(221);var n=r(18),o=r(97),s=r(108);function a(e,t,r,a,i,l,c,u,d,g,m,p,f,_,C,h,v,w){let S;const b=[];e.loader=!0,e.isLeader=!1,e.currentNode=null,e.clusterModel={},e.NodeState=o.NodeState,e.leaderChanged=!1,e.currentLeader=null,e.showClusterConfigurationPanel=!1,e.clusterConfigurationPanelSize=void 0,e.onopen=()=>angular.noop(),e.onclose=()=>{w.hideClusterConfigurationPanel()},e.isAdmin=()=>u.isAuthenticated()&&u.isAdmin(),e.openClusterConfigurationPanel=()=>{e.showClusterConfigurationPanel=!0,w.showClusterConfigurationPanel()},e.setLoader=(t,r)=>{p.cancel(e.loaderTimeout),t?(e.loaderMessage=r,e.loaderTimeout=p(()=>{e.loader=t},50)):e.loader=!1},e.getLoaderMessage=()=>e.loaderMessage||C.instant("common.loading"),e.showUpdateClusterGroupDialog=()=>{e.setLoader(!0),k().then(()=>(e.setLoader(!1),l.open({templateUrl:"js/angular/clustermanagement/templates/modal/edit-cluster-nodes-modal.html",controller:"EditClusterNodesModalController",size:"lg",backdrop:"static",keyboard:!1,resolve:{data:()=>({clusterModel:e.clusterModel})}}).result)).then(e=>{e.addNodes||e.removeNodes?E(e):$(e)}).catch(()=>{e.setLoader(!1),y(!0)}).finally(()=>{k()})},e.getClusterConfiguration=()=>f.getClusterConfig().then(t=>{if(e.clusterConfiguration=t.data,!e.currentNode)return e.getCurrentNodeStatus()}).catch(()=>{e.clusterConfiguration=null}),e.getClusterStatus=()=>f.getClusterStatus().then(t=>{const r=t.data.slice(),n=r.find(e=>e.nodeState===o.NodeState.LEADER);M(e.currentLeader,n)&&(e.currentLeader=n,e.leaderChanged=!0),e.currentNode=r.find(t=>e.currentNode&&t.address===e.currentNode.address);const s=L(n,r);e.clusterModel.hasCluster=!0,e.clusterModel.nodes=r,e.clusterModel.links=s}).catch(t=>{if(404===t.status)return e.clusterModel.hasCluster=!1,e.clusterModel.nodes=[],e.clusterModel.links=[],e.clusterConfiguration=null,Promise.reject(t)}),e.getCurrentNodeStatus=()=>f.getNodeStatus().then(t=>{e.leaderChanged=!1,e.currentNode=t.data}).catch(t=>{e.currentNode=t.data,e.clusterModel.hasCluster=!1}).then(()=>k());const $=t=>(e.setLoader(!0,C.instant("cluster_management.cluster_page.creating_cluster_loader")),f.createCluster(t).then(()=>{a.success(C.instant("cluster_management.cluster_page.notifications.create_success"))}).catch(e=>{D(e.data,e.status)}).finally(()=>{e.setLoader(!1)})),E=t=>{const r=C.instant("cluster_management.cluster_page.updating_cluster_loader");e.setLoader(!0,r);const n={addNodes:t.addNodes,removeNodes:t.removeNodes};f.replaceNodesInCluster(n).then(()=>{const e=C.instant("cluster_management.cluster_page.notifications.update_success");T(e)}).catch(e=>{const t=C.instant("cluster_management.cluster_page.notifications.update_failed");D(e.data,e.status,t)}).finally(()=>{e.setLoader(!1),y(!0)})},L=(e,t)=>{const r=[];return e&&Object.keys(e.syncStatus).forEach(n=>{const s=e.syncStatus[n];if(s!==o.LinkState.NO_CONNECTION&&(r.push({id:`${e.address}-${n}`,source:e.address,target:n,status:s}),s===o.LinkState.OUT_OF_SYNC)){const e=t.find(e=>e.address===n);let s;if(e.recoveryStatus.state===o.RecoveryState.RECEIVING_SNAPSHOT&&(s=e.recoveryStatus.affectedNodes[0]),e&&s){const n=t.find(e=>e.endpoint===s);r.push({id:`${e.address}-${n.address}`,source:n.address,target:e.address,status:o.LinkState.RECEIVING_SNAPSHOT})}}}),r},N=t=>{e.selectedNode!==t?e.selectedNode=t:e.selectedNode=null,e.$apply()},y=t=>{S||(S=e.getClusterStatus().then(()=>{if(t||!e.clusterConfiguration)return e.getClusterConfiguration()}).then(()=>{if(!e.currentNode||e.leaderChanged)return e.getCurrentNodeStatus()}).finally(()=>{S=null,e.$broadcast(s.MODEL_UPDATED)}))},M=(e,t)=>!t||(!e||e.address!==t.address),k=()=>h.getLocationsWithRpcAddresses().then(t=>{const r=t.find(e=>e.isLocal);r&&(r.endpoint=e.currentNode.endpoint,r.rpcAddress=e.currentNode.address),e.clusterModel.locations=t}),T=t=>{a.success(t),e.getClusterConfiguration()},D=(e,t,r)=>{let o=e.message||e;400===t&&Array.isArray(e)?o=e.reduce((e,t)=>e+`<div>${t}</div>`,""):412!==t||Object(n.isString)(e)||(o=Object.keys(e).reduce((t,r)=>t+`<div>${r} - ${e[r]}</div>`,"")),a.error(o,r,{allowHtml:!0})},A=()=>{e.clusterConfigurationPanelSize=.25*window.innerWidth+"px"},P=()=>{b.push(w.onShowClusterConfigurationPanel(t=>{A(),e.showClusterConfigurationPanel=t})),b.push(e.$on(s.UPDATE_CLUSTER,(e,t)=>{y(t.force)})),b.push(e.$on(s.DELETE_CLUSTER,(t,r)=>{(t=>{const r=C.instant("cluster_management.delete_cluster_dialog.loader_message");e.setLoader(!0,r),f.deleteCluster(t).then(t=>{if(Object.values(t.data).every(e=>"Cluster was deleted on this node."===e)){const e=C.instant("cluster_management.delete_cluster_dialog.notifications.success_delete");a.success(e)}else{const e=C.instant("cluster_management.delete_cluster_dialog.notifications.success_delete_partial"),r=Object.keys(t.data).reduce((e,r)=>e+`<div>${r} - ${t.data[r]}</div>`,"");a.warning(r,e,{allowHtml:!0})}e.getClusterConfiguration()}).catch(e=>{const t=C.instant("cluster_management.delete_cluster_dialog.notifications.fail_delete");D(e.data,e.status,t)}).finally(()=>{e.setLoader(!1),y(!0),v.$broadcast("reloadLocations")})})(r.force)})),b.push(e.$on(s.CLICK_IN_VIEW,(t,r)=>{!function(t){const r=document.getElementById("nodeTooltip");e.selectedNode&&r!==t&&!r.contains(t)&&N(null)}(r)})),b.push(e.$on(s.NODE_SELECTED,(e,t)=>{N(t)})),b.push(e.$on(s.CREATE_CLUSTER,()=>{e.showUpdateClusterGroupDialog()}))};e.$on("$destroy",(function(){b.forEach(e=>e())}));P(),A(),e.showClusterConfigurationPanel=w.getShowClusterConfigurationPanel(),(e.loader=!0,e.getCurrentNodeStatus().then(()=>e.getClusterConfiguration()).then(()=>e.getClusterStatus()).finally(()=>{e.setLoader(!1)})).finally(()=>{const t=g((function(){y()}),1e3);e.$on("$destroy",(function(){g.cancel(t)}))})}angular.module("graphdb.framework.clustermanagement.controllers.cluster-management",["ui.bootstrap","graphdb.framework.core.services.repositories","graphdb.framework.rest.repositories.service","graphdb.framework.rest.cluster.service","graphdb.framework.clustermanagement.services.cluster-view-context-service","graphdb.framework.clustermanagement.services.remote-locations","graphdb.framework.clustermanagement.controllers.edit-cluster","graphdb.framework.clustermanagement.controllers.delete-cluster","graphdb.framework.clustermanagement.controllers.edit-cluster-nodes-modal","toastr","pageslide-directive"]).controller("ClusterManagementCtrl",a),a.$inject=["$scope","$http","$q","toastr","$repositories","$uibModal","$sce","$jwtAuth","$window","$interval","ModalService","$timeout","ClusterRestService","$location","$translate","RemoteLocationsService","$rootScope","ClusterViewContextService"]}}]);