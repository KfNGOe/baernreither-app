(window.webpackJsonp=window.webpackJsonp||[]).push([[44,197,222,265,329],{100:function(e,t,n){"use strict";n.r(t),n.d(t,"removeSpecialChars",(function(){return o})),n.d(t,"toBoolean",(function(){return a})),n.d(t,"toTitleCase",(function(){return s}));var r=n(18);const o=e=>e.replace(/[()']/g,""),a=e=>"string"==typeof e?"true"===e:Boolean(e),s=e=>e?Object(r.upperFirst)(e.toLowerCase()):e},183:function(e,t,n){"use strict";n.r(t),n.d(t,"ConnectorCommand",(function(){return r}));const r={CREATE:"create",REPAIR:"repair",DROP:"drop"}},190:function(e,t,n){"use strict";n.r(t),n.d(t,"BeforeUpdateQueryResult",(function(){return r})),n.d(t,"BeforeUpdateQueryResultStatus",(function(){return o}));class r{constructor(e,t,n,r){this.status=e,this.mesage=r,this.messageLabelKey=t,this.parameters=n}}const o={ERROR:"error",SUCCESS:"success"}},193:function(e,t,n){"use strict";n.r(t),n.d(t,"CancelAbortingQuery",(function(){return r}));class r extends Error{}},311:function(e,t,n){"use strict";n.r(t);var r=n(149),o=n(128),a=(n(99),n(207),n(19)),s=n(129),i=n(183),u=n(190),c=n(119),d=n(0),l=n(100),p=n(130),g=n(193),m=n(16);n(22);function y(e,t,n,y,f,h,C,S,R,v,E,b,w,q,A,Q,U,T){this.repository="";let O=C.getActiveRepository(),P=C.isActiveRepoOntopType();t.yasguiConfig=void 0,t.savedQueryConfig=void 0,t.prefixes={},t.inferUserSetting=!0,t.sameAsUserSetting=!0;const x=new Map;let L=!1;t.updateConfig=e=>{t.yasguiConfig={endpoint:_,componentId:p.VIEW_SPARQL_EDITOR,prefixes:t.prefixes,infer:P||t.inferUserSetting,sameAs:P||t.sameAsUserSetting,yasrToolbarPlugins:[H],beforeUpdateQuery:K(),outputHandlers:new Map([[c.EventDataType.QUERY_EXECUTED,B],[c.EventDataType.REQUEST_ABORTED,D]]),clearState:void 0!==e&&e}},t.getActiveRepositoryNoError=()=>O;const _=e=>{const t=(e=>{const t=e.getTab();if(t)return t.getYasqe()})(e);if(t)return C.resolveSparqlEndpoint(t.getQueryMode())},B=e=>{const t=x.get(e.tabId);t&&(t.dismiss(),x.delete(e.tabId))},D=e=>{if(e&&m.QueryMode.UPDATE!==e.queryMode){const t=e.getRepository(),n=e.getQueryTrackAlias();t&&n&&A.deleteQuery(n,t)}},M=e=>{const t=e[o.RouteConstants.savedQueryName],n=e[o.RouteConstants.savedQueryOwner];E.getSavedQuery(t,n).then(e=>{const t=Object(r.savedQueryResponseMapper)(e);k(t).then(j).finally(N)}).catch(e=>{R.error(v.instant("query.editor.missing.saved.query.data.error",{savedQueryName:t,error:getError(e)}))})},$=e=>{const t=e[o.RouteConstants.name],n=e[o.RouteConstants.query],a=e[o.RouteConstants.owner],s=Object(r.buildQueryModel)(n,t,a,!0);k(s).then(j).finally(N)},k=e=>a.YasguiComponentDirectiveUtil.getOntotextYasguiElementAsync("#query-editor").then(t=>t.openTab(e)).then(e=>a.YasguiComponentDirectiveUtil.highlightTabName(e)),N=()=>{L=!0,y.search({}),y.replace()},j=()=>Object(l.toBoolean)(y.search().execute)?a.YasguiComponentDirectiveUtil.getOntotextYasguiElementAsync("#query-editor").then(I).then(Y):Promise.resolve(),I=e=>e.getQueryMode().then(t=>({yasguiComponent:e,queryMode:t})),Y=({yasguiComponent:e,queryMode:t})=>"update"!==t?e.query():new Promise(t=>{const n=v.instant("confirm.execute"),r=Object(d.decodeHTML)(v.instant("query.editor.automatically.execute.update.warning"));q.openConfirmation(n,r,()=>t(e.query()),()=>t())}),H={createElement:e=>{const t=document.createElement("span");t.classList.add("explore-visual-graph-button-name");const n=document.createElement("button");return n.classList.add("explore-visual-graph-button"),n.classList.add("icon-data"),n.onclick=function(){const t={query:e.yasqe.getValue(),sameAs:e.yasqe.getSameAs(),inference:e.yasqe.getInfer()};y.path("graphs-visualizations").search(t)},n.appendChild(t),n},updateElement:(e,t)=>{if(e.classList.add("hidden"),!t.hasResults())return;const n=t.yasqe.getQueryType();s.QueryType.CONSTRUCT!==n&&s.QueryType.DESCRIBE!==n||e.classList.remove("hidden"),e.querySelector(".explore-visual-graph-button-name").innerText=v.instant("query.editor.visual.btn")},getOrder:()=>2},F=(e,t)=>({key:e,value:t}),z=e=>[F("name",e.data.name)],J=(e,n,r)=>{const o=t.$new(!0);o.beingBuiltConnector={percentDone:0,status:{processedEntities:0,estimatedEntities:0,indexedEntities:0,entitiesPerSecond:0},actionName:e,eta:"-",inline:!1,iri:n,name:r,doneCallback:function(){a.dismiss("cancel")}},o.getHumanReadableSeconds=t.getHumanReadableSeconds;const a=S.open({templateUrl:"pages/connectorProgress.html",controller:"CreateProgressCtrl",size:"lg",backdrop:"static",scope:o});return a},K=()=>(e,t)=>b.checkConnector(e).then(e=>e.data.command?e.data.hasSupport?i.ConnectorCommand.CREATE===e.data.command?((e,t)=>{const n=J(v.instant("externalsync.creating"),e.data.iri,e.data.name);return x.set(t,n),new u.BeforeUpdateQueryResult(u.BeforeUpdateQueryResultStatus.SUCCESS,"created.connector",z(e))})(e,t):i.ConnectorCommand.REPAIR===e.data.command?((e,t)=>{const n=J(v.instant("externalsync.repairing"),e.data.iri,e.data.name);return x.set(t,n),new u.BeforeUpdateQueryResult(u.BeforeUpdateQueryResultStatus.SUCCESS,"query.editor.repaired.connector",z(e))})(e,t):i.ConnectorCommand.DROP===e.data.command?(e=>new u.BeforeUpdateQueryResult(u.BeforeUpdateQueryResultStatus.SUCCESS,"externalsync.delete.success.msg",z(e)))(e):void 0:(e=>{const t=[F("connectorName",e.data.connectorName),F("pluginName",e.data.pluginName)];return new u.BeforeUpdateQueryResult(u.BeforeUpdateQueryResultStatus.ERROR,"query.editor.inactive.plugin.warning.msg",t)})(e):new u.BeforeUpdateQueryResult(u.BeforeUpdateQueryResultStatus.SUCCESS)).catch(e=>{console.log("Checking connector error: ",e)}),V=e=>{const n=document.querySelectorAll('script[src*="https://www.gstatic.com/"]');if(n.length>0){const e=f.getLanguage();let t="module.js";if("en"!==e&&(t=`module__${e}.js`),!Array.prototype.some.call(n,e=>e.src.includes(t)))return void location.reload()}Promise.all([h.getPrincipal(),C.getPrefixes(O)]).then(([n,r])=>{t.prefixes=r,(e=>{t.inferUserSetting=e.appSettings.DEFAULT_INFERENCE,t.sameAsUserSetting=e.appSettings.DEFAULT_SAMEAS})(n),((e=!1)=>{t.updateConfig(e);const n=y.search();n.hasOwnProperty(o.RouteConstants.savedQueryName)?M(n):n.hasOwnProperty(o.RouteConstants.query)?$(n):w.isActive()&&k()})(e)})},G=[],W=e=>{const t=a.YasguiComponentDirectiveUtil.getOntotextYasguiElement("#query-editor");t&&t.abortAllRequests().then(()=>{})};window.addEventListener("beforeunload",W);const X=e=>new Promise((t,n)=>{if(!e||e.queriesCount<1&&e.updatesCount<1)return void t();const r=v.instant("common.confirm"),o=Object(d.decodeHTML)((e=>{let t="view.sparql-editor.leave_page.run_queries.confirmation.";!e||e.queriesCount<1?t+="none_queries_":1===e.queriesCount?t+="one_query_":t+="queries_",e.updatesCount&&0!==e.updatesCount?1===e.updatesCount?t+="one_update":t+="updates":t+="non_updates",t+=".message";const n={queriesCount:e.queriesCount,updatesCount:e.updatesCount};return v.instant(t,n)})(e));q.openSimpleModal({title:r,message:o,warning:!0}).result.then((function(){t()}),(function(){n(new g.CancelAbortingQuery)}))});let Z=void 0;G.push(e.$on("$locationChangeStart",e=>{if(L)return void(L=!1);const t=a.YasguiComponentDirectiveUtil.getOntotextYasguiElement("#query-editor");if(!t||Z)return;e.preventDefault();const n=y.path(),r=y.search();t.getOngoingRequestsInfo().then(e=>X(e)).then(()=>t.abortAllRequests()).then(()=>{Z=!0,y.path(n).search(r)}).catch(e=>{if(!(e instanceof g.CancelAbortingQuery))throw e})}));const ee=()=>{U.set(T.SPARQL_LAST_REPO,O)};G.push(t.$on("language-changed",(function(){location.reload()}))),G.push(Q.subscribe("before-language-change",(function(e){return new Promise(t=>{q.openSimpleModal({title:v.instant("query.editor.language.change.warning.title"),message:v.instant("query.editor.reload.page.warning"),warning:!0}).result.then((function(){t(e)}),(function(){e.cancel=!0,t(e)}))})}))),G.push(t.$on("$destroy",()=>{ee(),G.forEach(e=>e()),window.removeEventListener("beforeunload",W)})),G.push(t.$watch(t.getActiveRepositoryObject,e=>{e&&(O=C.getActiveRepository(),P=C.isActiveRepoOntopType(e),U.get(T.SPARQL_LAST_REPO)!==O?(V(!0),ee()):V(!1))}))}angular.module("graphdb.framework.sparql-editor.controllers",["ui.bootstrap","graphdb.framework.rest.connectors.service","graphdb.framework.externalsync.controllers","graphdb.framework.utils.event-emitter-service","graphdb.framework.utils.localstorageadapter"]).controller("SparqlEditorCtrl",y),y.$inject=["$rootScope","$scope","$q","$location","$languageService","$jwtAuth","$repositories","$uibModal","toastr","$translate","SparqlRestService","ConnectorsRestService","GuidesService","ModalService","MonitoringRestService","EventEmitterService","LocalStorageAdapter","LSKeys"]},399:function(e,t,n){"use strict";n.r(t);n(311),n(140);angular.module("graphdb.framework.sparql-editor",["ui.bootstrap","graphdb.framework.sparql-editor.controllers","graphdb.framework.core.directives.yasgui-component"])}}]);