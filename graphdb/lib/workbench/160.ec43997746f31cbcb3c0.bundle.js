(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{252:function(e,r,t){"use strict";t.r(r);t(13);function n(e,r,t,n,s,a,o,i,c,l,u,p,d,h,g,f,m){e.classHierarchyData={},e.instancesObj={},e.instancesQueryObj={},e.instancesObj.items=[],e.instancesNotFiltered=[],e.isWarningShowed=!1,e.onopen=e.onclose=()=>angular.noop(),e.currentBrowserLimit=2e3,d.firefox?e.currentBrowserLimit=50:(d.safari||d.msie||d.msedge)&&(e.currentBrowserLimit=400);const C={};let y=0,S=0;r.key="",C.get=function(r,t,n){return c.initLazyList(r,t,n,y,e.instancesObj.items)};let w=allGraphs;const b=function(){if(e.getActiveRepository())return f.resolveGraphs(n.getActiveRepository()).success((function(r){e.graphsInRepo=r.results.bindings.length>1002?r.results.bindings.slice(0,1002):r.results.bindings,R()})).error((function(r){e.repositoryError=getError(r),o.error(getError(r),m.instant("graphexplore.error.getting.graphs"))}))},R=function(){const r=h.get("classHierarchy-selectedGraph-"+n.getActiveRepository());null!==r&&e.graphsInRepo.some(e=>e.contextID.uri===r.contextID.uri)?w=r:h.set("classHierarchy-selectedGraph-"+n.getActiveRepository(),w)},v=function(){return e.instancesObj.items.length<1e3?m.instant("graphexplore.search.class.instances"):m.instant("graphexplore.search.first.class.instances")};r.$watch((function(){return r.key}),(function(){y=0,_.each(e.instancesObj.items,(function(e){r.key>e&&y++})),S++})),C.revision=function(){return S},e.adapterContainer={adapter:{remain:!0}};const E=[];E.push(e.$on("goToDomainRangeGraphView",(function(e,r){I(r)}))),E.push(e.$on("classCount",x)),E.push(e.$on("repositoryIsSet",(function(){if(!s.isLicenseValid())return;if(D===n.getActiveRepository())return;D=n.getActiveRepository();if(e.repositoryError=null,!D)return;w=allGraphs,b().then(O)}))),E.push(r.$on("$translateChangeSuccess",()=>{e.instancesSearchPlaceholder=v()}));function x(r,t,n){e.classCountSlider.options&&e.classCountSlider.options.ceil!==t&&(e.classCountSlider={});var s;e.classCountSlider.value||(e.showExternalElements=!0,e.classCountSlider={value:t,options:{floor:1,ceil:t,vertical:!0,showSelectionBar:!0,onChange:function(){u(L,100,!0)}}},null===h.get(g.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE)&&t>e.currentBrowserLimit&&(s=e.currentBrowserLimit,d.chrome?o.warning(m.instant("graphexplore.disabling.animations",{classLimit:s}),m.instant("graphexplore.reducing.visual.effects")):o.warning(m.instant("graphexplore.browser.performance",{browser:d.name,classLimit:s}),m.instant("graphexplore.reducing.visual.effects"))));const a=h.get(g.CLASS_HIERARCHY_SWITCH_PREFIXES);null!=a&&"true"!==a&&(e.showExternalElements=!0),n?e.classCountSlider.value=n:t>=1500&&(e.classCountSlider.value=1500,o.warning(m.instant("graphexplore.class.count.slider",{count:1500}),m.instant("graphexplore.reducing.class.count"))),t>=25&&!window.ActiveXObject&&"ActiveXObject"in window&&!e.isWarningShowed&&(e.classCountSlider.value=25,e.isWarningShowed=!0,o.warning(m.instant("graphexplore.class.count.browser",{count:25}),m.instant("graphexplore.reducing.class.count"))),u((function(){e.$broadcast("reCalcViewDimensions");const r=document.getElementById("rzslider");let t=0;r.addEventListener("wheel",(function(r){r.preventDefault(),r.stopPropagation();const n=(new Date).getTime();if(!(n-t>100))return;t=n;let s=e.classCountSlider.value;const a=e.classCountSlider.options.step||1;r.deltaY<=-1?s+=a:r.deltaY>=1&&(s-=a),s=Math.max(e.classCountSlider.options.floor,Math.min(e.classCountSlider.options.ceil,s)),s!==e.classCountSlider.value&&e.$apply((function(){e.classCountSlider.value=s,u(L,100,!0)}))}))}),200),L()}function L(){e.currentSliderValue=e.classCountSlider.value}function I(e){const r=e.data.fullName,n=e.data.name;i.checkDomainRangeData(r).success((function(e,s){204===s?o.warning(m.instant("graphexplore.no.domain.range",{name:n})):(h.set(g.CLASS_HIERARCHY_LAST_SELECTED_CLASS,t.hash()),t.hash("").path("domain-range-graph").search("uri",r).search("name",n))})).error((function(){o.error(m.instant("graphexplore.error.request.failed",{name:n}))}))}function A(){t.replace().hash("1"),e.instancesObj.items=[],e.showExternalElements=!1,e.showClassInfoPanel=!1,h.clearClassHieararchyState(),e.hidePrefixes="true"===h.get(g.CLASS_HIERARCHY_HIDE_PREFIXES),e.currentSliderValue=void 0,e.classHierarchyData={},r.$broadcast("angucomplete-alt:clearInput")}function H(){e.hasClassHierarchy()&&u((function(){$("#toolbar").removeClass("ng-hide")}),0)}E.push(e.$on("$destroy",()=>{E.forEach(e=>e())})),e.datasource=C,e.goToDomainRangeGraphView=I,e.toggleClassInfoSidePanel=function(){e.showClassInfoPanel=!e.showClassInfoPanel,r.$broadcast("sidePanelClosed")},e.getActiveRepositoryNoError=function(){if(!e.repositoryError)return n.getActiveRepository()},e.isSystemRepository=function(){return n.isSystemRepository()},e.confirmReloadClassHierarchy=function(){p.openSimpleModal({title:m.instant("confirm.operation"),message:m.instant("graphexplore.calculating.hierarchy"),warning:!0}).result.then((function(){A(),e.loader=!0,e.hierarchyError=!1,i.reloadClassHierarchy(w.contextID.uri).success((function(r){e.loader=!1,e.classHierarchyData=r,H(),x()})).error((function(r){e.loader=!1,e.hierarchyError=getError(r),o.error(getError(r),m.instant("graphexplore.error.rdf.class.request"))}))}))},e.focusOnRoot=function(){e.$broadcast("rootFocus")},e.copyToClipboard=function(e){p.openCopyToClipboardModal(e)},e.searchedClassCallback=function(e){if(e){const t={name:e.title};r.$broadcast("searchedClass",t)}},e.instancesQueryObj.query="",e.instancesFilterFunc=function(r){return r.resolvedUri.toLowerCase().indexOf(e.instancesQueryObj.query.toLowerCase())>=0},b(),e.$watch("instancesObj.items",(function(){e.instancesObj.items.length>0&&u((function(){e.adapterContainer.adapter.reload()}),30)})),e.$watch("selectedClass",(function(){e.showClassInfoPanel&&function(r){const t=r.data.fullName;let n=r.data.name;if(n===t){const e=n.lastIndexOf("#");n=n.substring(e+1)}e.encodedUri=encodeURIComponent(t);const s=encodeURIComponent("prefix onto:<http://www.ontotext.com/>\nselect ?s {\n    ?s a <"+t+"> .\n}");e.viewInstancesUri="sparql?name="+n+"&infer=true&sameAs=false&query="+s+"&execute=true",i.getRdfsLabelAndComment(t).success((function(r){e.rdfsLabel=r.label,e.rdfsComment=r.comment,e.expanded=!1})).error((function(){o.error("Error getting rdfs:label and rdfs:comment")})),e.instancesQueryObj.query="",e.instancesLoader=!0,i.getClassInstances(t).success((function(r){e.instancesObj.items=[],_.each(r,(function(r,t){const n={};n.type=r.startsWith("<<")&&r.endsWith(">>")?"triple":"uri",n.absUri=encodeURIComponent(r),n.absUriNonEncoded=r,n.resolvedUri=t,e.instancesObj.items.push(n)})),e.instancesLoader=!1,e.instancesSearchPlaceholder=v(),e.instancesNotFiltered=e.instancesObj.items})).error((function(){o.error(m.instant("graphexplore.error.instances.request"))}))}(e.selectedClass)})),$(document).ready((function(){$(".prefix-toggle").click((function(){$(".tooltip").hide()}))}));let D=n.getActiveRepository();function O(){A(),!e.isSystemRepository()&&e.isLicenseValid()&&(e.hierarchyError=!1,e.loader=!0,i.getClassHierarchyData(w.contextID.uri).success((function(r,t){e.showExternalElements=!0,e.loader=!1,e.classHierarchyData=r,207===t&&o.warning(m.instant("graphexplore.update.diagram"),m.instant("graphexplore.repository.data.changed")),H()})).error((function(r){e.loader=!1,e.hierarchyError=getError(r),o.error(getError(r),m.instant("graphexplore.error.rdf.class.request"))})))}e.hasClassHierarchy=function(){return e.classHierarchyData.classCount&&e.getActiveRepositoryNoError()&&!e.isSystemRepository()},e.isLicenseValid=function(){return s.isLicenseValid()},e.chosenGraph=function(e){w=e,O(),h.set("classHierarchy-selectedGraph-"+n.getActiveRepository(),w)},e.getSelGraphValue=function(){return w.contextID.value},e.isAllGraphsSelected=function(){return"all.graphs.label"===e.getSelGraphValue()}}angular.module("graphdb.framework.graphexplore.controllers.class",["pageslide-directive","ngAnimate","ui.scroll.jqlite","ui.scroll","angucomplete-alt","rzSlider","toastr","graphdb.framework.utils.localstorageadapter"]).controller("RdfClassHierarchyCtlr",n),n.$inject=["$scope","$rootScope","$location","$repositories","$licenseService","$window","toastr","GraphDataRestService","UiScrollService","RdfsLabelCommentService","$timeout","ModalService","bowser","LocalStorageAdapter","LSKeys","RDF4JRepositoriesRestService","$translate"]}}]);