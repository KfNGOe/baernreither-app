(window.webpackJsonp=window.webpackJsonp||[]).push([[90,192],{107:function(t,e,s){"use strict";s.r(e),s.d(e,"Location",(function(){return i})),s.d(e,"Node",(function(){return n})),s.d(e,"TopologyStatus",(function(){return r})),s.d(e,"Link",(function(){return o})),s.d(e,"ClusterModel",(function(){return a})),s.d(e,"ClusterViewModel",(function(){return d})),s.d(e,"ClusterItemViewModel",(function(){return l})),s.d(e,"ClusterConfiguration",(function(){return u}));class i{constructor(t,e=null,s=null,i=!1,n=!1){this._endpoint=t,this._rpcAddress=e,this._error=s,this._isAvailable=i,this._isLocal=n}get isLocal(){return this._isLocal}get endpoint(){return this._endpoint}get rpcAddress(){return this._rpcAddress}get error(){return this._error}get isAvailable(){return this._isAvailable}set endpoint(t){this._endpoint=t}set rpcAddress(t){this._rpcAddress=t}set error(t){this._error=t}set isAvailable(t){this._isAvailable=t}set isLocal(t){this._isLocal=t}static fromJSON({endpoint:t,rpcAddress:e,error:s=null,isAvailable:n=!1,isLocal:r=!1}){return new i(t,e,s,n,r)}}class n{constructor(t,e,s,i,n,o,a,d,l){this._address=t,this._nodeState=e,this._term=s,this._syncStatus=i,this._lastLogTerm=n,this._lastLogIndex=o,this._endpoint=a,this._recoveryStatus=d,this._topologyStatus=r.fromJSON(l)}get address(){return this._address}get nodeState(){return this._nodeState}get term(){return this._term}get syncStatus(){return this._syncStatus}get lastLogTerm(){return this._lastLogTerm}get lastLogIndex(){return this._lastLogIndex}get endpoint(){return this._endpoint}get recoveryStatus(){return this._recoveryStatus}set address(t){this._address=t}set nodeState(t){this._nodeState=t}set term(t){this._term=t}set syncStatus(t){this._syncStatus=t}set lastLogTerm(t){this._lastLogTerm=t}set lastLogIndex(t){this._lastLogIndex=t}set endpoint(t){this._endpoint=t}set recoveryStatus(t){this._recoveryStatus=t}get topologyStatus(){return this._topologyStatus}set topologyStatus(t){return this._topologyStatus=t}static fromJSON({address:t,nodeState:e,term:s,syncStatus:i,lastLogTerm:r,lastLogIndex:o,endpoint:a,recoveryStatus:d,topologyStatus:l}){return new n(t,e,s,i,r,o,a,d,l)}}class r{constructor(t,e=new Map,s,i){this._state=t,this._primaryTags=e,this._primaryIndex=s,this._primaryLeader=i}get state(){return this._state}get primaryTags(){return this._primaryTags}get primaryIndex(){return this._primaryIndex}get primaryLeader(){return this._primaryLeader}static fromJSON({state:t,primaryTags:e={},primaryIndex:s,primaryLeader:i}){const n=Object.entries(e);return new r(t,n,s,i)}}class o{constructor(t,e,s,i){this._id=t,this._source=e,this._target=s,this._status=i}static fromJSON({id:t,source:e,target:s,status:i}){return new o(t,e,s,i)}}class a{constructor(t,e,s,i){this._locations=t,this._hasCluster=e,this._nodes=s,this._links=i}get locations(){return this._locations}set locations(t){this._locations=t}get hasCluster(){return this._hasCluster}set hasCluster(t){this._hasCluster=t}get nodes(){return this._nodes}set nodes(t){this._nodes=t}get links(){return this._links}set links(t){this._links=t}static fromJSON(t){const e=t.locations.map(i.fromJSON),s=t.nodes.map(n.fromJSON),r=t.links.map(o.fromJSON);return new a(e,t.hasCluster,s,r)}}class d{constructor(t){this._clusterModel=a.fromJSON(t),this._addToCluster=new Map,this._deleteFromCluster=new Map,this._currentNodesCount=0,this._clusterConfiguration=new u,this._localNodeEndpoint=t.locations.find(t=>t.isLocal).endpoint,this.MINIMUM_NODES_REQUIRED=2}getAttached(){const t=this._clusterModel.nodes.concat(Array.from(this._addToCluster.values()));return this._currentNodesCount=t.filter(t=>!this._deleteFromCluster.has(t.endpoint)).length,t}getViewModel(){let t=0;return this.getAttached().map(e=>{const s=new l(e);return this._deleteFromCluster.has(e.endpoint)?s.isDeleted=!0:s.index=t++,this._localNodeEndpoint===e.endpoint&&(s.isLocal=!0),s})}getAvailable(t=!1){const e=this._clusterModel.nodes;return this._clusterModel.locations.filter(s=>{const i=!this.isPresentInList(e,s.endpoint),n=s.isAvailable,r=!this._addToCluster.has(s.endpoint),o=!!t||!this._deleteFromCluster.has(s.endpoint);return i&&n&&o&&r})}getAvailableNodeEndpoints(){return this.getAvailable().map(t=>t.endpoint)}getLocalNode(){return this._clusterModel.locations.find(t=>t.isLocal)}addToCluster(t){const e=t.endpoint;t.endpoint&&this.addToLocations(t),this._deleteFromCluster.has(e)?this._deleteFromCluster.delete(e):this._addToCluster.set(e,t)}addToLocations(t){const e=c.findIndexByEndpoint(this._clusterModel.locations,t.endpoint);-1===e?this._clusterModel.locations.push(t):this._clusterModel.locations.splice(e,1)}deleteFromCluster(t){const e=t.endpoint;this._addToCluster.has(e)?this._addToCluster.delete(e):this._deleteFromCluster.set(e,t)}getDeleteFromCluster(){return Array.from(this._deleteFromCluster.values())}getUpdateActions(){const t=Array.from(this._addToCluster.values()).map(t=>t.endpoint),e={addNodes:t,removeNodes:Array.from(this._deleteFromCluster.values()).map(t=>t.endpoint)},s=this.updateClusterConfiguration(t);return s&&(e.clusterConfiguration=s),e}updateClusterConfiguration(t){return this.hasCluster()?null:(this._clusterConfiguration.nodes=t,this._clusterConfiguration.toJSON())}getClusterConfiguration(){return this._clusterConfiguration}restoreFromDeletion(t){this._deleteFromCluster.delete(t.endpoint)}isChanged(){return this._addToCluster.size>0||this._deleteFromCluster.size>0}isPresentInList(t,e){return c.isPresentInList(t,e)}findByEndpoint(t,e){return c.findByEndpoint(t,e)}findIndexByEndpoint(t,e){return c.findIndexByEndpoint(t,e)}hasValidNodesCount(){return this._currentNodesCount>=this.MINIMUM_NODES_REQUIRED}canDeleteNode(){const t=Math.floor(this._clusterModel.nodes.length/2);return this._deleteFromCluster.size<t}hasCluster(){return this._clusterModel.hasCluster}}class l{constructor(t){this._item=t,this._endpoint=t.endpoint,this._isDeleted=!1,this._index=void 0,this._isLocal=!1}getEndPoint(){return this._item.endpoint}getAddress(){return void 0!==this._item._address?this._item._address:void 0!==this._item.rpcAddress?this._item.rpcAddress:null}isNode(){return void 0!==this._item._address}isLocation(){return void 0===this._item._address}getNodeState(){return this.isNode()?this._item._nodeState:null}getIsAvailable(){return this.isNode()?null:this._item.isAvailable}getTerm(){return this.isNode()?this._item.term:null}getSyncStatus(){return this.isNode()?this._item.syncStatus:null}getIsLocal(){return this.isNode()?null:this._item.isLocal}get item(){return this._item}get endpoint(){return this._endpoint}set endpoint(t){return this._endpoint=t}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}get index(){return this._index}set index(t){this._index=t}get isLocal(){return this._isLocal}set isLocal(t){this._isLocal=t}}class u{constructor({electionMinTimeout:t=8e3,electionRangeTimeout:e=6e3,heartbeatInterval:s=2e3,messageSizeKB:i=64,verificationTimeout:n=1500,transactionLogMaximumSizeGB:r=50,batchUpdateInterval:o=5e3,nodes:a=[],secondaryTag:d,primaryNodes:l}={}){this._electionMinTimeout=t,this._electionRangeTimeout=e,this._heartbeatInterval=s,this._messageSizeKB=i,this._verificationTimeout=n,this._transactionLogMaximumSizeGB=r,this._batchUpdateInterval=o,this._nodes=a,this._secondaryTag=d,this._primaryNodes=l}static fromJSON(t){return new u(t)}get electionMinTimeout(){return this._electionMinTimeout}set electionMinTimeout(t){this._electionMinTimeout=t}get electionRangeTimeout(){return this._electionRangeTimeout}set electionRangeTimeout(t){this._electionRangeTimeout=t}get heartbeatInterval(){return this._heartbeatInterval}set heartbeatInterval(t){this._heartbeatInterval=t}get messageSizeKB(){return this._messageSizeKB}set messageSizeKB(t){this._messageSizeKB=t}get verificationTimeout(){return this._verificationTimeout}set verificationTimeout(t){this._verificationTimeout=t}get transactionLogMaximumSizeGB(){return this._transactionLogMaximumSizeGB}set transactionLogMaximumSizeGB(t){this._transactionLogMaximumSizeGB=t}get nodes(){return this._nodes}set nodes(t){this._nodes=t}get batchUpdateInterval(){return this._batchUpdateInterval}set batchUpdateInterval(t){this._batchUpdateInterval=t}get secondaryTag(){return this._secondaryTag}set secondaryTag(t){this._secondaryTag=t}get primaryNodes(){return this._primaryNodes}set primaryNodes(t){this._primaryNodes=t}toJSON(){const t={electionMinTimeout:this._electionMinTimeout,electionRangeTimeout:this._electionRangeTimeout,heartbeatInterval:this._heartbeatInterval,messageSizeKB:this._messageSizeKB,verificationTimeout:this._verificationTimeout,transactionLogMaximumSizeGB:this._transactionLogMaximumSizeGB,batchUpdateInterval:this._batchUpdateInterval,nodes:this._nodes};return void 0!==this._secondaryTag&&(t.secondaryTag=this._secondaryTag),void 0!==this._primaryNodes&&(t.primaryNodes=this._primaryNodes),t}}class c{static isPresentInList(t,e){return t.some(t=>t.endpoint===e)}static findByEndpoint(t,e){return t.find(t=>t.endpoint===e)}static findIndexByEndpoint(t,e){return t.findIndex(t=>t.endpoint===e)}}},227:function(t,e,s){"use strict";s.r(e);var i=s(107);function n(t,e,s,n,r,o,a){return{restrict:"E",templateUrl:"js/angular/clustermanagement/templates/cluster-nodes-configuration.html",link:s=>{const n=[];s.rowHeights={},s.editedNodeIndex=void 0,s.allSuggestions=[],s.loader=!1,s.errors=[],s.addNewLocation=!1,s.hasCluster=!1,s.addNode=()=>{s.addNewLocation=!0,s.newLocation=new i.Location},s.filterSuggestions=t=>{const e=t.endpoint&&t.endpoint.toLowerCase();e?(s.suggestions=s.allSuggestions.filter(t=>t.toLowerCase().includes(e)),s.showDropdown=!0):(s.suggestions=[],s.showDropdown=!1)},s.selectSuggestion=(t,e)=>{t.endpoint=e,s.suggestions=[],s.showDropdown=!1},s.hideSuggestions=()=>{e(()=>{s.showDropdown=!1},200)},s.saveNode=t=>{const e=o.getAvailable(!0);!function(t,e){e?o.replace(e,t):o.addLocation(t);r()}(o.findByEndpoint(e,t)||new i.Location(t),o.getPendingReplace())},s.deleteNode=(e,s)=>{a.openSimpleModal({title:t.instant("location.confirm.detach"),message:t.instant("location.confirm.detach.warning",{uri:s.endpoint}),warning:!0}).result.then(()=>{o.deleteFromCluster(s.item)})},s.replaceNode=(e,i)=>{a.openSimpleModal({title:t.instant("location.change.confirm"),message:t.instant("location.change.confirm.warning"),warning:!0}).result.then(()=>{o.setPendingReplace(i.item),s.editedNodeIndex=e})},s.isClusterConfigurationValid=()=>{const t=void 0===s.editedNodeIndex,e=!1===s.addNewLocation,i=o.hasValidNodesCount(),n=s.form.$valid;return t&&e&&i&&n},s.setLoader=(t,i)=>{e.cancel(s.loaderTimeout),t?s.loaderTimeout=e(()=>{s.loader=t,s.loaderMessage=i},300):s.loader=!1},s.getAdvancedOptionsClass=()=>{const t=document.getElementById("advancedOptions");if(t){const e=t.getAttribute("aria-expanded");if(e&&"true"===e)return"fa fa-angle-down"}return"fa fa-angle-right"},s.cancel=()=>{s.editedNodeIndex=void 0,s.addNewLocation=!1,o.emitUpdateClusterView()},s.restoreNode=t=>{o.restoreNode(t.item)};const r=()=>{o.setPendingReplace(void 0),s.editedNodeIndex=void 0,s.addNewLocation=!1},d=s.$watchGroup(["editedNodeIndex","addNewLocation","clusterConfiguration.electionMinTimeout","clusterConfiguration.electionRangeTimeout","clusterConfiguration.heartbeatInterval","clusterConfiguration.messageSizeKB","clusterConfiguration.verificationTimeout","clusterConfiguration.transactionLogMaximumSizeGB"],(t,e)=>{const i=s.isClusterConfigurationValid();o.updateClusterValidity(i)});n.push(d),n.push(o.onClusterViewChanged(t=>{s.hasCluster=o.hasCluster(),s.viewModel=o.getViewModel(),s.clusterNodesEndpoints=s.viewModel.map(t=>t.endpoint),s.clusterConfiguration=o.getClusterConfiguration(),s.allSuggestions=o.getAvailableNodeEndpoints(),s.canDeleteNode=o.canDeleteNode()})),s.$on("$destroy",()=>{n.forEach(t=>t())})}}}angular.module("graphdb.framework.clustermanagement.directives.cluster-nodes-configuration",[]).directive("clusterNodesConfiguration",n),n.$inject=["$translate","$timeout","productInfo","toastr","RemoteLocationsService","ClusterContextService","ModalService"]}}]);