(window.webpackJsonp=window.webpackJsonp||[]).push([[41,98,200,236,244,326],{101:function(e,r){function t(e,r){return{showToastMessageWithDelay:function(t){return new Promise(s=>{e.success(r.instant(t)),setTimeout(s,200)})}}}angular.module("graphdb.framework.utils.notifications",[]).factory("Notifications",t),t.$inject=["toastr","$translate"]},111:function(e,r,t){"use strict";t.r(r),t.d(r,"StartMode",(function(){return s})),t.d(r,"GraphsConfig",(function(){return a}));const s={QUERY:"query",NODE:"node",SEARCH:"search"};class a{constructor(e,r,t=s.SEARCH,a,i=!0,n=!0,o,u,p,c,d,h,g,y,l,Q,f,w,I,m,R){this._id=e,this._name=r,this._startMode=t,this._owner=a,this._startQueryIncludeInferred=i,this._startQuerySameAs=n,this._startGraphQuery=o,this._startIRI=u,this._startIRILabel=p,this._expandQuery=c,this._resourceQuery=d,this._predicateLabelQuery=h,this._resourcePropertiesQuery=g,this._shared=y,this._description=l,this._hint=Q,this._startGraphQueryDescription=f,this._expandQueryDescription=w,this._resourceQueryDescription=I,this._predicateLabelQueryDescription=m,this._resourcePropertiesQueryDescription=R}isStartMode(e){return this.startMode===e}isDefaultGraph(){return"Minimal"===this.name||"Advanced"===this.name}getPropertyDescription(e){return this[e+"Description"]}getQueryType(e){let r;return this.isStartMode(s.QUERY)&&1===e?r=this.startGraphQuery:2===e?r=this.expandQuery:3===e?r=this.resourceQuery:4===e?r=this.predicateLabelQuery:5===e&&(r=this.resourcePropertiesQuery),r||""}updateModel(e,r){return this.isStartMode(s.QUERY)&&1===r?this.startGraphQuery=e:2===r?this.expandQuery=e:3===r?this.resourceQuery=e:4===r?this.predicateLabelQuery=e:5===r&&(this.resourcePropertiesQuery=e),this}toSavePayload(){return{id:this.id,name:this.name,startMode:this.startMode,owner:this.owner,startQueryIncludeInferred:this.startQueryIncludeInferred,startQuerySameAs:this.startQuerySameAs,startGraphQuery:this.startGraphQuery,startIRI:this.startIRI,startIRILabel:this.startIRILabel,expandQuery:this.expandQuery,resourceQuery:this.resourceQuery,predicateLabelQuery:this.predicateLabelQuery,resourcePropertiesQuery:this.resourcePropertiesQuery,shared:this.shared,description:this.description,hint:this.hint}}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get startMode(){return this._startMode}set startMode(e){this._startMode=e}get owner(){return this._owner}set owner(e){this._owner=e}get startQueryIncludeInferred(){return this._startQueryIncludeInferred}set startQueryIncludeInferred(e){this._startQueryIncludeInferred=e}get startQuerySameAs(){return this._startQuerySameAs}set startQuerySameAs(e){this._startQuerySameAs=e}get startGraphQuery(){return this._startGraphQuery}set startGraphQuery(e){this._startGraphQuery=e}get startIRI(){return this._startIRI}set startIRI(e){this._startIRI=e}get startIRILabel(){return this._startIRILabel}set startIRILabel(e){this._startIRILabel=e}get expandQuery(){return this._expandQuery}set expandQuery(e){this._expandQuery=e}get resourceQuery(){return this._resourceQuery}set resourceQuery(e){this._resourceQuery=e}get predicateLabelQuery(){return this._predicateLabelQuery}set predicateLabelQuery(e){this._predicateLabelQuery=e}get resourcePropertiesQuery(){return this._resourcePropertiesQuery}set resourcePropertiesQuery(e){this._resourcePropertiesQuery=e}get shared(){return this._shared}set shared(e){this._shared=e}get description(){return this._description}set description(e){this._description=e}get hint(){return this._hint}set hint(e){this._hint=e}get startGraphQueryDescription(){return this._startGraphQueryDescription}set startGraphQueryDescription(e){this._startGraphQueryDescription=e}get expandQueryDescription(){return this._expandQueryDescription}set expandQueryDescription(e){this._expandQueryDescription=e}get resourceQueryDescription(){return this._resourceQueryDescription}set resourceQueryDescription(e){this._resourceQueryDescription=e}get predicateLabelQueryDescription(){return this._predicateLabelQueryDescription}set predicateLabelQueryDescription(e){this._predicateLabelQueryDescription=e}get resourcePropertiesQueryDescription(){return this._resourcePropertiesQueryDescription}set resourcePropertiesQueryDescription(e){this._resourcePropertiesQueryDescription=e}}},132:function(e,r,t){"use strict";t.r(r),t.d(r,"mapGraphsConfigResponseToModel",(function(){return a})),t.d(r,"mapGraphConfigSampleToGraphConfig",(function(){return i})),t.d(r,"mapGraphConfigSamplesToGraphConfigs",(function(){return n}));var s=t(111);const a=e=>new s.GraphsConfig(e.id,e.name,e.startMode,e.owner,e.startQueryIncludeInferred,e.startQuerySameAs,e.startGraphQuery,e.startIRI,e.startIRILabel,e.expandQuery,e.resourceQuery,e.predicateLabelQuery,e.resourcePropertiesQuery,e.shared,e.description,e.hint),i=e=>new s.GraphsConfig(e.id,e.name,e.startMode,e.owner,e.startQueryIncludeInferred,e.startQuerySameAs,e.startGraphQuery,e.startIRI,e.startIRILabel,e.expandQuery,e.resourceQuery,e.predicateLabelQuery,e.resourcePropertiesQuery,e.shared,e.description,e.hint,e.startGraphQueryDescription,e.expandQueryDescription,e.resourceQueryDescription,e.predicateLabelQueryDescription,e.resourcePropertiesQueryDescription),n=e=>e.map(e=>i(e))},256:function(e,r,t){"use strict";t.r(r);t(101),t(13),t(23);var s=t(96),a=t(89),i=t(19),n=t(111),o=t(132),u=t(8);function p(e,r,t,p,c,d,h,g,y,l,Q,f,w,I,m,R,_){let C;r.newConfig=new n.GraphsConfig,r.revertConfig=void 0,r.page=1,r.totalPages=5,r.helpHidden=1===f.get(w.HIDE_GRAPH_CONFIG_HELP),r.isUpdate=!1,r.shared=!1,r.canEditActiveRepo=r.canWriteActiveRepo(),r.samples=[],r.tabConfig={inference:r.newConfig.startQueryIncludeInferred,sameAs:r.newConfig.startQuerySameAs},r.isAutocompleteEnabled=void 0,r.repositoryNamespaces=void 0,r.tabsViewModel=[];const b=l.configName,E=d.getActiveRepository();r.toggleHelp=e=>{void 0===e&&(e=f.get(w.HIDE_GRAPH_CONFIG_HELP)),1!==e?(f.set(w.HIDE_GRAPH_CONFIG_HELP,1),r.helpHidden=!0):(f.set(w.HIDE_GRAPH_CONFIG_HELP,0),r.helpHidden=!1)},r.fixedVisualCallback=(e,t)=>{r.newConfig.startIRI=e,r.newConfig.startIRILabel=t,C=!0},r.isDefaultGraph=e=>e.isDefaultGraph(),r.isUserGraph=e=>!e.isDefaultGraph(),r.getSampleName=(e,r)=>{if(!e)return"";const t=e.getPropertyDescription(r);return t||(e.id?"Copy of "+e.name:e.name)},r.createGraphConfig=e=>{y.createGraphConfig(e).success((async function(){await Q.showToastMessageWithDelay("graphexplore.saved.new.config"),p.url("graphs-visualizations")})).error((function(e){c.error(getError(e),I.instant("graphexplore.error.could.not.create"))}))},r.updateGraphConfig=e=>{y.updateGraphConfig(e).success((async function(){await Q.showToastMessageWithDelay("graphexplore.saved.config"),p.url("graphs-visualizations")})).error((function(e){c.error(getError(e),I.instant("graphexplore.error.could.not.save"))}))},r.goToPage=e=>{r.page!==e&&P(()=>{r.showEditor(),r.page=e})},r.goToPreviousPage=()=>{r.page>1&&r.goToPage(r.page-1),q()&&(C=!1)},r.goToNextPage=()=>{N(),r.newConfig.isStartMode(n.StartMode.NODE)&&!C||r.goToPage(r.page+1)},r.saveGraphConfig=()=>{N(),q()&&!C||(r.newConfig.startQueryIncludeInferred=r.tabConfig.inference,r.newConfig.startQuerySameAs=r.tabConfig.sameAs,P(()=>{r.newConfig.name?(r.queryEditorIsDirty=!1,r.isUpdate?r.updateGraphConfig(r.newConfig.toSavePayload()):r.createGraphConfig(r.newConfig.toSavePayload())):L(I.instant("graphexplore.provide.config.name"))}))},r.setQuery=async e=>{const t=e||" ";(await S()).setQuery(t),r.markDirty()},r.markDirty=async()=>{if(r.revertConfig){const e=r.revertConfig.getQueryType(r.page),t=await G();r.queryEditorIsDirty=e!==t}},r.showEditor=()=>{r.viewMode="yasr",A(),M()},r.showPreview=()=>{r.viewMode="editor",D()},r.revertEditor=()=>{r.setQuery(r.revertConfig.getQueryType(r.page)),r.queryEditorIsDirty=!1};const S=()=>i.YasguiComponentDirectiveUtil.getOntotextYasguiElementAsync("#query-editor"),D=async(e,t)=>{const s=await S(),a=await s.getQueryType();if(t&&"SELECT"!==a&&"CONSTRUCT"!==a&&"DESCRIBE"!==a)return void c.warning(I.instant("query.editor.warning.msg"));"update"!==await s.getQueryMode()?r.queryIsRunning||(r.viewMode="editor",v()):c.warning(I.instant("cannot.execute.update.error"))},v=async()=>{(await S()).query(a.RenderingMode.YASR)},M=async()=>(await S()).changeRenderMode(a.RenderingMode.YASQE),G=async()=>(await S()).getQuery(),A=async()=>(await S()).abortQuery(),P=async e=>{const t=await(async()=>{const e=await S();let t=await e.getQuery();return t=t.trim(),r.newConfig.updateModel(t,r.page)})();1===r.page?t.isStartMode(n.StartMode.NODE)&&!t.startIRI?L(I.instant("graphexplore.select.start.node")):t.isStartMode(n.StartMode.QUERY)&&!t.startGraphQuery?L(I.instant("graphexplore.provide.query")):t.isStartMode(n.StartMode.QUERY)?T(e,t.startGraphQuery,"graph"):e():2===r.page?T(e,t.expandQuery,"construct",["node"]):3===r.page?T(e,t.resourceQuery,"tuple",["node"],[],["type","label","comment","rank"]):4===r.page?T(e,t.predicateLabelQuery,"tuple",["edge"],["label"]):5===r.page&&T(e,t.resourcePropertiesQuery,"tuple",["node"],["property","value"])},x=()=>{r.tabConfig.inference=r.newConfig.startQueryIncludeInferred,r.tabConfig.sameAs=r.newConfig.startQuerySameAs,r.setQuery(r.newConfig.getQueryType(r.page))},L=e=>{c.warning(e)},T=(e,r,t,s,a,i)=>{r?y.validateQuery(r,t,s,a,i).success(()=>{e()}).error(e=>{L(getError(e))}):e()},N=()=>{q()&&r.$broadcast("addStartFixedNodeAutomatically",{startIRI:r.newConfig.startIRI})},q=()=>1===r.page&&r.newConfig.isStartMode(n.StartMode.NODE),Y=()=>{y.getGraphConfigSamples().success((function(e){r.samples=Object(o.mapGraphConfigSamplesToGraphConfigs)(e).filter(e=>!e.id||r.newConfig.id!==e.id||(r.revertConfig=e,!1))})).error((function(e){c.error(getError(e),I.instant("graphexplore.error.graph.configs"))}))},$={endpoint:()=>"repositories/"+d.getActiveRepository(),showEditorTabs:!1,showToolbar:!1,showResultTabs:!1,showYasqeActionButtons:!1,yasqeActionButtons:i.INFERRED_AND_SAME_AS_BUTTONS_CONFIGURATION,showQueryButton:!1,initialQuery:" ",componentId:"graphs-config",render:a.RenderingMode.YASQE,maxPersistentResponseSize:0,showYasqeResizer:!1,yasqeMode:s.YasqeMode.PROTECTED,infer:r.newConfig.startQueryIncludeInferred,sameAs:r.newConfig.startQuerySameAs},U=(e,t,s)=>{r.queryIsRunning=e},O=()=>{window.removeEventListener("beforeunload",H),F.forEach(e=>e())},H=e=>{r.queryEditorIsDirty&&(e.returnValue=!0)},k=()=>{r.tabsViewModel=[{page:1,label:I.instant("starting.point.label"),type:"startGraphQuery"},{page:2,label:I.instant("graph.expansion"),type:"expandQuery"},{page:3,label:I.instant("node.basics"),type:"resourceQuery"},{page:4,label:I.instant("edge.basics"),type:"predicateLabelQuery"},{page:5,label:I.instant("node.extra"),type:"resourcePropertiesQuery"}]},F=[];F.push(R.onSelectedRepositoryIdUpdated(e=>{e?_.getNamespaces(e).then(e=>{r.repositoryNamespaces=e}).catch(e=>{const r=getError(e);c.error(r,I.instant("error.getting.namespaces.for.repo"))}):r.repositoryNamespaces=new u.NamespacesListModel})),F.push(R.onAutocompleteEnabledUpdated(e=>{r.isAutocompleteEnabled=e})),F.push(r.$on("$locationChangeStart",(e,t)=>{if(r.queryEditorIsDirty){e.preventDefault();((e,r,t,s)=>{m.openSimpleModal({title:e,message:r,warning:!0}).result.then((function(){angular.isFunction(t)&&t()}),(function(){angular.isFunction(s)&&s()}))})(I.instant("common.confirm"),I.instant("visual.config.warning.unsaved.changes"),()=>{O();const e=p.absUrl().length-p.url().length,r=t.substring(e);p.path(r)})}else O()})),F.push(r.$on("$destroy",O)),F.push(r.$watch(r.getActiveRepositoryObject,()=>{(r.newConfig.isStartMode(n.StartMode.QUERY)||r.page>1)&&(r.viewMode="yasr",A().then(M))})),F.push(e.$on("$translateChangeSuccess",()=>{k()})),window.addEventListener("beforeunload",H),r.$watch("newConfig.startMode",e=>{e===n.StartMode.QUERY&&x()}),r.$watch("page",e=>{(r.newConfig.isStartMode(n.StartMode.QUERY)||e>1)&&(r.showEditor(),x())}),k(),d.getPrefixes(E).then(e=>(e=>{const t=r.$watch((function(){return r.getActiveRepositoryObject()}),(function(a){if(a){r.canEditActiveRepo=r.canWriteActiveRepo();const a=angular.extend({},$,{prefixes:e,yasqeMode:r.canWriteActiveRepo()?s.YasqeMode.WRITE:s.YasqeMode.PROTECTED});r.yasguiConfig=a,t()}}))})(e)).finally(()=>U(!1)),b?(r.isUpdate=!0,y.getConfig(b).then((function(e){r.newConfig=e,Y()})).catch(e=>{c.error(getError(e),I.instant("created.connector",{name:b}))})):(r.isUpdate=!1,Y()),r.getActiveRepository()&&(U(!0,I.instant("common.refreshing.namespaces"),I.instant("common.extra.message")),d.getPrefixes(d.getActiveRepository()).then(e=>{r.namespaces=e}).catch((function(e){r.repositoryError=getError(e)})).finally((function(){U(!1)})))}angular.module("graphdb.framework.graphexplore.controllers.graphviz.config",["graphdb.framework.utils.notifications","graphdb.framework.utils.localstorageadapter","graphdb.core.services.workbench-context","graphdb.framework.core.services.rdf4j.repositories"]).controller("GraphConfigCtrl",p),p.$inject=["$rootScope","$scope","$timeout","$location","toastr","$repositories","SparqlRestService","$filter","GraphConfigRestService","$routeParams","Notifications","LocalStorageAdapter","LSKeys","$translate","ModalService","WorkbenchContextService","RDF4JRepositoriesService"]},89:function(e,r,t){"use strict";t.r(r),t.d(r,"RenderingMode",(function(){return s}));const s={YASGUI:"mode-yasgui",YASQE:"mode-yasqe",YASR:"mode-yasr"}},96:function(e,r,t){"use strict";t.r(r),t.d(r,"YasqeMode",(function(){return s}));const s={WRITE:"WRITE",READ:"READ",PROTECTED:"PROTECTED"}}}]);