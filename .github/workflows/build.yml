name: Build project

on: 
  push:
    branches:
      - main

jobs:
  build_infra:
    name: Build infrastructure
    runs-on: ubuntu-latest
    steps:
      - name: Perform Checkout
        uses: actions/checkout@v2
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: "11"
          distribution: "adopt"      
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with: 
          node-version: "14.x"
      - name: Install
        run: sudo bash install.sh
      - name: Start graphdb
        run: sudo bash gdb_start.sh &
      - name: Wait for graphdb
        run: sleep 15s
        shell: bash
      - name: Create repo
        run: sudo bash gdb_createRepo.sh
      - name: Get repo list
        run: sudo bash gdb_getRepo.sh
      - name: Build tei to ttl
        run: sudo bash build_tei2ttl.sh
      - name: Build ttl to ttl
        run: sudo bash build_ttl2ttl.sh        
      - name: Build ttl to json
        run: sudo bash build_ttl2json.sh
      - name: Build json to html
        run: sudo bash build_json2html.sh
      - name: Pushes to baernreither-page
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.ACCESS_TOKEN }}
        with:
          source-directory: "html"
          destination-github-username: "KfNGOe"
          destination-repository-name: "baernreither-page"
          user-email: baernreither-app@github.io
          target-branch: main
      #- name: Import data
      #  run: sudo bash gdb_importFile.sh
      #- name: Query data
      #  run: sudo bash gdb_queryRepo.sh
     #- name: build xml ID
     #  run: sudo bash build_xmlId.sh