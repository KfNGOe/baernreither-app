(window.webpackJsonp=window.webpackJsonp||[]).push([[5,110],{60:function(e,t,o){"use strict";o.r(t),o.d(t,"STATIC_RULESETS",(function(){return i})),o.d(t,"REPOSITORY_TYPES",(function(){return n})),o.d(t,"FILENAME_PATTERN",(function(){return r})),o.d(t,"NUMBER_PATTERN",(function(){return a}));const i=[{id:"empty",name:"No inference"},{id:"rdfs-optimized",name:"RDFS (Optimized)"},{id:"rdfs",name:"RDFS"},{id:"rdfsplus-optimized",name:"RDFS-Plus (Optimized)"},{id:"owl-horst-optimized",name:"OWL-Horst (Optimized)"},{id:"owl-horst",name:"OWL-Horst"},{id:"owl2-ql-optimized",name:"OWL2-QL (Optimized)"},{id:"owl2-ql",name:"OWL2-QL"},{id:"owl-max-optimized",name:"OWL-Max (Optimized)"},{id:"owl-max",name:"OWL-Max"},{id:"owl2-rl-optimized",name:"OWL2-RL (Optimized)"},{id:"owl2-rl",name:"OWL2-RL"}],n={graphdbRepo:"graphdb",free:"free",eeWorker:"worker",eeMaster:"master",ontop:"ontop",se:"se",fedx:"fedx"},r=new RegExp("^[a-zA-Z0-9-_]+$"),a=new RegExp("^[0-9]+$")},65:function(e,t,o){"use strict";o.r(t),o.d(t,"getFileName",(function(){return r}));var i=o(60),n=o(0);const r=function(e){let t=e.lastIndexOf("/");-1===t&&(t=e.lastIndexOf("\\"));let o=e;return-1!==t&&(o=o.substring(t+1)),o},a=function(e){e&&(e.queryTimeout&&(e.queryTimeout.value=parseInt(e.queryTimeout.value)),e.queryLimitResults&&e.validationResultsLimitTotal&&e.validationResultsLimitPerConstraint?(e.queryLimitResults.value=parseInt(e.queryLimitResults.value),e.validationResultsLimitTotal.value=parseInt(e.validationResultsLimitTotal.value),e.validationResultsLimitPerConstraint.value=parseInt(e.validationResultsLimitPerConstraint.value)):e.leftJoinWorkerThreads&&e.boundJoinBlockSize&&e.joinWorkerThreads&&e.unionWorkerThreads&&(e.leftJoinWorkerThreads.value=parseInt(e.leftJoinWorkerThreads.value),e.boundJoinBlockSize.value=parseInt(e.boundJoinBlockSize.value),e.joinWorkerThreads.value=parseInt(e.joinWorkerThreads.value),e.unionWorkerThreads.value=parseInt(e.unionWorkerThreads.value)))},s=function(){const e=document.getElementById("shaclOptions");if(e){const t=e.getAttribute("aria-expanded");if(t&&"true"===t)return"fa fa-angle-down"}return"fa fa-angle-right"},l=function(e,t){e.queryTimeout&&(t.isInvalidQueryTimeout=!i.NUMBER_PATTERN.test(e.queryTimeout.value)),e.validationResultsLimitTotal&&e.validationResultsLimitPerConstraint&&e.queryLimitResults?(t.isInvalidValidationResultsLimitTotal=!i.NUMBER_PATTERN.test(e.validationResultsLimitTotal.value),t.isInvalidValidationResultsLimitPerConstraint=!i.NUMBER_PATTERN.test(e.validationResultsLimitPerConstraint.value),t.isInvalidQueryLimit=!i.NUMBER_PATTERN.test(e.queryLimitResults.value)):e.leftJoinWorkerThreads&&e.boundJoinBlockSize&&e.joinWorkerThreads&&e.unionWorkerThreads&&(t.isInvalidLeftJoinWorkerThreads=!i.NUMBER_PATTERN.test(e.leftJoinWorkerThreads.value),t.isInvalidBoundJoinBlockSize=!i.NUMBER_PATTERN.test(e.boundJoinBlockSize.value),t.isInvalidJoinWorkerThreads=!i.NUMBER_PATTERN.test(e.joinWorkerThreads.value),t.isInvalidUnionWorkerThreads=!i.NUMBER_PATTERN.test(e.unionWorkerThreads.value))},c=function(e,t){return"isInvalidQueryLimit"===e?t.instant("invalid.query.limit"):"isInvalidQueryTimeout"===e?t.instant("invalid.query.timeout"):"isInvalidValidationResultsLimitTotal"===e?t.instant("invalid.validation.results.limit.total"):"isInvalidValidationResultsLimitPerConstraint"===e?t.instant("invalid.validation.results.limit.per.constraint"):"isInvalidJoinWorkerThreads"===e?t.instant("invalid.join.worker.threads"):"isInvalidLeftJoinWorkerThreads"===e?t.instant("invalid.left.join.worker.threads"):"isInvalidUnionWorkerThreads"===e?t.instant("invalid.union.worker.threads"):"isInvalidBoundJoinBlockSize"===e?t.instant("invalid.bound.join.block.size"):void 0},d=function(e,t){const o=Object.keys(e),i=Object.values(e);for(let e=0;e<o.length;e++)if(i[e])return c(o[e],t);return""},u=function(e){return"https://graphdb.ontotext.com/documentation/"+e.productShortVersion},p=function(e){return e.getLocations().then(e=>e.filter(e=>!e.errorMsg&&!e.degradedReason))};function f(e,t,o,r,a,s,l,c,d,u,p,f,m){e.loader=!0,e.isLocationInactive=function(t){return!t.active||!e.hasActiveLocation()};const v=f.defer();function y(){return a.getLocations(v).then(t=>{e.locations=t}).finally(()=>e.loader=!1)}e.hasActiveLocation=function(){return a.hasActiveLocation()},e.getActiveLocation=function(){return a.getActiveLocation()},e.getLocationError=function(){return a.getLocationError()},e.getDegradedReason=function(){return a.getDegradedReason()},e.getRepositories=function(){return a.getRepositories()},e.isRepoActive=function(e){return a.isRepoActive(e)},e.deleteLocation=function(t){s.openSimpleModal({title:p.instant("location.confirm.detach"),message:p.instant("location.confirm.detach.warning",{uri:t}),warning:!0}).result.then((function(){e.loader=!0,a.deleteLocation(t).finally(()=>y())}))},e.addLocationHttp=function(t){e.loader=!0,c.addLocation(t).success((function(){a.init()})).error((function(e){const t=getError(e);r.error(t,p.instant("common.error"))})).finally(()=>y())},e.addLocation=function(){o.open({templateUrl:"js/angular/templates/modal/add-location.html",windowClass:"addLocationDialog",controller:"AddLocationCtrl"}).result.then((function(t){e.addLocationHttp(t)}))},e.editLocationHttp=function(t){e.loader=!0,c.editLocation(t).success((function(){a.init()})).error((function(e){const t=getError(e);r.error(t,p.instant("common.error"))})).finally(()=>y())},e.editLocation=function(t){o.open({templateUrl:"js/angular/templates/modal/edit-location.html",controller:"EditLocationCtrl",resolve:{location:function(){return t}}}).result.then((function(t){e.editLocationHttp(t)}),(function(){}))},e.setRepository=function(e){a.setRepository(e)},e.deleteRepository=function(t){s.openSimpleModal({title:p.instant("common.confirm.delete"),message:Object(n.decodeHTML)(p.instant("delete.repo.warning.msg",{repositoryId:t.id})),warning:!0}).result.then((function(){e.loader=!0,a.deleteRepository(t).finally(()=>{y(),e.loader=!1}),function(e){const t="dependencies-selectedGraph-"+e.id,o="classHierarchy-selectedGraph-"+e.id;angular.forEach(d.keys(),(function(e){(e.startsWith(o)||e.startsWith(t))&&d.remove(e)}))}(t)}))},e.restartRepository=function(t){s.openSimpleModal({title:p.instant("confirm.restart.repo"),message:Object(n.decodeHTML)(p.instant("confirm.restart.repo.warning.msg",{repositoryId:t.id})),warning:!0}).result.then((function(){e.loader=!0,a.restartRepository(t).finally(()=>y())}))},e.toggleDefaultRepository=function(t){e.getDefaultRepository()===t?a.setDefaultRepository(null):a.setDefaultRepository(t)},e.getDefaultRepository=function(){return a.getDefaultRepository()},e.getRepositoryDownloadLink=function(e){let t=`rest/repositories/${e.id}${e.type===i.REPOSITORY_TYPES.ontop?"/download-zip":"/download-ttl"}?location=${e.location}`;const o=l.getAuthToken();return o&&(t=`${t}&authToken=${encodeURIComponent(o)}`),t},e.copyToClipboard=function(e){s.openCopyToClipboardModal(e)},e.fromFile=function(){o.open({templateUrl:"js/angular/templates/modal/upload-repository-config.html",controller:"UploadRepositoryConfigCtrl"}).result.then((function(){a.init()}))},e.openActiveLocationSettings=function(){o.open({templateUrl:"js/angular/settings/modal/location-settings.html",controller:"ActiveLocationSettingsCtrl"})},y();const R=u((function(){m.isActive()&&!t.guidePaused||(a.initQuick(),y())}),5e3);e.$on("$destroy",(function(){u.cancel(R),v&&v.resolve()})),e.getRepositoriesFromLocation=function(e){return a.getRepositoriesFromLocation(e)}}function m(e,t,o,i,n){e.upload=function(t){t&&t.length&&(e.uploadFile=t[0])},e.ok=function(){e.uploadFile&&(e.uploadFileLoader=!0,o.upload({url:"rest/repositories",method:"POST",data:{config:e.uploadFile}}).success((function(){e.uploadFileLoader=!1,t.close()})).error((function(t){const o=getError(t);i.error(o,n.instant("common.error")),e.uploadFileLoader=!1})))},e.cancel=function(){t.dismiss("cancel")}}function v(e,t,o,i,n){e.newLocation={uri:"",authType:"none",username:"",password:"",active:!1},e.docBase=u(i),e.isValidLocation=function(){return(e.newLocation.uri.length<6||0===e.newLocation.uri.indexOf("http:")||0===e.newLocation.uri.indexOf("https:"))&&e.newLocation.uri.indexOf("/repositories")<=-1},e.ok=function(){e.newLocation?t.close(e.newLocation):o.error(n.instant("location.cannot.be.empty.error"))},e.cancel=function(){t.dismiss("cancel")}}function y(e,t,o,i){e.editedLocation=angular.copy(o),e.docBase=u(i),e.ok=function(){t.close(e.editedLocation)},e.cancel=function(){t.dismiss("cancel")}}function R(e,t){e.repositoryTypes=i.REPOSITORY_TYPES,e.chooseRepositoryType=function(e){t.path(`${t.path()}/${e}`)}}function T(e,t,o,n,r,c,u,f,m){var v;e.rulesets=i.STATIC_RULESETS.slice(),e.repositoryTypes=i.REPOSITORY_TYPES,e.params=u,e.repositoryType=u.repositoryType,e.enable=!0,e.loader=!0,e.pageTitle=m.instant("view.create.repo.title"),e.repositoryInfo={id:"",params:{},title:"",type:"",location:""},e.invalidValues={isInvalidQueryTimeout:!1,isInvalidQueryLimit:!1,isInvalidLeftJoinWorkerThreads:!1,isInvalidBoundJoinBlockSize:!1,isInvalidJoinWorkerThreads:!1,isInvalidUnionWorkerThreads:!1,isInvalidValidationResultsLimitPerConstraint:!1,isInvalidValidationResultsLimitTotal:!1},p(o).then(t=>{e.locations=t}),e.changedLocation=function(){e.$broadcast("changedLocation")},e.getConfig=function(o){f.getRepositoryConfiguration(o).success((function(t){var o;e.repositoryInfo.params=t.params,e.repositoryInfo.type=t.type,a(e.repositoryInfo.params),(o=e.repositoryInfo.params)&&o.member&&(o.member.value=[]),e.loader=!1,r((function(){angular.element(document).find("#id").focus()}),50)})).error((function(o){const i=getError(o);t.error(i,m.instant("common.error")),e.loader=!1}))},e.repositoryType&&(function(t){return e.isEnterprise()&&t===i.REPOSITORY_TYPES.graphdbRepo}(v=e.repositoryType)||function(t){return!e.isFreeEdition()&&!e.isEnterprise()&&t===i.REPOSITORY_TYPES.graphdbRepo}(v)||function(t){return e.isFreeEdition()&&t===i.REPOSITORY_TYPES.graphdbRepo}(v)||function(e){return e===i.REPOSITORY_TYPES.ontop}(v)||function(e){return e===i.REPOSITORY_TYPES.fedx}(v))?(e.repositoryInfo.type=e.repositoryType,e.getConfig(e.repositoryType),function(t){switch(t){case i.REPOSITORY_TYPES.graphdbRepo:e.pageTitle=m.instant("view.create.repo.title",{repoType:"GraphDB"});break;case i.REPOSITORY_TYPES.ontop:e.pageTitle=m.instant("view.create.repo.title",{repoType:"Ontop Virtual SPARQL"});break;case i.REPOSITORY_TYPES.fedx:e.pageTitle=m.instant("view.create.repo.title",{repoType:"FedX Virtual SPARQL"})}}(e.repositoryType)):n.path("/repository/create"),e.hasActiveLocation=function(){return o.hasActiveLocation()},e.activeLocation=function(){return o.getActiveLocation()};let y=!1;e.uploadRuleset=function(o){o&&o.length&&(e.uploadFile=o[0],e.uploadFileLoader=!0,c.upload({url:"rest/repositories/ruleset/upload",data:{ruleset:e.uploadFile,location:e.repositoryInfo.location}}).progress((function(e){})).success((function(o){if(o.success){const t=e.uploadFile.name,i={id:o.fileLocation,name:"Custom: "+t};e.rulesetPie?e.rulesets[0]=i:e.rulesets.unshift(i),e.rulesetPie=o.fileLocation,e.rulesetPieFile=t,e.repositoryInfo.params.ruleset.value=e.rulesetPie}else t.error(o.errorMessage),y=!0;e.uploadFileLoader=!1})).error((function(o){const i=getError(o);t.error(i,m.instant("common.error")),e.uploadFile="",e.uploadFileLoader=!1})))},e.noMembersError=function(){t.error(m.instant("fedx.create.repo.no.members.warning"))},e.goBackToPreviousLocation=function(){angular.isDefined(u.previous)?(delete n.$$search.previous,n.path("/")):n.path("/repository")},e.createRepoHttp=function(){e.loader=!0,f.createRepository(e.repositoryInfo).then((function(){t.success(m.instant("created.repo.success.msg",{repoId:e.repositoryInfo.id})),o.init()})).catch((function(e){const o=getError(e.data);t.error(o,m.instant("common.error"))})).finally(()=>{e.loader=!1,e.goBackToPreviousLocation()})},e.createRepo=function(){if(!e.repositoryInfo.id)return void t.error(m.instant("empty.repoid.warning"));e.isInvalidRepoName=!i.FILENAME_PATTERN.test(e.repositoryInfo.id),l(e.repositoryInfo.params,e.invalidValues);const o=d(e.invalidValues,m);y?t.error(m.instant("invalid.ruleset.file.error")):e.isInvalidRepoName?t.error(m.instant("wrong.repo.name.error")):"fedx"===e.repositoryType&&0===e.repositoryInfo.params.member.value.length?e.noMembersError():o?t.error(o):e.createRepoHttp()},e.rulesetWarning=function(){const t=e.repositoryInfo.params;return void 0===t||void 0===t.ruleset||void 0===t.disableSameAs?"":0===t.ruleset.value.indexOf("owl")&&"true"===t.disableSameAs.value?m.instant("repoTooltips.rulesetWarnings.needsSameAs"):0===t.ruleset.value.indexOf("rdfs")&&"false"===t.disableSameAs.value?m.instant("repoTooltips.rulesetWarnings.doesntNeedSameAs"):t.ruleset.value===e.rulesetPie?m.instant("repoTooltips.rulesetWarnings.customRuleset"):""},e.validateNumberInput=function(){l(e.repositoryInfo.params,e.invalidValues)},e.getShaclOptionsClass=function(){return s()},e.autofocusId="autofocus"}function g(e,t,o,i,n,r){i&&o.getRepositoryFileContent(i).success((function(t){e.fileContent=t})).error((function(e){const t=getError(e);n.error(t,r.instant("common.error"))})),e.ok=function(){t.close({content:e.fileContent,fileLocation:i})},e.cancel=function(){t.dismiss("cancel")}}function I(e,t,o,c,u,f,m,v){e.rulesets=i.STATIC_RULESETS.slice(),e.repositoryTypes=i.REPOSITORY_TYPES,e.editRepoPage=!0,e.canEditRepoId=!1,e.params=t,e.loader=!0,e.repositoryInfo={},e.repositoryInfo.id=e.params.repositoryId,e.repositoryInfo.location=e.params.location,e.repositoryInfo.restartRequested=!1,e.repositoryType="",e.saveRepoId=e.params.repositoryId,e.pageTitle=v.instant("view.edit.repo.title",{repositoryId:e.params.repositoryId}),e.invalidValues={isInvalidQueryTimeout:!1,isInvalidQueryLimit:!1,isInvalidLeftJoinWorkerThreads:!1,isInvalidBoundJoinBlockSize:!1,isInvalidJoinWorkerThreads:!1,isInvalidUnionWorkerThreads:!1,isInvalidValidationResultsLimitPerConstraint:!1,isInvalidValidationResultsLimitTotal:!1},e.hasActiveLocation=function(){return c.hasActiveLocation()},e.$watch(e.hasActiveLocation,(function(){e.hasActiveLocation&&p(c).then(t=>(e.locations=t,m.getRepository(e.repositoryInfo))).then((function(t){const o=t.data;if(angular.isDefined(o.params.ruleset)){let t=!1;if(angular.forEach(e.rulesets,(function(e){e.id===o.params.ruleset.value&&(t=!0)})),o.params.ruleset&&!t){const t=r(o.params.ruleset.value);e.rulesets.unshift({id:o.params.ruleset.value,name:"Custom: "+t})}}e.repositoryInfo=o,e.setRepositoryType(o.type),a(e.repositoryInfo.params),e.repositoryInfo.saveId=e.saveRepoId,e.loader=!1})).catch((function(i){const r=i.data,a=i.status,s=t.repositoryId;let l;l=404===a&&"system"!==s?Object(n.decodeHTML)(v.instant("edit.repo.error.not.exists",{repositoryId:s})):404===a&&"system"===s?Object(n.decodeHTML)(v.instant("edit.system.repo.warning")):getError(r),o.error(l,v.instant("common.error"),{allowHtml:!0}),404===a?setTimeout((function(){e.loader=!1,u.path("repository")}),1e3):e.loader=!1}))})),e.setRepositoryType=function(t){e.repositoryType=t},e.noMembersError=function(){o.error(v.instant("fedx.create.repo.no.members.warning"))},e.editRepoHttp=function(){e.loader=!0,m.editRepository(e.repositoryInfo.saveId,e.repositoryInfo).success((function(){o.success(v.instant("edit.repo.success.msg",{saveId:e.repositoryInfo.saveId})),c.init().finally(()=>e.goBackToPreviousLocation()),e.repositoryInfo.saveId===e.repositoryInfo.id&&e.repositoryInfo.restartRequested&&c.restartRepository(e.repositoryInfo)})).error((function(t){const i=getError(t);o.error(i,v.instant("common.error")),e.loader=!1}))},e.editRepository=function(){e.isInvalidRepoName=!i.FILENAME_PATTERN.test(e.repositoryInfo.id),l(e.repositoryInfo.params,e.invalidValues);const t=d(e.invalidValues,v);let r=Object(n.decodeHTML)(v.instant("edit.repo.save.changes.msg",{repoId:e.repositoryInfo.id}));e.repositoryInfo.saveId!==e.repositoryInfo.id?r+=Object(n.decodeHTML)(v.instant("edit.repo.rename.changes.msg")):e.repositoryInfo.restartRequested?r+=Object(n.decodeHTML)(v.instant("edit.repo.restart.requested.msg")):r+=Object(n.decodeHTML)(v.instant("edit.repo.restart.needed.msg")),e.isInvalidRepoName?o.error(v.instant("wrong.repo.name.error")):"fedx"===e.repositoryType&&0===e.repositoryInfo.params.member.value.length?e.noMembersError():t?o.error(t):f.openSimpleModal({title:v.instant("common.confirm.save"),message:r,warning:!0}).result.then((function(){e.editRepoHttp()}))},e.editRepositoryId=function(){let t=Object(n.decodeHTML)(v.instant("edit.repo.id.warning.msg"));e.isEnterprise()&&(t+=Object(n.decodeHTML)(v.instant("edit.repo.id.cluster.warning.msg"))),f.openSimpleModal({title:v.instant("confirm.enable.edit"),message:t,warning:!0}).result.then((function(){e.canEditRepoId=!0}))},e.goBackToPreviousLocation=function(){angular.isDefined(t.previous)?(delete u.$$search.previous,u.path("/")):u.path("/repository")},e.validateNumberInput=function(){l(e.repositoryInfo.params,e.invalidValues)},e.getShaclOptionsClass=function(){return s()}}angular.module("graphdb.framework.repositories.controllers",["ngCookies","ui.bootstrap","graphdb.framework.core.services.repositories","graphdb.framework.utils.localstorageadapter","toastr","ngFileUpload"]).controller("LocationsAndRepositoriesCtrl",f).controller("AddLocationCtrl",v).controller("EditLocationCtrl",y).controller("ChooseRepositoryCtrl",R).controller("AddRepositoryCtrl",T).controller("EditRepositoryCtrl",I).controller("EditRepositoryFileCtrl",g).controller("UploadRepositoryConfigCtrl",m),f.$inject=["$scope","$rootScope","$modal","toastr","$repositories","ModalService","$jwtAuth","LocationsRestService","LocalStorageAdapter","$interval","$translate","$q","GuidesService"],m.$inject=["$scope","$modalInstance","Upload","toastr","$translate"],v.$inject=["$scope","$modalInstance","toastr","productInfo","$translate"],y.$inject=["$scope","$modalInstance","location","productInfo"],R.$inject=["$scope","$location"],T.$inject=["$scope","toastr","$repositories","$location","$timeout","Upload","$routeParams","RepositoriesRestService","$translate"],g.$inject=["$scope","$modalInstance","RepositoriesRestService","file","toastr","$translate"],I.$inject=["$scope","$routeParams","toastr","$repositories","$location","ModalService","RepositoriesRestService","$translate"]}}]);
//# sourceMappingURL=5.5f48e5c6fc10b52dd415.bundle.js.map