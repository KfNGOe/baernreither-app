{"version":3,"sources":["webpack:///./src/js/angular/clustermanagement/cluster-drawing.service.js"],"names":["clusterColors","ontoOrange","ontoBlue","ontoGreen","ontoGrey","createClusterSvgElement","element","d3","select","append","createClusterZone","parent","clusterZone","classed","style","setCreateClusterZone","hasCluster","translationsMap","selectAll","remove","textGroup","attr","text","no_cluster_configured","create_cluster_btn","updateClusterZoneLabels","moveElement","x","y","createNodes","nodesDataBinding","nodeRadius","isLegend","nodeGroup","enter","radius","_s32","Math","sqrt","points","data","svg","line","createHexagon","exit","nodeElements","nodeTextHost","addHostnameToNodes","updateNodes","nodes","getNodeIconType","updateNodesIcon","node","nodeState","LEADER","FOLLOWER","CANDIDATE","updateNodesClasses","each","d","labelNode","this","hostname","getBBox","width","height","updateNodesHostnameText","NO_CONNECTION","OUT_OF_SYNC","READ_ONLY","RESTRICTED","createLinks","linksDataBinding","updateLinks","setLinkColor","setLinkStyle","link","source","find","address","target","deltaX","deltaY","dist","normX","normY","sourceX","sourceY","targetX","targetY","getLinkCoordinates","status","IN_SYNC","SYNCING","positionNodesOnClusterZone","clusterZoneX","clusterZoneY","clusterZoneRadius","index","theta","PI","length","cos","sin"],"mappings":"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","file":"58.adae288a0e1c69358c39.bundle.js","sourcesContent":["import {LinkState, NodeState} from \"./controllers\";\n\nexport const clusterColors = {\n    ontoOrange: 'var(--onto-orange)',\n    ontoBlue: 'var(--onto-blue)',\n    ontoGreen: 'var(--onto-green)',\n    ontoGrey: 'var(--onto-grey)'\n};\n\nexport function createClusterSvgElement(element) {\n    return d3.select(element)\n        .append('svg');\n}\n\nexport function createClusterZone(parent) {\n    const clusterZone = parent.append('g');\n    clusterZone\n        .append(\"circle\")\n        .classed('cluster-zone', true)\n        .style('fill', 'transparent')\n        .style('stroke-width', '2');\n    return clusterZone;\n}\n\nexport function setCreateClusterZone(hasCluster, clusterZone, translationsMap) {\n    clusterZone\n        .select('.cluster-zone')\n        .classed('no-cluster', !hasCluster);\n\n    if (hasCluster) {\n        clusterZone.selectAll('#no-cluster-zone').remove();\n    } else {\n        const textGroup = clusterZone\n            .append('g')\n            .attr(\"id\", \"no-cluster-zone\");\n        textGroup\n            .append('text')\n            .attr('id', 'no-cluster-label')\n            .text(translationsMap.no_cluster_configured || 'No cluster group configured')\n            .attr('y', -50)\n            .classed('h2', true)\n            .style('text-anchor', \"middle\");\n        textGroup.append('text')\n            .attr('id', 'create-cluster-label')\n            .classed('h3', true)\n            .text(translationsMap.create_cluster_btn || 'Click here to create a cluster')\n            .style('text-anchor', \"middle\");\n        textGroup.append('text')\n            .attr('y', 130)\n            .attr('class', 'icon-any repo')\n            .attr('fill', clusterColors.ontoOrange)\n            .style('text-anchor', \"middle\")\n            .classed('settings-icon', true)\n            .text(\"\\ue92b\");\n    }\n}\n\nexport function updateClusterZoneLabels(hasCluster, clusterZone, translationsMap) {\n    if (hasCluster) {\n        return;\n    }\n    clusterZone.select('#no-cluster-zone #no-cluster-label')\n        .text(translationsMap.no_cluster_configured);\n    clusterZone.select('#no-cluster-zone #create-cluster-label')\n        .text(translationsMap.create_cluster_btn);\n}\n\nexport function moveElement(element, x, y) {\n    element.attr('transform', () => {\n        return `translate(${x}, ${y})`;\n    });\n}\n\nexport function createNodes(nodesDataBinding, nodeRadius, isLegend) {\n    const nodeGroup = nodesDataBinding.enter()\n        .append('g')\n        .attr('id', 'node-group')\n        .classed('legend', isLegend);\n\n    createHexagon(nodeGroup, nodeRadius);\n    nodesDataBinding.exit().remove();\n\n    nodeGroup\n        .append('text')\n        .attr('class', 'icon-any node-icon');\n\n    addHostnameToNodes(nodeGroup, nodeRadius, isLegend);\n}\n\nfunction addHostnameToNodes(nodeElements, nodeRadius, isLegend) {\n    const nodeTextHost = nodeElements.append('g');\n\n    if (isLegend) {\n        nodeTextHost.append('foreignObject')\n            .attr('y', nodeRadius)\n            .attr('x', -nodeRadius)\n            .attr('width', nodeRadius * 2)\n            .attr('height', 10)\n            .attr('class', 'label-wrapper')\n            .append('xhtml:div')\n            .attr('class', 'id id-host');\n    } else {\n        nodeTextHost\n            .append('rect')\n            .attr('class', 'id-host-background')\n            .attr('rx', 6);\n\n        nodeTextHost\n            .append('text')\n            .attr('y', nodeRadius + 10)\n            .attr('class', 'id id-host')\n            .style('text-anchor', 'middle');\n    }\n}\n\nexport function updateNodes(nodes) {\n    updateNodesIcon(nodes);\n    updateNodesClasses(nodes);\n    updateNodesHostnameText(nodes);\n}\n\nfunction updateNodesClasses(nodes) {\n    nodes\n        .select('.node.member')\n        .classed('leader', (node) => node.nodeState === NodeState.LEADER)\n        .classed('follower', (node) => node.nodeState === NodeState.FOLLOWER)\n        .classed('candidate', (node) => node.nodeState === NodeState.CANDIDATE)\n        .classed('other', (node) => {\n            return node.nodeState !== NodeState.LEADER &&\n                node.nodeState !== NodeState.FOLLOWER &&\n                node.nodeState !== NodeState.CANDIDATE;\n        });\n}\n\nfunction updateNodesIcon(nodes) {\n    nodes\n        .select('.icon-any.node-icon')\n        .text(getNodeIconType);\n}\n\nfunction getNodeIconType(node) {\n    if (node.nodeState === NodeState.LEADER) {\n        return '\\ue935';\n    } else if (node.nodeState === NodeState.FOLLOWER) {\n        return '\\ue963';\n    } else if (node.nodeState === NodeState.CANDIDATE) {\n        return '\\ue914';\n    } else if (node.nodeState === NodeState.NO_CONNECTION) {\n        return '\\ue931';\n    } else if (node.nodeState === NodeState.OUT_OF_SYNC) {\n        return '\\ue920';\n    } else if (node.nodeState === NodeState.READ_ONLY) {\n        return '\\ue95c';\n    } else if (node.nodeState === NodeState.RESTRICTED) {\n        return '\\ue933';\n    }\n    return '';\n}\n\nfunction updateNodesHostnameText(nodes) {\n    nodes\n        .select('.id.id-host')\n        .each(function (d) {\n            d.labelNode = this;\n        })\n        .text(function (d) {\n            return d.hostname;\n        });\n\n    // Add padding styling to text background. left/right +5. top/bottom +1\n    nodes\n        .select('.id-host-background')\n        .attr('width', function (d) {\n            return d3.select(d.labelNode).node().getBBox().width + 10;\n        })\n        .attr('height', function (d) {\n            return d3.select(d.labelNode).node().getBBox().height + 2;\n        })\n        .attr('x', function (d) {\n            return d3.select(d.labelNode).node().getBBox().x - 5;\n        })\n        .attr('y', function (d) {\n            return d3.select(d.labelNode).node().getBBox().y - 1;\n        })\n        .attr('fill', '#EEEEEE');\n}\n\nexport function createLinks(linksDataBinding) {\n    linksDataBinding.enter()\n        .append('path')\n        .classed('link', true);\n\n    linksDataBinding.exit().remove();\n}\n\nexport function updateLinks(linksDataBinding, nodes) {\n    linksDataBinding\n        .attr('stroke', setLinkColor)\n        .style('stroke-dasharray', setLinkStyle)\n        .attr('d', (link) => getLinkCoordinates(link, nodes));\n}\n\nexport function setLinkColor(link) {\n    if (link.status === LinkState.IN_SYNC || link.status === LinkState.SYNCING) {\n        return clusterColors.ontoGreen;\n    } else if (link.status === LinkState.OUT_OF_SYNC) {\n        return clusterColors.ontoGrey;\n    }\n    return 'none';\n}\n\nexport function setLinkStyle(link) {\n    if (link.status === LinkState.OUT_OF_SYNC || link.status === LinkState.SYNCING) {\n        return '10 10';\n    }\n    return 'none';\n}\n\nfunction getLinkCoordinates(link, nodes) {\n    const source = nodes.find((node) => node.address === link.source);\n    const target = nodes.find((node) => node.address === link.target);\n\n    const deltaX = target.x - source.x;\n    const deltaY = target.y - source.y;\n    const dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n    const normX = deltaX / dist;\n    const normY = deltaY / dist;\n\n    // Padding from node center point\n    const sourcePadding = 55;\n    const targetPadding = 55;\n    const sourceX = source.x + (sourcePadding * normX);\n    const sourceY = source.y + (sourcePadding * normY);\n    const targetX = target.x - (targetPadding * normX);\n    const targetY = target.y - (targetPadding * normY);\n    return 'M' + sourceX + ',' + sourceY + 'L' + targetX + ',' + targetY;\n}\n\nexport function positionNodesOnClusterZone(nodes, clusterZoneX, clusterZoneY, clusterZoneRadius) {\n    nodes\n        .attr('transform', (node, index) => {\n            // Calculate initial positions for the new nodes based on\n            // spreading them evenly on a circle around the center of the page.\n            const theta = 2 * Math.PI * index / nodes[0].length;\n            var x = clusterZoneX + Math.cos(theta) * clusterZoneRadius;\n            var y = clusterZoneY + Math.sin(theta) * clusterZoneRadius;\n            node.x = x;\n            node.y = y;\n            return `translate(${x}, ${y})`;\n        });\n}\n\nfunction createHexagon(nodeGroup, radius) {\n    const _s32 = (Math.sqrt(3) / 2);\n    const xDiff = 0;\n    const yDiff = 0;\n    const points = [[radius + xDiff, yDiff], [radius / 2 + xDiff, radius * _s32 + yDiff], [-radius / 2 + xDiff, radius * _s32 + yDiff],\n        [-radius + xDiff, yDiff],\n        [-radius / 2 + xDiff, -radius * _s32 + yDiff], [radius / 2 + xDiff, -radius * _s32 + yDiff], [radius + xDiff, yDiff],\n        [radius / 2 + xDiff, radius * _s32 + yDiff]];\n    return nodeGroup\n        .selectAll(\"path.area\")\n        .data([points])\n        .enter()\n        .append(\"path\")\n        .attr('class', 'node member')\n        .attr(\"d\", d3.svg.line());\n}\n"],"sourceRoot":""}