{"version":3,"sources":["webpack:///./src/js/angular/rest/connectors.rest.service.js","webpack:///./src/js/angular/externalsync/controllers.js"],"names":["angular","module","factory","ConnectorsRestService","$inject","$http","getConnectors","get","initConnector","prefix","hasConnector","checkConnector","data","post","headers","jsonToFormData","str","Object","keys","forEach","key","push","encodeURIComponent","join","fromArrayMap","arrayMap","$translate","_","reduce","acc","value","Error","instant","hasOwnProperty","mapCreateValuesToUiValues","values","options","i","length","option","__type","__name","j","__childOptions","child","k","valueK","isDefined","__defaultValue","optionEl","isUndefined","map","String","toJson","_evaluateSparqlQuery","http","repository","query","buildNamePrefix","substring","createConnectorQuery","name","fields","reportError","fcopy","sortObject","obj","newObject","each","childOption","copy","fromJson","e","__label","message","removeEmptyValues","Array","isArray","filter","item","trim","finalString","replace","ConnectorsCtrl","$scope","$repositories","$modal","toastr","ModalService","$q","RDF4JRepositoriesRestService","resetProgress","repair","beingBuiltConnector","percentDone","status","processedEntities","estimatedEntities","indexedEntities","entitiesPerSecond","actionName","waitOnRepairStartOnce","eta","inline","iri","openProgressModal","$","extend","doneCallback","modalInstance","dismiss","open","templateUrl","controller","size","backdrop","scope","executeCreate","connector","errorCallback","modal","addStatements","getActiveRepository","update","then","res","existing","success","err","error","getError","finally","loader","controllers","definitions","getLoaderMessage","timeSeconds","Date","now","loaderStartTime","timeHuman","getHumanReadableSeconds","progressMessage","extraMessage","setLoader","isRunning","isLicenseValid","canWriteActiveRepo","connectors","all","connectorIris","createStatusQueryForAny","evaluateSparqlQuery","results","bindings","statusObject","JSON","parse","console","parseFirstBuildingResult","d","split","catch","getOptions","isEmpty","isObject","toPrettyJson","$watch","getActiveLocation","copyConnector","newValues","resolve","result","skipConversion","newConnector","inst","type","openSimpleModal","title","warning","delete","isExternal","indexOf","popoverMsg","force","namePrefix","deleteConnectorQuery","viewQuery","DeleteConnectorCtrl","$modalInstance","ok","close","cancel","ExtendNewConnectorCtrl","toQuery","label","addField","index","optionName","newField","defaultValues","splice","addOption","array","deleteOption","addMapOption","deleteMapOption","form","$valid","CreateConnectorCtrl","$controller","this","CreateProgressCtrl","$interval","initProgress","statusIri","createStatusQueryForIri","progressInterval","getFirstStatusFromResult","toFixed","etaSeconds","$on","input","Math","ceil"],"mappings":"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","file":"38.f4b561d7ee5b236ba481.bundle.js","sourcesContent":["angular\n    .module('graphdb.framework.rest.connectors.service', [])\n    .factory('ConnectorsRestService', ConnectorsRestService);\n\nConnectorsRestService.$inject = ['$http'];\n\nconst CONNECTORS_ENDPOINT = 'rest/connectors';\n\nfunction ConnectorsRestService($http) {\n\n    return {\n        getConnectors,\n        initConnector,\n        hasConnector,\n        checkConnector\n    };\n\n    function getConnectors() {\n        return $http.get(CONNECTORS_ENDPOINT);\n    }\n\n    function initConnector(prefix) {\n        return $http.get(`${CONNECTORS_ENDPOINT}/options?prefix=${prefix}`);\n    }\n\n    function hasConnector(prefix) {\n        return $http.get(`${CONNECTORS_ENDPOINT}/existing?prefix=${prefix}`);\n    }\n\n    function checkConnector(data) {\n        return $http.post(`${CONNECTORS_ENDPOINT}/check`, data, {\n            headers: {\n                'Content-Type': 'text/plain'\n            }\n        });\n    }\n}\n","import 'angular/rest/rdf4j.repositories.rest.service';\nimport 'angular/rest/connectors.rest.service';\n\nconst modules = [\n    'graphdb.framework.rest.rdf4j.repositories.service',\n    'graphdb.framework.rest.connectors.service'\n];\n\nangular\n    .module('graphdb.framework.externalsync.controllers', modules)\n    .controller('ConnectorsCtrl', ConnectorsCtrl)\n    .controller('ExtendNewConnectorCtrl', ExtendNewConnectorCtrl)\n    .controller('CreateConnectorCtrl', CreateConnectorCtrl)\n    .controller('CreateProgressCtrl', CreateProgressCtrl)\n    .controller('DeleteConnectorCtrl', DeleteConnectorCtrl)\n    .filter('ceil', ceil);\n\nfunction jsonToFormData(data) {\n    const str = [];\n    Object.keys(data).forEach(function (key) {\n        str.push(encodeURIComponent(key) + '=' + encodeURIComponent(data[key]));\n    });\n    return str.join('&');\n}\n\nfunction toArrayMap(map) {\n    return _.map(map, function (value, key) {\n        return {key: key, value: value};\n    });\n}\n\nfunction fromArrayMap(arrayMap, $translate) {\n    return _.reduce(arrayMap, function (acc, value) {\n        if (value.key === '' && value.value === '') {\n            // empty pair, skip it\n        } else if (value.key === '') {\n            throw new Error($translate.instant('externalsync.empty.value.key.error', {value: value.value}));\n        } else if (acc.hasOwnProperty(value.key)) {\n            throw new Error($translate.instant('externalsync.duplicate.key.error', {key: value.key}));\n        } else {\n            acc[value.key] = value.value;\n        }\n        return acc;\n    }, {});\n}\n\nfunction mapCreateValuesToUiValues(values, options) {\n    for (let i = 0; i < options.length; i++) {\n        const option = options[i];\n        if (option.__type === 'StringArray') {\n            if (!values[option.__name]) {\n                values[option.__name] = [''];\n            }\n        } else if (option.__type === 'OptionArray') {\n            if (!values[option.__name]) { // values has no entry for this option\n                values[option.__name] = [];\n                const optionEl = {};\n                for (let j = 0; j < option.__childOptions.length; j++) {\n                    const child = option.__childOptions[j];\n                    if (child.__type === 'StringArray') {\n                        optionEl[child.__name] = [''];\n                    } else {\n                        optionEl[child.__name] = (!angular.isUndefined(child.__defaultValue) ? child.__defaultValue : '');\n                    }\n                }\n                values[option.__name].push(optionEl);\n            } else { // values already has en entry for this option\n                // Copies the default value for Boolean child options if no explicit value is set\n                for (let j = 0; j < option.__childOptions.length; j++) {\n                    const child = option.__childOptions[j];\n                    if (child.__type === 'Boolean') {\n                        for (let k = 0; k < values[option.__name].length; k++) {\n                            const valueK = values[option.__name][k];\n                            if (!valueK.hasOwnProperty([child.__name]) && angular.isDefined(child.__defaultValue)) {\n                                valueK[child.__name] = child.__defaultValue;\n                            }\n                        }\n                    }\n                }\n            }\n        } else if (option.__type === 'Map') {\n            if (!values[option.__name]) {\n                values[option.__name] = [];\n            } else {\n                values[option.__name] = toArrayMap(values[option.__name]);\n            }\n        } else if (option.__type === 'JsonString') {\n            if (values[option.__name] && !(values[option.__name] instanceof String) && typeof values[option.__name] !== 'string') {\n                values[option.__name] = angular.toJson(values[option.__name], 2);\n            }\n        } else {\n            if (angular.isUndefined(values[option.__name])) {\n                values[option.__name] = (!angular.isUndefined(option.__defaultValue) ? option.__defaultValue : '');\n            }\n        }\n    }\n\n    return values;\n}\n\nfunction _evaluateSparqlQuery(http, repository, query) {\n    return http.post('repositories/' + repository, jsonToFormData({query: query}),\n        {\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded',\n                'Accept': 'application/sparql-results+json',\n                'X-GraphDB-Local-Consistency': 'updating'\n            }\n        });\n}\n\nfunction buildNamePrefix(prefix) {\n    return prefix.substring(0, prefix.length - 1) + '/instance#';\n}\n\nfunction createConnectorQuery(name, prefix, fields, options, reportError) {\n    // Returns a copy of the parameter obj sorted according to the order in options\n    function sortObject(obj, options) {\n        const newObject = {};\n        _.each(options, function (option) {\n            if (angular.isDefined(obj[option.__name])) {\n                if (option.__type === 'OptionArray') {\n                    newObject[option.__name] = [];\n                    _.each(obj[option.__name], function (childOption) {\n                        newObject[option.__name].push(sortObject(childOption, option.__childOptions));\n                    });\n                } else {\n                    newObject[option.__name] = angular.copy(obj[option.__name]);\n                }\n            }\n        });\n        return newObject;\n    }\n\n    const fcopy = sortObject(fields, options);\n\n    for (let i = 0; i < options.length; i++) {\n        try {\n            if (options[i].__type === 'Map') {\n                fcopy[options[i].__name] = fromArrayMap(fcopy[options[i].__name], $translate);\n            } else if (options[i].__type === 'JsonString') {\n                fcopy[options[i].__name] = angular.fromJson(fcopy[options[i].__name]);\n            }\n        } catch (e) {\n            reportError(options[i].__label, e.message);\n            return null;\n        }\n    }\n\n    removeEmptyValues(fcopy);\n    //escapeValues(fields);\n    let finalString = '';\n    finalString += 'PREFIX :<' + prefix + '>\\n';\n    const namePrefix = buildNamePrefix(prefix);\n    finalString += 'PREFIX inst:<' + namePrefix + '>\\n';\n    finalString += 'INSERT DATA {\\n';\n    finalString += \"\\tinst:\" + name + \" :createConnector '''\\n\"; // eslint-disable-line quotes\n    finalString += angular.toJson(fcopy, 2);\n    finalString += \"\\n''' .\\n}\\n\"; // eslint-disable-line quotes\n    finalString = finalString.replace(/\\\\/g, '\\\\\\\\\\\\');\n    return finalString;\n}\n\nfunction createStatusQueryForIri(iri) {\n    const statusIri = iri.replace(/\\/instance#.+$/, '#connectorStatus');\n    let finalString = '';\n    finalString += 'SELECT ?status {\\n';\n    finalString += '\\t<' + iri + '> <' + statusIri + '> ?status';\n    finalString += '\\n}';\n    return finalString;\n}\n\nfunction createStatusQueryForAny(connectors) {\n    const connectorIris = _.map(connectors,\n        function (k) {\n            return '<' + k.value + 'connectorStatus' + '>';\n        }).join('|');\n\n    if (connectorIris) {\n        return 'SELECT ?connector ?status { ?connector ' + connectorIris + ' ?status }';\n    }\n\n    return null;\n}\n\nfunction repairConnectorQuery(name, prefix) {\n    const namePrefix = buildNamePrefix(prefix);\n    return 'PREFIX prefix:<' + prefix + '>\\n' +\n        'INSERT DATA {\\n' +\n        '\\t<' + namePrefix + name + '> prefix:repairConnector \"\"\\n' +\n        '}';\n}\n\nfunction deleteConnectorQuery(name, prefix, force) {\n    const namePrefix = prefix.substring(0, prefix.length - 1) + \"/instance#\";\n    return 'PREFIX prefix:<' + prefix + '>\\n' +\n        'INSERT DATA {\\n' +\n        '\\t<' + namePrefix + name + '> prefix:dropConnector \"' + (force ? \"force\" : \"\") + '\"\\n' +\n        '}';\n}\n\nfunction removeEmptyValues(data) {\n    // remove empty values from array\n    if (Array.isArray(data)) {\n        data = _.filter(data, function (item) {\n            return item !== null && (!item.trim || item.trim() !== '');\n        });\n    }\n    // remove empty values from object values\n    Object.keys(data).forEach(function (key) {\n        if ((data[key] === '' || data[key] == null) && data[key] !== false) {\n            delete data[key];\n        } else if (typeof data[key] === 'object') {\n            data[key] = removeEmptyValues(data[key]);\n        }\n    });\n    return data;\n}\n\nfunction parseFirstBuildingResult(results) {\n    if (results.bindings) {\n        for (let i = 0; i < results.bindings.length; i++) {\n            try {\n                const statusObject = JSON.parse(results.bindings[i].status.value);\n                if (statusObject.status === 'BUILDING') {\n                    return {\n                        connector: results.bindings[i].connector.value,\n                        status: statusObject\n                    };\n                }\n            } catch (e) {\n                console.error(e); // eslint-disable-line no-console\n            }\n        }\n    }\n\n    return {};\n}\n\nConnectorsCtrl.$inject = ['$scope', '$http', '$repositories', '$modal', 'toastr', 'ModalService', '$q', 'RDF4JRepositoriesRestService', 'ConnectorsRestService', '$translate'];\n\nfunction ConnectorsCtrl($scope, $http, $repositories, $modal, toastr, ModalService, $q, RDF4JRepositoriesRestService, ConnectorsRestService, $translate) {\n    $scope.loader = false;\n\n    $scope.controllers = [];\n\n    $scope.existing = {};\n\n    $scope.definitions = {};\n\n    $scope.getLoaderMessage = function () {\n        const timeSeconds = (Date.now() - $scope.loaderStartTime) / 1000;\n        const timeHuman = $scope.getHumanReadableSeconds(timeSeconds);\n        let message = '';\n        if ($scope.progressMessage) {\n            message = $scope.progressMessage + '... ' + timeHuman;\n        } else {\n            message = $translate.instant('common.running.operation', {timeHuman: timeHuman});\n        }\n        if ($scope.extraMessage && timeSeconds > 10) {\n            message += '\\n' + $scope.extraMessage;\n        }\n\n        return message;\n    };\n\n    $scope.setLoader = function (isRunning, progressMessage, extraMessage) {\n        if (isRunning) {\n            $scope.loader = true;\n            $scope.loaderStartTime = Date.now();\n            $scope.progressMessage = progressMessage;\n            $scope.extraMessage = extraMessage;\n        } else {\n            $scope.loader = false;\n            $scope.progressMessage = '';\n            $scope.extraMessage = '';\n        }\n    };\n\n    $scope.initConnector = function (connector) {\n        return ConnectorsRestService.initConnector(encodeURIComponent(connector.value))\n            .then(function (res) {\n                $scope.definitions[connector.key] = res.data;\n\n                return ConnectorsRestService.hasConnector(encodeURIComponent(connector.value))\n                    .then(function (res) {\n                        $scope.existing[connector.key] = res.data;\n\n                    });\n            });\n    };\n\n    $scope.getConnectors = function () {\n        if (!$scope.isLicenseValid()) {\n            return;\n        }\n        if (!$scope.canWriteActiveRepo()) {\n            return;\n        }\n\n        $scope.setLoader(true, $translate.instant('externalsync.fetching.connectors'), $translate.instant('common.extra.message'));\n\n        ConnectorsRestService.getConnectors()\n            .then(function (res) {\n                $scope.connectors = Object.keys(res.data).map(function (key) {\n                    return {key: key, value: res.data[key]};\n                });\n\n                $q.all(_.map($scope.connectors, function (connector) {\n                    return $scope.initConnector(connector);\n                })).finally(function () {\n                    resetProgress();\n\n                    const query = createStatusQueryForAny($scope.connectors);\n\n                    if (query) {\n                        evaluateSparqlQuery(query)\n                            .then(function (res) {\n                                const status = parseFirstBuildingResult(res.data.results);\n                                if (status.connector) {\n                                    // has a building connector, open progress indicator\n                                    const d = status.connector.split(/#/);\n                                    d[0] = d[0].replace(/\\/instance$/, '#');\n                                    showProgress(d[0], d[1]);\n                                }\n                            })\n                            .finally(function () {\n                                $scope.setLoader(false);\n                            });\n                    } else {\n                        $scope.setLoader(false);\n                    }\n                });\n            }).catch(function (e) {\n                $scope.setLoader(false);\n                toastr.error(getError(e), $translate.instant('externalsync.could.not.get.connectors.error'));\n            });\n\n        $scope.existing = {};\n    };\n\n    $scope.getOptions = function (connector) {\n        return $scope.definitions[connector.key];\n    };\n\n    $scope.isEmpty = function (value) {\n        return angular.isObject(value) && Object.keys(value).length === 0;\n    };\n\n    $scope.toPrettyJson = function (value) {\n        return angular.toJson(value, 2);\n    };\n\n    $scope.$watch(function () {\n        return $repositories.getActiveRepository();\n    }, $scope.getConnectors);\n\n    $scope.$watch(function () {\n        return $repositories.getActiveLocation();\n    }, $scope.getConnectors);\n\n    function evaluateSparqlQuery(query) {\n        return _evaluateSparqlQuery($http, $repositories.getActiveRepository(), query);\n    }\n\n    function resetProgress(repair) {\n        $scope.beingBuiltConnector = {\n            percentDone: 0,\n            status: {\n                processedEntities: 0,\n                estimatedEntities: 0,\n                indexedEntities: 0,\n                entitiesPerSecond: 0\n            },\n            actionName: repair ? $translate.instant('externalsync.repairing') : $translate.instant('externalsync.creating'),\n            waitOnRepairStartOnce: !!repair,\n            eta: '-',\n            inline: false,\n            iri: null\n        };\n    }\n\n    function openProgressModal(prefix, name, repair) {\n        resetProgress(repair);\n\n        $.extend($scope.beingBuiltConnector, {\n            iri: buildNamePrefix(prefix) + name,\n            name: name,\n            inline: false,\n            doneCallback: function () {\n                $scope.beingBuiltConnector.modalInstance.dismiss('cancel');\n            }\n        });\n\n        $scope.beingBuiltConnector.modalInstance = $modal.open({\n            templateUrl: 'pages/connectorProgress.html',\n            controller: 'CreateProgressCtrl',\n            size: 'lg',\n            backdrop: 'static',\n            scope: $scope\n        });\n\n        return $scope.beingBuiltConnector.modalInstance;\n    }\n\n    function showProgress(prefix, name) {\n        resetProgress();\n\n        $.extend($scope.beingBuiltConnector, {\n            iri: buildNamePrefix(prefix) + name,\n            name: name,\n            inline: true,\n            doneCallback: function () {\n                $scope.beingBuiltConnector.inline = false;\n            }\n        });\n    }\n\n    function executeCreate(connector, obj, errorCallback) {\n        const modal = openProgressModal(connector.value, obj.name, false);\n        RDF4JRepositoriesRestService.addStatements($repositories.getActiveRepository(), jsonToFormData({update: obj.query}))\n            .then(function () {\n                ConnectorsRestService.getConnectors().then(function () {\n                    ConnectorsRestService.hasConnector(encodeURIComponent(connector.value)).then(function (res) {\n                        $scope.existing[connector.key] = res.data;\n                    });\n                });\n                toastr.success($translate.instant('created.connector', {name: obj.name}));\n            }, function (err) {\n                toastr.error(getError(err));\n                errorCallback();\n            }).finally(function () {\n                modal.dismiss('cancel');\n            });\n    }\n\n    $scope.copyConnector = function (connector, values) {\n        let newValues;\n        if (!angular.isUndefined(values)) {\n            newValues = angular.copy(values);\n            newValues.name = newValues.name + '-copy';\n        }\n        const modal = $modal.open({\n            templateUrl: 'pages/createConnector.html',\n            controller: 'CreateConnectorCtrl',\n            size: 'lg',\n            backdrop: 'static',\n            resolve: {\n                connector: function () {\n                    return connector;\n                },\n                values: function () {\n                    return angular.isUndefined(newValues) ? {name: '', values: {}} : newValues;\n                },\n                options: function () {\n                    return $scope.getOptions(connector);\n                }\n            }\n        });\n\n        modal.result.then(function (obj) {\n            executeCreate(connector, obj, function () {\n                obj.skipConversion = true;\n                $scope.newConnector(connector, obj);\n            });\n        });\n    };\n\n    $scope.newConnector = function (connector, values) {\n        const modal = $modal.open({\n            templateUrl: 'pages/createConnector.html',\n            controller: 'CreateConnectorCtrl',\n            size: 'lg',\n            backdrop: 'static',\n            resolve: {\n                connector: function () {\n                    return connector;\n                },\n                values: function () {\n                    return angular.isUndefined(values) ? {name: '', values: {}} : values;\n                },\n                options: function () {\n                    return $scope.getOptions(connector);\n                }\n            }\n        });\n\n        modal.result.then(function (obj) {\n            executeCreate(connector, obj, function () {\n                obj.skipConversion = true;\n                $scope.newConnector(connector, obj);\n            });\n        });\n    };\n\n    $scope.repair = function (inst, type) {\n        ModalService.openSimpleModal({\n            title: $translate.instant('externalsync.confirm.repair'),\n            message: $translate.instant('externalsync.repair.warning.msg'),\n            warning: true\n        }).result\n            .then(function () {\n                const modal = openProgressModal(type.value, inst.name, true);\n\n                const query = repairConnectorQuery(inst.name, type.value);\n\n                RDF4JRepositoriesRestService.addStatements($repositories.getActiveRepository(), jsonToFormData({update: query}))\n                    .then(function () {\n                        ConnectorsRestService.getConnectors().then(function () {\n                            ConnectorsRestService.hasConnector(encodeURIComponent(type.value)).then(function (res) {\n                                $scope.existing[type.key] = res.data;\n                            });\n                        });\n                        toastr.success($translate.instant('externalsync.repair.success.msg', {name: inst.name}));\n                    }, function (err) {\n                        toastr.error(getError(err));\n                    }).finally(function () {\n                        modal.dismiss('cancel');\n                    });\n            });\n    };\n\n    $scope.delete = function (inst, type) {\n        const isExternal = type.key.indexOf(\"Elastic\") >= 0 || type.key.indexOf(\"Solr\") >= 0;\n\n        $modal.open({\n            templateUrl: 'js/angular/externalsync/templates/deleteConnector.html',\n            controller: 'DeleteConnectorCtrl',\n            resolve: {\n                popoverMsg: function () {\n                    return isExternal ? $translate.instant('delete.connector.conditional', {type: type.key}) : '';\n                }\n            }\n        }).result\n            .then(function(force) {\n                $scope.setLoader(true, $translate.instant('externalsync.delete.progress.msg', {name: inst.name}),\n                                                $translate.instant('externalsync.extra.message.warning'));\n\n                const query = deleteConnectorQuery(inst.name, type.value, force);\n                RDF4JRepositoriesRestService.addStatements($repositories.getActiveRepository(), jsonToFormData({update: query}))\n                    .then(function () {\n                        ConnectorsRestService.getConnectors().then(function () {\n                            ConnectorsRestService.hasConnector(encodeURIComponent(type.value)).then(function (res) {\n                                $scope.existing[type.key] = res.data;\n                            });\n                        });\n                        if (force) {\n                            toastr.success($translate.instant('externalsync.delete.force.success.msg', {name: inst.name}));\n                            if (isExternal) {\n                                toastr.warning($translate.instant('externalsync.delete.remote.warning', {key: type.key}));\n                            }\n                        } else {\n                            toastr.success($translate.instant('externalsync.delete.success.msg', {name: inst.name}));\n                        }\n                    }, function (err) {\n                        toastr.error(getError(err));\n                    }).finally(function() {\n                        $scope.setLoader(false);\n                    });\n            });\n    };\n\n    $scope.viewQuery = function (connector, inst) {\n        $modal.open({\n            templateUrl: 'pages/viewQuery.html',\n            controller: 'ViewQueryCtrl',\n            resolve: {\n                query: function () {\n                    const options = $scope.getOptions(connector);\n                    return createConnectorQuery(inst.name, connector.value,\n                        mapCreateValuesToUiValues(inst.values, options), options);\n                }\n            }\n        });\n    };\n}\n\nDeleteConnectorCtrl.$inject = ['$scope', '$modalInstance', 'popoverMsg'];\nfunction DeleteConnectorCtrl($scope, $modalInstance, popoverMsg) {\n    $scope.force = false;\n    $scope.popoverMsg = popoverMsg;\n\n    $scope.ok = function () {\n        $modalInstance.close($scope.force);\n    };\n\n    $scope.cancel = function () {\n        $modalInstance.dismiss();\n    };\n}\n\nExtendNewConnectorCtrl.$inject = ['$scope', '$modalInstance', 'connector', '$modal', 'toastr'];\nfunction ExtendNewConnectorCtrl($scope, $modalInstance, connector, $modal, toastr) {\n\n    $scope.connector = connector;\n\n    $scope.addField = function (index, optionName) {\n        const newField = angular.copy($scope.defaultValues[optionName][0]);\n        $scope.values[optionName].splice(index + 1, 0, newField);\n    };\n\n    $scope.addOption = function (index, array) {\n        array.splice(index + 1, 0, '');\n    };\n\n    $scope.deleteOption = function (index, array) {\n        array.splice(index, 1);\n    };\n\n    $scope.addMapOption = function (index, array) {\n        array.splice(index + 1, 0, {key: '', value: ''});\n    };\n\n    $scope.deleteMapOption = function (index, array) {\n        array.splice(index, 1);\n    };\n\n    function toQuery() {\n        return createConnectorQuery($scope.name, connector.value, $scope.values, $scope.options,\n            function (label, error) {\n                toastr.error(error, label);\n            });\n    }\n\n    $scope.ok = function () {\n        if ($scope.form.$valid) {\n            const query = toQuery();\n\n            if (query) {\n                $modalInstance.close({name: $scope.name, values: $scope.values, options: $scope.options, query: query});\n            }\n        }\n    };\n\n    $scope.viewQuery = function () {\n        const query = toQuery();\n\n        if (query) {\n            $modal.open({\n                templateUrl: 'pages/viewQuery.html',\n                controller: 'ViewQueryCtrl',\n                resolve: {\n                    query: function () {\n                        return query;\n                    }\n                }\n            });\n        }\n    };\n\n    $scope.cancel = function () {\n        $modalInstance.dismiss('cancel');\n    };\n}\n\nCreateConnectorCtrl.$inject = ['$scope', '$controller', '$http', '$modalInstance', 'connector', '$modal', 'values', 'options'];\n\nfunction CreateConnectorCtrl($scope, $controller, $http, $modalInstance, connector, $modal, values, options) {\n    angular.extend(this, $controller('ExtendNewConnectorCtrl', {\n        $scope: $scope,\n        $modalInstance: $modalInstance,\n        connector: connector,\n        $modal: $modal\n    }));\n    $scope.values = values.values;\n    $scope.options = options;\n    $scope.name = values.name;\n    if (!values.skipConversion) {\n        $scope.values = mapCreateValuesToUiValues($scope.values, $scope.options);\n    }\n    $scope.defaultValues = angular.copy($scope.values);\n}\n\n// Note that this is a fancy controller: it's used both for a modal and for a directive.\n// This means you can't rely on custom injection through resolve in the modal and the scope\n// must be shared with the main connectors controller.\nCreateProgressCtrl.$inject = ['$scope', '$interval', '$http', '$repositories', '$translate'];\n\nfunction CreateProgressCtrl($scope, $interval, $http, $repositories, $translate) {\n    function evaluateSparqlQuery(query) {\n        return _evaluateSparqlQuery($http, $repositories.getActiveRepository(), query);\n    }\n\n    function initProgress() {\n        const query = createStatusQueryForIri($scope.beingBuiltConnector.iri);\n\n        // reset iri value so that watch will fire again when we do something with the same connector\n        $scope.beingBuiltConnector.iri = null;\n\n        $scope.progressInterval = $interval(function () {\n            function getFirstStatusFromResult(results) {\n                if (results.bindings) {\n                    if (results.bindings.length > 0) {\n                        try {\n                            return JSON.parse(results.bindings[0].status.value);\n                        } catch (e) {\n                            console.error(e); // eslint-disable-line no-console\n                        }\n                    }\n                }\n\n                return {};\n            }\n\n            evaluateSparqlQuery(query)\n                .then(function (res) {\n                    const status = getFirstStatusFromResult(res.data.results);\n                    if (status.status === 'BUILDING') {\n                        $scope.beingBuiltConnector.status = status;\n                        $scope.beingBuiltConnector.percentDone = (100 * status.processedEntities / status.estimatedEntities).toFixed(0);\n                        $scope.beingBuiltConnector.eta = $scope.getHumanReadableSeconds(status.etaSeconds);\n                        $scope.beingBuiltConnector.actionName = status.repair ? $translate.instant('externalsync.repairing') : $translate.instant('externalsync.creating');\n                        $scope.beingBuiltConnector.waitOnRepairStartOnce = false;\n                    } else if (status.status === 'BUILT' && !$scope.beingBuiltConnector.waitOnRepairStartOnce) {\n                        // done\n                        $interval.cancel($scope.progressInterval);\n                        if ($scope.beingBuiltConnector.doneCallback) {\n                            $scope.beingBuiltConnector.doneCallback();\n                        }\n                    }\n                });\n        }, 1000);\n\n        $scope.$on('$destroy', function () {\n            $interval.cancel($scope.progressInterval);\n        });\n    }\n\n    $scope.beingBuiltConnector = $scope.beingBuiltConnector || {};\n\n    // for modal instance we get the iri before hand and can start progress now\n    if (!$scope.beingBuiltConnector.inline && $scope.beingBuiltConnector.iri) {\n        initProgress();\n    }\n\n    // for inline progress we need to watch for the iri value\n    $scope.$watch('beingBuiltConnector.iri', function (value) {\n        if ($scope.beingBuiltConnector.inline && value) {\n            initProgress();\n        }\n    });\n}\n\nfunction ceil() {\n    return function (input) {\n        return Math.ceil(input);\n    };\n}\n"],"sourceRoot":""}