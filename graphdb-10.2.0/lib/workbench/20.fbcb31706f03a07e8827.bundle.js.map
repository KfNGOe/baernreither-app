{"version":3,"sources":["webpack:///./src/js/lib/d3-tip/d3-tip-patch.js","webpack:///./src/js/lib/common/d3-utils.js","webpack:///./src/js/lib/common/svg-export.js","webpack:///./src/js/lib/common/circle-packing.js","webpack:///./src/js/angular/graphexplore/directives/rdf-class-hierarchy.directive.js"],"names":["direction","offset","html","node","initNode","svg","point","target","customPosition","tip","vis","el","tagName","toLowerCase","ownerSVGElement","createSVGPoint","document","body","appendChild","show","args","Array","prototype","slice","call","arguments","length","SVGElement","pop","coords","content","apply","this","poffset","dir","nodel","getNodeEl","i","directions","scrollTop","documentElement","scrollLeft","customPos","style","opacity","classed","direction_callbacks","get","top","left","hide","attr","n","v","d3","selection","functor","destroy","remove","map","bbox","getScreenBBox","y","offsetHeight","x","offsetWidth","s","e","w","nw","ne","sw","se","keys","select","createElement","position","targetel","event","getScreenCTM","parentNode","matrix","tbbox","getBBox","width","height","matrixTransform","D3","Text","calcFontSizeRaw","text","radius","minimumSize","isMultiline","textSize","substring","match","Math","round","calcFontSize","getTextWithElipsisIfNeeded","str","threshold","Transition","fadeIn","sel","duration","transition","fadeOut","Click","delayDblClick","dispatch","rebind","down","wait","on","mouse","Date","d","a","b","sqrt","pow","window","clearTimeout","dblclick","setTimeout","click","SVG","Export","getCSSRules","cssSourceFilePath","cssRules","$","sheet","rules","cssStr","_","each","value","cssText","generateBase64ImageSource","exportSvg","selectAll","version","xmlns","innerHTML","btoa","unescape","encodeURIComponent","CirclePacking","SingleChild","addPlaceholders","first","children","placeholderSize","size","push","name","removePlaceholders","nodes","splice","centerNodes","reposition","makePositionsRelativeToZero","offsetX","offsetY","classHierarchyDirective","$rootScope","$location","GraphDataRestService","$window","$timeout","$repositories","$licenseService","toastr","ZOOM_DURATION","ROOT_OBJ_NAME","LocalStorageAdapter","LSKeys","$translate","restrict","template","scope","classHierarchyData","flattenedClassNames","selectedClass","currentSliderValue","showClassInfoPanel","showExternalElements","hidePrefixes","currentBrowserLimit","link","element","attrs","pack","layout","diameter","color","scale","linear","domain","range","interpolate","interpolateHcl","insert","appendMainGroup","append","id","transform","getPrefixesState","CLASS_HIERARCHY_HIDE_PREFIXES","prepareForSVGImageExport","imgSrc","href","download","getActiveRepository","autoZoomToPreviousState","doFocus","g","classCount","isSystemRepository","loader","hierarchyError","selGraphFromCache","getClassHierarchyData","contextID","uri","success","response","status","headers","warning","instant","error","getError","oldRoot","focus","rootFocusEvent","classSearchEvent","prefixesWatch","currentClassCountWatch","searchedClassBroadcast","onEnterClassSearchBroadcast","flattenedClassData","drawDiagram","root","config","newFocus","switchPrefixes","view","isInFocusTransitive","bottom","innerHeight","clientY","right","innerWidth","clientX","circleGroup","data","enter","doFade","circle","role","depth","key","noPrefixes","textHidden","zoom","getCurrentClassDataAndMarkSelected","obj","selected","closeClassInfoPanel","uniqBy","clickCancel","$on","history","pushState","$broadcast","stopPropagation","lastTimeWheel","preventDefault","now","getTime","deltaY","__data__","parent","newobj","sortingRank","replaceState","sendSliderData","textSel","idx","indexOf","noPrefixName","r","textContent","keepPrevState","focusOnCurrentClass","focusHistoryId","hash","onpopstate","state","zoomTo","k","fullName","topLevelParentUri","c","adjustRadius","newr","textUpdateStart","display","textUpdateEnd","shouldClosePanel","p","tween","interpolateZoom","t","currentClassCount","CLASS_HIERARCHY_CURRENT_SLIDER_VALUE","set","addEventListener","removeResizeListener","removeEventListener","$watch","initialPrefixesState","angular","copy","newRoot","noPrefixesGlobal","sorted","sort","sortRoot","restoreDiagramState","currentRoot","prefixesConfig","CLASS_HIERARCHY_SWITCH_PREFIXES","redrawFilteredDiagram","sortedRoot","useSlider","addedIds","Set","add","fixChildren","newChildren","has","extend","isUndefined","currentSearchedClass","basicConfig","undefined","savePrefixesState","searchedClass","renderCirclePacking","module","constant","directive","$inject"],"mappings":"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","file":"20.fbcb31706f03a07e8827.bundle.js","sourcesContent":["// d3.tip\n// Copyright (c) 2013 Justin Palmer\n//\n// Tooltips for d3.js SVG visualizations\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module with d3 as a dependency.\n        define([], factory)\n    } else if (typeof module === 'object' && module.exports) {\n        // CommonJS\n        module.exports = function(d3) {\n            d3.tip = factory(d3)\n            return d3.tip\n        }\n    } else {\n        // Browser global.\n        root.d3.tip = factory(root.d3)\n    }\n}(this, function () {\n    // Public - contructs a new tooltip\n    //\n    // Returns a tip\n    return function() {\n        var direction = d3_tip_direction,\n            offset    = d3_tip_offset,\n            html      = d3_tip_html,\n            node      = initNode(),\n            svg       = null,\n            point     = null,\n            target    = null,\n            customPosition = null\n\n        function tip(vis) {\n            svg = getSVGNode(vis)\n            point = svg.createSVGPoint()\n            document.body.appendChild(node)\n        }\n\n        // Public - show the tooltip on the screen\n        //\n        // Returns a tip\n        tip.show = function() {\n            var args = Array.prototype.slice.call(arguments)\n            if(args[args.length - 1] instanceof SVGElement) target = args.pop()\n\n            var content = html.apply(this, args),\n                poffset = offset.apply(this, args),\n                dir     = direction.apply(this, args),\n                nodel   = getNodeEl(),\n                i       = directions.length,\n                coords,\n                scrollTop  = document.documentElement.scrollTop || document.body.scrollTop,\n                scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft,\n                customPos = customPosition.apply(this, args)\n\n            nodel.html(content)\n                .style({ opacity: 1, 'pointer-events': 'all' })\n\n            while(i--) nodel.classed(directions[i], false)\n            coords = direction_callbacks.get(dir).apply(this)\n\n            if (customPos) {\n                nodel.style(customPos)\n            } else {\n                nodel.classed(dir, true).style({\n                    top: (coords.top +  poffset[0]) + scrollTop + 'px',\n                    left: (coords.left + poffset[1]) + scrollLeft + 'px'\n                })\n            }\n\n            return tip\n        }\n\n        // Public - hide the tooltip\n        //\n        // Returns a tip\n        tip.hide = function() {\n            var nodel = getNodeEl()\n            nodel.style({ opacity: 0, 'pointer-events': 'none' })\n            return tip\n        }\n\n        // Public: Proxy attr calls to the d3 tip container.  Sets or gets attribute value.\n        //\n        // n - name of the attribute\n        // v - value of the attribute\n        //\n        // Returns tip or attribute value\n        tip.attr = function(n, v) {\n            if (arguments.length < 2 && typeof n === 'string') {\n                return getNodeEl().attr(n)\n            } else {\n                var args =  Array.prototype.slice.call(arguments)\n                d3.selection.prototype.attr.apply(getNodeEl(), args)\n            }\n\n            return tip\n        }\n\n        // Public: Proxy style calls to the d3 tip container.  Sets or gets a style value.\n        //\n        // n - name of the property\n        // v - value of the property\n        //\n        // Returns tip or style property value\n        tip.style = function(n, v) {\n            if (arguments.length < 2 && typeof n === 'string') {\n                return getNodeEl().style(n)\n            } else {\n                var args =  Array.prototype.slice.call(arguments)\n                d3.selection.prototype.style.apply(getNodeEl(), args)\n            }\n\n            return tip\n        }\n\n        // Public: Set or get the direction of the tooltip\n        //\n        // v - One of n(north), s(south), e(east), or w(west), nw(northwest),\n        //     sw(southwest), ne(northeast) or se(southeast)\n        //\n        // Returns tip or direction\n        tip.direction = function(v) {\n            if (!arguments.length) return direction\n            direction = v == null ? v : d3.functor(v)\n\n            return tip\n        }\n\n        // Public: Sets or gets the offset of the tip\n        //\n        // v - Array of [x, y] offset\n        //\n        // Returns offset or\n        tip.offset = function(v) {\n            if (!arguments.length) return offset\n            offset = v == null ? v : d3.functor(v)\n\n            return tip\n        }\n\n        // Public: sets or gets the html value of the tooltip\n        //\n        // v - String value of the tip\n        //\n        // Returns html value or tip\n        tip.html = function(v) {\n            if (!arguments.length) return html\n            html = v == null ? v : d3.functor(v)\n\n            return tip\n        }\n\n        tip.customPosition = function(v) {\n            if (!arguments.length) return customPosition\n            customPosition = v == null ? v : d3.functor(v)\n\n            return tip\n        }\n\n        // Public: destroys the tooltip and removes it from the DOM\n        //\n        // Returns a tip\n        tip.destroy = function() {\n            if(node) {\n                getNodeEl().remove();\n                node = null;\n            }\n            return tip;\n        }\n\n        function d3_tip_direction() { return 'n' }\n        function d3_tip_offset() { return [0, 0] }\n        function d3_tip_html() { return ' ' }\n\n        var direction_callbacks = d3.map({\n                n:  direction_n,\n                s:  direction_s,\n                e:  direction_e,\n                w:  direction_w,\n                nw: direction_nw,\n                ne: direction_ne,\n                sw: direction_sw,\n                se: direction_se\n            }),\n\n            directions = direction_callbacks.keys()\n\n        function direction_n() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.n.y - node.offsetHeight,\n                left: bbox.n.x - node.offsetWidth / 2\n            }\n        }\n\n        function direction_s() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.s.y,\n                left: bbox.s.x - node.offsetWidth / 2\n            }\n        }\n\n        function direction_e() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.e.y - node.offsetHeight / 2,\n                left: bbox.e.x\n            }\n        }\n\n        function direction_w() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.w.y - node.offsetHeight / 2,\n                left: bbox.w.x - node.offsetWidth\n            }\n        }\n\n        function direction_nw() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.nw.y - node.offsetHeight,\n                left: bbox.nw.x - node.offsetWidth\n            }\n        }\n\n        function direction_ne() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.ne.y - node.offsetHeight,\n                left: bbox.ne.x\n            }\n        }\n\n        function direction_sw() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.sw.y,\n                left: bbox.sw.x - node.offsetWidth\n            }\n        }\n\n        function direction_se() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.se.y,\n                left: bbox.e.x\n            }\n        }\n\n        function initNode() {\n            var node = d3.select(document.createElement('div'))\n            node.style({\n                position: 'absolute',\n                top: 0,\n                opacity: 0,\n                'pointer-events': 'none',\n                'box-sizing': 'border-box'\n            })\n\n            return node.node()\n        }\n\n        function getSVGNode(el) {\n            el = el.node()\n            if(el.tagName.toLowerCase() === 'svg')\n                return el\n\n            return el.ownerSVGElement\n        }\n\n        function getNodeEl() {\n            if(node === null) {\n                node = initNode();\n                // re-add node to DOM\n                document.body.appendChild(node);\n            };\n            return d3.select(node);\n        }\n\n        // Private - gets the screen coordinates of a shape\n        //\n        // Given a shape on the screen, will return an SVGPoint for the directions\n        // n(north), s(south), e(east), w(west), ne(northeast), se(southeast), nw(northwest),\n        // sw(southwest).\n        //\n        //    +-+-+\n        //    |   |\n        //    +   +\n        //    |   |\n        //    +-+-+\n        //\n        // Returns an Object {n, s, e, w, nw, sw, ne, se}\n        function getScreenBBox() {\n            var targetel   = target || d3.event.target;\n\n            while ('undefined' === typeof targetel.getScreenCTM && 'undefined' === targetel.parentNode) {\n                targetel = targetel.parentNode;\n            }\n\n            var bbox       = {},\n                matrix     = targetel.getScreenCTM(),\n                tbbox      = targetel.getBBox(),\n                width      = tbbox.width,\n                height     = tbbox.height,\n                x          = tbbox.x,\n                y          = tbbox.y\n\n            point.x = x\n            point.y = y\n            bbox.nw = point.matrixTransform(matrix)\n            point.x += width\n            bbox.ne = point.matrixTransform(matrix)\n            point.y += height\n            bbox.se = point.matrixTransform(matrix)\n            point.x -= width\n            bbox.sw = point.matrixTransform(matrix)\n            point.y -= height / 2\n            bbox.w  = point.matrixTransform(matrix)\n            point.x += width\n            bbox.e = point.matrixTransform(matrix)\n            point.x -= width / 2\n            point.y -= height / 2\n            bbox.n = point.matrixTransform(matrix)\n            point.y += height\n            bbox.s = point.matrixTransform(matrix)\n\n            return bbox\n        }\n\n        return tip\n    };\n\n}));","var D3 = D3 || {};\n\nD3.Text = function () {\n    function calcFontSizeRaw(text, radius, minimumSize, isMultiline) {\n        minimumSize = minimumSize || 10;\n\n        var textSize = radius / 3;\n        if (typeof text === \"string\") {\n            var len = text.substring(0, radius / 3).length + 1.5;\n            textSize *= 10 / len;\n            textSize += 1;\n            // experimental alternative method:\n            // var textSize = 3.3 * radius / text.length;\n\n            // Tweak for Indian scripts and CJK ones\n            if (text.match(/[\\u0900-\\u0DFF\\u1100-\\u11FF\\u2E80-\\u2EFF\\u3000-\\u9FFF]/)) {\n                textSize *= 0.6;\n            }\n\n            if (textSize < minimumSize) {\n                textSize = minimumSize;\n            }\n\n            /* Disabled for the time being, better without this\n            if (isMultiline) {\n                var numWords = text.split(/\\s+/).length;\n                if (numWords > 1) {\n                    if (numWords > 4) {\n                        numWords = 4;\n                    }\n                    textSize += textSize * (4 - numWords) * 0.1;\n                }\n            }\n            */\n\n            return Math.round(textSize);\n        }\n\n        if (textSize < minimumSize) {\n            textSize = minimumSize;\n        }\n\n        return Math.round(textSize);\n    }\n\n    function calcFontSize(text, radius, minimumSize, isMultiline) {\n        return calcFontSizeRaw(text, radius, minimumSize, isMultiline) + 'px';\n    }\n\n    function getTextWithElipsisIfNeeded(str, threshold) {\n        if (typeof str === \"string\") {\n            if (str.length > threshold) {\n                return str.substring(0, threshold - 3) + \"...\";\n            }\n        }\n        return str;\n    }\n\n    return {\n        calcFontSizeRaw: calcFontSizeRaw,\n        calcFontSize: calcFontSize,\n        getTextWithElipsisIfNeeded: getTextWithElipsisIfNeeded\n    };\n}();\n\nD3.Transition = function () {\n    function fadeIn(sel, duration) {\n        sel.style(\"opacity\", 0.0)\n            .transition()\n            .duration(duration)\n            .style(\"opacity\", 1.0);\n    }\n\n    function fadeOut(sel, duration) {\n        sel.style(\"opacity\", 1.0)\n            .transition()\n            .duration(duration)\n            .style(\"opacity\", 0.0);\n    }\n\n    return {\n        fadeIn: fadeIn,\n        fadeOut: fadeOut\n    };\n}();\n\nD3.Click = function () {\n    function delayDblClick() {\n        var event = d3.dispatch('click', 'dblclick');\n\n        function cc(selection) {\n            var down,\n                tolerance = 5,\n                last,\n                wait = null;\n\n            // euclidean distance\n            function dist(a, b) {\n                return Math.sqrt(Math.pow(a[0] - b[0], 2), Math.pow(a[1] - b[1], 2));\n            }\n\n            selection.on('mousedown', function () {\n                down = d3.mouse(document.body);\n                last = +new Date();\n            });\n            selection.on('mouseup', function (d) {\n                if (dist(down, d3.mouse(document.body)) > tolerance) {\n                    return;\n                } else {\n                    if (wait) {\n                        window.clearTimeout(wait);\n                        wait = null;\n                        event.dblclick(d);\n                    } else {\n                        wait = window.setTimeout((function (e) {\n                            return function () {\n                                event.click(d);\n                                wait = null;\n                            };\n                        })(d3.event), 250);\n                    }\n                }\n            });\n        }\n\n        return d3.rebind(cc, event, 'on');\n    }\n\n    return {\n        delayDblClick: delayDblClick\n    };\n}();\n\nexport default D3;\n","var SVG = SVG || {};\n\nSVG.Export = function () {\n    function getCSSRules(cssSourceFilePath) {\n        var cssRules = $('link[href=\"' + cssSourceFilePath + '\"]')[0].sheet.rules;\n        var cssStr = \"\";\n        _.each(cssRules, function (value) {\n            cssStr += value.cssText;\n        });\n        return cssStr;\n    }\n\n    function generateBase64ImageSource() {\n        // add needed xml namespace\n        var exportSvg = d3.selectAll(\"svg\")\n            .attr({\n                version: \"1.1\",\n                xmlns: \"http://www.w3.org/2000/svg\"\n            })\n            .node().parentNode.innerHTML;\n\n        // convert selected html to base64\n        return \"data:image/svg+xml;charset=utf-8;base64,\" + btoa(unescape(encodeURIComponent(exportSvg)));\n    }\n\n    return {\n        getCSSRules: getCSSRules,\n        generateBase64ImageSource: generateBase64ImageSource\n    };\n}();\n\nexport default SVG;\n","var CirclePacking = CirclePacking || {};\n\nCirclePacking.SingleChild = function () {\n    /*\n     Functions that enable single child circles to display properly, see\n     http://stackoverflow.com/questions/22307486/d3-js-packed-circle-layout-how-to-adjust-child-radius\n     */\n    function addPlaceholders(node, first) {\n        if (node.children) {\n            for (var i = 0; i < node.children.length; i++) {\n                var child = node.children[i];\n                addPlaceholders(child);\n            }\n\n            if (node.children.length === 1) {\n                var placeholderSize = node.size * 1.2;\n                if (first) {\n                    placeholderSize = node.children[0].size * 0.1;\n                }\n                node.children.push({\n                    name: 'placeholder', size: placeholderSize,\n                    // children: []\n                });\n            }\n        }\n    }\n\n    function removePlaceholders(nodes) {\n        for (var i = nodes.length - 1; i >= 0; i--) {\n            var node = nodes[i];\n\n            if (node.name === 'placeholder') {\n                nodes.splice(i, 1);\n            } else {\n                if (node.children) {\n                    removePlaceholders(node.children);\n                }\n            }\n        }\n    }\n\n    function centerNodes(nodes) {\n        for (var i = 0; i < nodes.length; i++) {\n            var node = nodes[i];\n\n            if (node.children) {\n                if (node.children.length === 1) {\n                    var offset = node.x - node.children[0].x;\n                    node.children[0].x += offset;\n                    reposition(node.children[0], offset);\n                }\n            }\n        }\n\n        function reposition(node, offset) {\n            if (node.children) {\n                for (var i = 0; i < node.children.length; i++) {\n                    node.children[i].x += offset;\n                    reposition(node.children[i], offset);\n                }\n            }\n        }\n    }\n\n    function makePositionsRelativeToZero(nodes) {\n        //use this to have vis centered at 0,0,0 (easier for positioning)\n        var offsetX = nodes[0].x;\n        var offsetY = nodes[0].y;\n\n        for (var i = 0; i < nodes.length; i++) {\n\n            var node = nodes[i];\n\n            node.x -= offsetX;\n            node.y -= offsetY;\n        }\n    }\n\n    return {\n        addPlaceholders: addPlaceholders,\n        removePlaceholders: removePlaceholders,\n        centerNodes: centerNodes,\n        makePositionsRelativeToZero: makePositionsRelativeToZero\n    }\n}();\n\nexport default CirclePacking;\n","import d3tip from 'lib/d3-tip/d3-tip-patch';\nimport CirclePacking from 'lib/common/circle-packing';\nimport D3 from 'lib/common/d3-utils';\nimport SVG from 'lib/common/svg-export';\nimport 'angular/utils/local-storage-adapter';\n\nangular\n    .module('graphdb.framework.graphexplore.directives.class', [\n        'graphdb.framework.graphexplore.controllers.class',\n        'graphdb.framework.utils.localstorageadapter'\n    ])\n    .constant(\"ZOOM_DURATION\", 500)\n    .constant(\"ROOT_OBJ_NAME\", \"RDF Class Hierarchy\")\n    .directive('rdfClassHierarchy', classHierarchyDirective);\n\nclassHierarchyDirective.$inject = ['$rootScope', '$location', 'GraphDataRestService', '$window', '$timeout', '$repositories', '$licenseService', 'toastr', 'ZOOM_DURATION', 'ROOT_OBJ_NAME', 'LocalStorageAdapter', 'LSKeys', '$translate'];\n\nfunction classHierarchyDirective($rootScope, $location, GraphDataRestService, $window, $timeout, $repositories, $licenseService, toastr, ZOOM_DURATION, ROOT_OBJ_NAME, LocalStorageAdapter, LSKeys, $translate) {\n    return {\n        restrict: 'AE',\n        template: '<div id=\"classChart\"></div>',\n        scope: {\n            classHierarchyData: '=',\n            flattenedClassNames: '=',\n            selectedClass: '=',\n            currentSliderValue: '=',\n            showClassInfoPanel: '=',\n            showExternalElements: '=',\n            hidePrefixes: '=',\n            currentBrowserLimit: '='\n        },\n        link: linkFunc\n    };\n\n    function linkFunc(scope, element, attrs) {\n        renderCirclePacking(scope, element);\n    }\n\n    function renderCirclePacking(scope, element) {\n\n        var width = 800,\n            height = 800,\n            diameter = height,\n            margin = 20,\n            node,\n            root;\n\n        var pack = d3.layout.pack()\n            .size([diameter - margin, diameter - margin])\n            .value(function (d) {\n                return d.size;\n            });\n\n        var colors = [\n            \"hsl(33, 75%, 75%)\",\n            \"hsl(213, 75%, 75%)\",\n            \"hsl(333, 75%, 75%)\",\n            \"hsl(153, 75%, 75%)\",\n            \"hsl(273, 75%, 75%)\",\n            \"hsl(93, 75%, 75%)\"\n        ];\n\n        var color = d3.scale.linear()\n            .domain([0, 4])\n            .range([\"hsl(19, 70%, 90%)\", \"hsl(19, 70%, 50%)\"])\n            .interpolate(d3.interpolateHcl);\n\n        var svg = d3.select(\"#classChart\")\n            .insert(\"svg:svg\", \"h2\")\n            .attr(\"viewBox\", \"0 0 \" + width + \" \" + height)\n            .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n            .on(\"dblclick.zoom\", null);\n\n        function appendMainGroup() {\n            return svg.append(\"svg:g\")\n                .attr({\n                    id: \"main-group\",\n                    transform: \"translate(\" + width / 2 + \",\" + height / 2 + \")\"\n                });\n        }\n\n        function savePrefixesState(hidePrefixes) {\n            if (!angular.isUndefined(hidePrefixes)) {\n                LocalStorageAdapter.set(LSKeys.CLASS_HIERARCHY_HIDE_PREFIXES, hidePrefixes);\n            }\n        }\n\n        function getPrefixesState() {\n            return LocalStorageAdapter.get(LSKeys.CLASS_HIERARCHY_HIDE_PREFIXES) === \"true\";\n        }\n\n        /*\n         * Prepares SVG document image export by adding xml namespaces and\n         * additional style information\n         */\n        function prepareForSVGImageExport() {\n            // get css rules for the diagram\n            var cssRules = SVG.Export.getCSSRules(\"css/rdf-class-hierarchy-labels.css?v=2.2.1\");\n            // inline css rules in a defs tag\n            d3.selectAll(\"#main-group\")\n                .append(\"defs\");\n            $(\"defs\").append('<style type=\"text/css\"><![CDATA[' + cssRules + ']]></style>');\n\n            // switch opacity to visible\n            d3.selectAll(\"g\")\n                .style(\"opacity\", 1);\n\n            // convert selected html to base64\n            var imgSrc = SVG.Export.generateBase64ImageSource();\n\n            // set the binary image and a name for the downloadable file on the export button\n            d3.select(this).attr({\n                href: imgSrc,\n                download: \"class-hierarchy-\" + $repositories.getActiveRepository() + \".svg\"\n            });\n        }\n\n        scope.hidePrefixes = getPrefixesState();\n\n        var g = appendMainGroup();\n\n        if (!scope.classHierarchyData.classCount && $repositories.getActiveRepository() && !$repositories.isSystemRepository()) {\n            $rootScope.loader = true;\n            $rootScope.hierarchyError = false;\n            const selGraphFromCache = LocalStorageAdapter.get(`classHierarchy-selectedGraph-${$repositories.getActiveRepository()}`);\n            GraphDataRestService.getClassHierarchyData(selGraphFromCache !== null ? selGraphFromCache.contextID.uri : \"\")\n                .success(function (response, status, headers) {\n                    $rootScope.loader = false;\n                    if (status === 207) {\n                        toastr.warning($translate.instant('graphexplore.update.diagram'), $translate.instant('graphexplore.repository.data.changed'));\n                    }\n                    scope.classHierarchyData = response;\n\n                    d3.select(\"#download-svg\")\n                        .on(\"mouseover\", prepareForSVGImageExport);\n\n                }).error(function (response) {\n                $rootScope.loader = false;\n                $rootScope.hierarchyError = getError(response);\n                toastr.error($translate.instant('graphexplore.error.request.failed', {name: ROOT_OBJ_NAME, error: getError(response)}));\n            });\n        }\n\n\n        var autoZoomToPreviousState,\n            doFocus;\n\n        var oldRoot,\n            focus,\n            rootFocusEvent,\n            classSearchEvent,\n            flattenedClassData = {};\n\n        function drawDiagram(root, config, newFocus, switchPrefixes) {\n            if (rootFocusEvent) rootFocusEvent();\n            if (classSearchEvent) classSearchEvent();\n            // remove old group tag containing the diagram\n            d3.selectAll(\"#main-group\").remove();\n\n            // append new empty group tag in order to rerender new diagram\n            g = appendMainGroup();\n\n            // fix for single child classes\n            CirclePacking.SingleChild.addPlaceholders(root, true);\n            focus = newFocus ? newFocus : root;\n\n            var nodes = pack.nodes(root),\n                view;\n\n            focus.isInFocusTransitive = true;\n\n            // fixes for single child classes\n            CirclePacking.SingleChild.removePlaceholders(nodes);\n            CirclePacking.SingleChild.centerNodes(nodes);\n            CirclePacking.SingleChild.makePositionsRelativeToZero(nodes);\n\n            var tip = d3tip()\n                .attr('class', 'd3-tip')\n                //.offset([-10, 0])\n                .customPosition(function (d) {\n                    return {\n                        top: 'inherit',\n                        bottom: ($window.innerHeight - d3.event.clientY) + 'px',\n                        right: ($window.innerWidth - d3.event.clientX) + 'px'\n                    };\n                })\n                .html(function (d) {\n                    return d.name;\n                });\n\n            svg.call(tip);\n\n            var circleGroup = g.selectAll(\"circle\")\n                .data(nodes)\n                .enter().append(\"g\");\n\n            if (config.doFade) {\n                circleGroup.each(function (d) {\n                    D3.Transition.fadeIn(d3.select(this), 550);\n                });\n            }\n\n            var flattenedClassNames = [];\n\n            var circle = circleGroup\n                .append(\"circle\")\n                .attr(\"class\", function (d) {\n                    return d.role;\n                })\n                .attr(\"guide-selector\", function (d) {\n                    return \"class-\" + d.name;\n                })\n                .style(\"fill\", function (d) {\n                    //return colors[d.depth % 6];\n                    return d.children ? color(d.depth) : \"#E0D0D0\";\n                })\n                .each(function (d) {\n                    d.circle = d3.select(this);\n                    if (d.name !== ROOT_OBJ_NAME) {\n                        var key = d.name;\n                        flattenedClassNames.push({name: key});\n                        flattenedClassData[[key]] = d;\n\n                        d.circle.classed(\"rdf-class\", true);\n                        d.circle.on('mouseover', function () {\n                            if (config.noPrefixes) {\n                                tip.show(d);\n                            } else if (!d.textHidden) {\n                                tip.hide(d);\n                            } else {\n                                tip.show(d);\n                            }\n                        });\n                        d.circle.on('mouseout', tip.hide);\n                    }\n                })\n                // custom event used when user is following a guide\n                .on(\"gdb-focus\", doFocus)\n                .on(\"gdb-zoom\", zoom);\n\n\n            if (flattenedClassNames) {\n                flattenedClassNames = _.uniqBy(flattenedClassNames, 'name');\n                scope.flattenedClassNames = flattenedClassNames;\n            }\n\n            var selectedClass;\n\n            function getCurrentClassDataAndMarkSelected(obj) {\n                d3.selectAll(\".selected\").classed(\"selected\", obj.selected = false);\n                obj.circle.classed(\"selected\", obj.selected = true);\n                selectedClass = obj;\n            }\n\n            function showClassInfoPanel() {\n                scope.selectedClass = selectedClass;\n                scope.showClassInfoPanel = true;\n            }\n\n            function closeClassInfoPanel() {\n                scope.showClassInfoPanel = false;\n            }\n\n            function goToDomainRangeGraphView() {\n                $rootScope.$broadcast('goToDomainRangeGraphView', selectedClass, focus);\n            }\n\n            var clickCancel = D3.Click.delayDblClick();\n            var parentCircles = d3.selectAll(\".parent, .topLevelParent, .child, .root\")\n                .call(clickCancel);\n\n            doFocus = function (obj) {\n                zoom(obj);\n\n                if (obj.name === ROOT_OBJ_NAME) {\n                    closeClassInfoPanel();\n                    d3.selectAll(\".selected\").classed(\"selected\", false);\n                } else {\n                    getCurrentClassDataAndMarkSelected(obj);\n                    showClassInfoPanel();\n\n                    // FIXME: is it ok to bind this event handler every time and not just once?\n                    scope.$on('sidePanelClosed', function (event) {\n                        d3.selectAll(\".selected\").classed(\"selected\", obj.selected = false);\n                    });\n                }\n\n\n                //do not stop event propagation here\n            };\n\n            clickCancel.on(\"click\", function (obj) {\n                // add clicked class to browser history\n                if (obj.id) {\n                    $window.history.pushState({id: obj.id}, \"classHierarchyPage\" + obj.id, \"hierarchy#\" + obj.id);\n                }\n\n                //hide current d3-tip tooltip\n                tip.hide();\n\n                doFocus(obj);\n            });\n\n            clickCancel.on(\"dblclick\", function (obj) {\n                if (obj === root) {\n                    return;\n                }\n                // hide current d3-tip tooltip in order not to appear in the next view\n                tip.hide();\n                getCurrentClassDataAndMarkSelected(obj);\n                goToDomainRangeGraphView();\n\n                d3.event.stopPropagation();\n            });\n\n            var lastTimeWheel = 0;\n            svg.on('wheel', function () {\n                // hide current d3-tip tooltip\n                tip.hide();\n\n                var e = d3.event;\n                e.preventDefault();\n                e.stopPropagation();\n\n                // at least 100ms must have passed since last time we updated\n                var now = new Date().getTime();\n                if (now - lastTimeWheel > 100) {\n                    lastTimeWheel = now;\n                } else {\n                    return;\n                }\n\n                var direction = '';\n                if (e.deltaY <= -1) {\n                    direction = 'in';\n                } else if (e.deltaY >= 1) {\n                    direction = 'out';\n                }\n\n                var obj = e.target.__data__;\n\n                if (!obj) {\n                    // scroll outside the big circle\n                    obj = focus;\n                }\n\n                if (direction === 'in') {\n                    // determine object to zoom to\n\n                    if (obj !== focus) {\n                        // consider the object on which the scroll event occurred\n                        // and find the furthest parent that has no focused children\n                        while (obj.parent && !obj.parent.isInFocusTransitive) {\n                            obj = obj.parent;\n                        }\n                        if (obj.depth < focus.depth) {\n                            // however if that parent is of lower depth than the focus we ignore it\n                            obj = focus;\n                        }\n                    }\n\n                    if (obj === focus && obj.children) {\n                        // if object is in focus and it has children we zoom to its biggest child\n                        // TODO: sort children on backend\n                        var newobj = obj.children[0];\n                        for (var i = 1; i < obj.children.length; i++) {\n                            if (obj.children[i].sortingRank > newobj.sortingRank) {\n                                newobj = obj.children[i];\n                            }\n                        }\n                        if (newobj.children) {\n                            // Use the child only if it has children\n                            obj = newobj;\n                        }\n                    } else if (!obj.children) {\n                        // If node has no children use its parent instead\n                        obj = obj.parent;\n                    }\n\n                    zoom(obj, true);\n                } else if (direction === 'out') {\n                    // zooming out simply goes one parent up\n                    obj = focus.parent;\n                    if (obj) {\n                        zoom(obj, true);\n                    }\n                }\n\n                if (focus.name === ROOT_OBJ_NAME) {\n                    $window.history.replaceState({id: 1}, \"classHierarchyPage1\", \"hierarchy#1\");\n                }\n\n                // redraw slider on zoom out\n                sendSliderData();\n            });\n\n            var text = g.selectAll(\"text\")\n                .data(nodes)\n                .enter().append(\"text\")\n                .attr(\"class\", function (d) {\n                    return d.children && d.children.length ? \"label\" : \"label child-label\";\n                })\n                .each(function (d) {\n                    d.textSel = d3.select(this);\n                });\n\n            function trimPrefixes(d) {\n                var idx = d.name.indexOf(\":\");\n                var absUriIdx = d.name.indexOf(\"http://\");\n                if (absUriIdx > -1) {\n                    // if we have no prefix available ignore\n                    d.noPrefixName = d.name;\n                } else if (idx > -1) {\n                    d.noPrefixName = d.name.substring(idx + 1);\n                }\n            }\n\n            if (config.noPrefixes) {\n                if (oldRoot !== root) {\n                    text.each(trimPrefixes);\n                    oldRoot = root;\n                }\n\n                text\n                    .style(\"font-size\", function (d) {\n                        return D3.Text.calcFontSize(d.noPrefixName, d.r);\n                    })\n                    .text(function (d) {\n                        return D3.Text.getTextWithElipsisIfNeeded(d.noPrefixName, d.r / 3);\n                    });\n            } else {\n                text\n                    .style(\"font-size\", function (d) {\n                        return D3.Text.calcFontSize(d.name, d.r);\n                    })\n                    .text(function (d) {\n                        return D3.Text.getTextWithElipsisIfNeeded(d.name, d.r / 3);\n                    })\n            }\n\n            // TODO: make this use the full version (same as zoom)\n            text.style(\"display\", function (d) {\n                if (d.parent === root) {\n                    d.textHidden = this.textContent.indexOf(\"...\") + 3 === this.textContent.length;\n                    return null;\n                } else {\n                    d.textHidden = true;\n                    return \"none\";\n                }\n            });\n\n            if (config.doFade && !config.keepPrevState) {\n                text.each(function (d) {\n                    D3.Transition.fadeIn(d3.select(this), 550);\n                });\n            }\n\n            autoZoomToPreviousState = function () {\n                function focusOnCurrentClass(focusHistoryId) {\n                    if (focusHistoryId) {\n                        circle.each(function (d) {\n                            if (focusHistoryId == d.id) {\n                                doFocus(d);\n                            }\n                        });\n                    }\n                }\n\n                var focusHistoryId = $location.hash();\n\n                $window.onpopstate = function (event) {\n                    if (event.state) {\n                        var focusHistoryId = event.state.id;\n                        focusOnCurrentClass(focusHistoryId);\n                    }\n                };\n\n                focusOnCurrentClass(focusHistoryId);\n            };\n\n            var node = g.selectAll(\"circle, text\");\n\n            function zoomTo(v, switchPrefixes) {\n                var k = diameter / v[2];\n                view = v;\n\n                node.attr(\"transform\", function (d) {\n                    return \"translate(\" + (d.x - v[0]) * k + \",\" + (d.y - v[1]) * k + \")\";\n                });\n\n                circle.attr(\"r\", function (d) {\n                    return d.r * k;\n                });\n\n                function switchPrefixesInPlace(d) {\n                    // if uris match with the topLevelParentUri of the focused element\n                    // or your focus is a top level parent hide its label and if it is not\n                    // a child element show all of its child labels. If it is a child element\n                    // only show its label.\n                    if (d.fullName === focus.topLevelParentUri || focus.topLevelParentUri === ROOT_OBJ_NAME) {\n                        d.textSel.style(\"display\", \"none\");\n                        if (focus.children && focus.children.length) {\n                            _.each(focus.children, function (c) {\n                                c.textSel.style(\"display\", \"inline\");\n                            });\n                        } else {\n                            focus.textSel.style(\"display\", \"inline\");\n                        }\n\n                        // in order to show prefixes of siblings check if the focused\n                        // element has a parent and show all of its children except\n                        // for the name of the focused element because you need to see\n                        // its children\n                        if (focus.parent) {\n                            _.each(focus.parent.children, function (c) {\n                                if (c.name !== focus.name) {\n                                    c.textSel.style(\"display\", \"inline\");\n                                }\n                            });\n                        }\n                    }\n                }\n\n                if (switchPrefixes) {\n                    text.each(switchPrefixesInPlace);\n                }\n\n                text\n                    .style(\"font-size\", function (d) {\n                        if (config.noPrefixes) {\n                            return D3.Text.calcFontSize(d.noPrefixName, d.r * k);\n                        }\n                        return D3.Text.calcFontSize(d.name, d.r * k);\n                    })\n                    .text(function (d) {\n                        if (config.noPrefixes) {\n                            return D3.Text.getTextWithElipsisIfNeeded(d.noPrefixName, d.r * k / 3);\n                        }\n                        return D3.Text.getTextWithElipsisIfNeeded(d.name, d.r * k / 3);\n                    });\n            }\n\n\n            function adjustRadius(r) {\n                var newr = r * 2 + margin;\n                if (r * 2 / newr < 0.3) {\n                    // for very small circles we need to adjust\n                    newr = r * 2 + 2;\n                }\n                return newr;\n            }\n\n            zoomTo([focus.x, focus.y, adjustRadius(focus.r)], switchPrefixes);\n\n            function textUpdateStart(d) {\n                if (d.isInFocusTransitive || !(d.parent && d.parent.isInFocusTransitive)) {\n                    // hide labels of classes that are in focus (including children) OR whose parents aren't in focus\n                    d.textHidden = true;\n                    this.style.display = \"none\";\n                }\n            }\n\n            function textUpdateEnd(d) {\n                if (d.isInFocusTransitive || !(d.parent && d.parent.isInFocusTransitive)) {\n                    // hide labels of classes that are in focus (including children) OR whose parents aren't in focus\n                    // this.style.display = \"none\";\n                } else {\n                    // show all other labels\n                    d.textHidden = this.textContent.indexOf(\"...\") + 3 === this.textContent.length;\n                    this.style.display = \"\";\n                }\n            }\n\n            function zoom(d, shouldClosePanel) {\n                // use empty timeout to force the following code to be executed on the next $digest cycle\n                // in order to avoid '$digest in progress' error\n                $timeout(function () {\n                    scope.showExternalElements = (d.name === ROOT_OBJ_NAME);\n                });\n\n                if (focus === d) {\n                    // Node is already zoomed to\n                    // Important to return before we modify the history, otherwise we choke the browser\n                    return;\n                }\n\n                if (d.id) {\n                    $window.history.replaceState({id: d.id}, \"classHierarchyPage\" + d.id, \"hierarchy#\" + d.id);\n                }\n\n                if (!d.children) {\n                    // No children - zoom to parent instead\n                    d = d.parent;\n                    if (focus === d) {\n                        // Parent is already zoomed to\n                        return;\n                    }\n                }\n\n                if (shouldClosePanel) {\n                    closeClassInfoPanel();\n                    d3.selectAll(\".selected\").classed(\"selected\", false);\n                }\n\n                if (focus.parent) {\n                    var p = focus;\n                    while (p) {\n                        p.isInFocusTransitive = false;\n                        p = p.parent;\n                    }\n                }\n\n                var p = d;\n                while (p) {\n                    p.isInFocusTransitive = p.children;\n                    p = p.parent;\n                }\n\n                focus = d;\n\n                var isVerySmallCircle = focus.r * 2 / (focus.r * 2 + margin) < 0.3;\n\n                if (isVerySmallCircle || scope.currentSliderValue > scope.currentBrowserLimit) {\n                    // no fancy animation for slower browsers if above the limit or if zooming to a very small circle\n                    zoomTo([focus.x, focus.y, adjustRadius(focus.r)]);\n\n                    text.each(function (d) {\n                        textUpdateStart.call(this, d);\n                        textUpdateEnd.call(this, d);\n                    });\n                } else {\n                    // the fancy version for faster browsers\n                    var transition = d3.transition()\n                        .duration(ZOOM_DURATION)\n                        .tween(\"zoom\", function (d) {\n                            var i = d3.interpolateZoom(view, [focus.x, focus.y, adjustRadius(focus.r)]);\n                            return function (t) {\n                                zoomTo(i(t));\n                            };\n                        });\n\n                    transition.selectAll(\"text\")\n                    // Experimental: hide texts to be hidden on \"start\", show texts to be shown on \"end\"\n                        .each(\"start\", textUpdateStart)\n                        .each(\"end\", textUpdateEnd);\n                }\n            }\n\n            rootFocusEvent = scope.$on('rootFocus', function () {\n                $window.history.pushState({id: 1}, \"classHierarchyPage1\", \"hierarchy#1\");\n                doFocus(root);\n            });\n\n            classSearchEvent = scope.$on('classSearch', function (selectedClass) {\n                doFocus(selectedClass);\n            });\n        }\n\n        function sendSliderData() {\n            var currentClassCount = scope.classHierarchyData.classCount;\n            let currentSliderValue = LocalStorageAdapter.get(LSKeys.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE);\n\n            if (!currentSliderValue || currentSliderValue > currentClassCount) {\n                currentSliderValue = currentClassCount;\n                LocalStorageAdapter.set(LSKeys.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE, currentSliderValue);\n            }\n\n            $rootScope.$broadcast(\"classCount\", currentClassCount, currentSliderValue);\n        }\n\n        window.addEventListener('resize', sendSliderData);\n\n        window.addEventListener('beforeunload', removeResizeListener);\n\n        function removeResizeListener() {\n            window.removeEventListener('resize', sendSliderData);\n            window.removeEventListener('beforeunload', removeResizeListener);\n        }\n\n        var prefixesWatch,\n            currentClassCountWatch,\n            searchedClassBroadcast,\n            onEnterClassSearchBroadcast;\n\n        scope.$watch('classHierarchyData', function () {\n            // when data changes unregister watchers by calling them\n            if (prefixesWatch) prefixesWatch();\n            if (currentClassCountWatch) currentClassCountWatch();\n            if (searchedClassBroadcast) searchedClassBroadcast();\n            if (onEnterClassSearchBroadcast) onEnterClassSearchBroadcast();\n\n            // get initial state of prefixes (hidden or not) when changing repositories\n            // in order to avoid triggering an unwanted prefixes watch\n            var initialPrefixesState = getPrefixesState();\n\n            if (scope.classHierarchyData.classCount) {\n                sendSliderData();\n\n                var root = angular.copy(scope.classHierarchyData);\n\n                function sortRoot(root) {\n                    // add all classes to a flat array, add parent information\n                    // and sort according to instancesCount DESC, depth ASC\n                    return pack\n                        .nodes(root)\n                        .sort(function (a, b) {\n                            if (a.sortingRank > b.sortingRank) {\n                                return -1;\n                            } else if (a.sortingRank < b.sortingRank) {\n                                return 1;\n                            } else if (a.depth > b.depth) {\n                                return 1;\n                            } else if (a.depth < b.depth) {\n                                return -1;\n                            } else {\n                                return 0;\n                            }\n                        });\n                }\n\n                var sorted = sortRoot(root);\n\n                // we start with an empty new root\n                var newRoot;\n                var noPrefixesGlobal;\n\n\n                function restoreDiagramState(currentRoot, switchPrefixes) {\n                    var prefixesConfig = {\n                        keepPrevState: true,\n                        noPrefixes: getPrefixesState()\n                    };\n\n                    // get noPrefixes flag from drawDiagram configuration params\n                    noPrefixesGlobal = prefixesConfig.noPrefixes;\n\n                    if (newRoot) {\n                        drawDiagram(newRoot, prefixesConfig, focus, true);\n                    } else {\n                        drawDiagram(currentRoot, prefixesConfig, focus, true);\n                    }\n\n                    $timeout(function () {\n                        LocalStorageAdapter.set(LSKeys.CLASS_HIERARCHY_SWITCH_PREFIXES, switchPrefixes);\n                        autoZoomToPreviousState();\n                    }, 70);\n                }\n\n                function redrawFilteredDiagram(currentSliderValue, sortedRoot, useSlider) {\n                    if (!currentSliderValue) {\n                        return;\n                    }\n\n                    LocalStorageAdapter.set(LSKeys.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE, currentSliderValue);\n\n                    newRoot = {\n                        name: ROOT_OBJ_NAME,\n                        children: []\n                    };\n\n                    // walk through the given count of (sorted) classes\n                    // - record the id of each class we've seen\n                    // - add the root level classes to the new root\n                    var addedIds = new Set();\n                    for (var k = 1; k <= currentSliderValue; k++) {\n                        addedIds.add(sortedRoot[k].id);\n                        if (sortedRoot[k].parent === sortedRoot[0]) { // i.e. the parent is the \"class hierarchy\"\n                            newRoot.children.push(sortedRoot[k]);\n                        }\n                    }\n\n                    // walk through all the classes in the new root and only keep those that have an \"added id\"\n                    // we create separate copies of the arrays in order not to contaminate the original data\n                    // we also copy each class's object ($.extend ...) for the same reason\n                    function fixChildren(node) {\n                        if (!node.children) {\n                            return;\n                        }\n                        var newChildren = [];\n                        for (var i = 0; i < node.children.length; i++) {\n                            if (addedIds.has(node.children[i].id)) {\n                                newChildren.push($.extend({}, node.children[i]));\n                            }\n                        }\n                        node.children = newChildren;\n                        for (var i = 0; i < node.children.length; i++) {\n                            fixChildren(node.children[i]);\n                        }\n                    }\n\n                    fixChildren(newRoot);\n\n                    if (useSlider) {\n                        // redraw diagram when slider value changes and persist current state\n                        // in local storage\n                        noPrefixesGlobal = angular.isUndefined(noPrefixesGlobal) ? getPrefixesState() : noPrefixesGlobal;\n                        var redrawConfig = {\n                            noPrefixes: noPrefixesGlobal\n                        };\n                        drawDiagram(newRoot, redrawConfig);\n                    } else {\n                        // if the user returns to the diagram with back browser button\n                        // read the saved state (show/hide prefixes, current slider value)\n                        // from local storage and render the diagram according to the saved metrics\n                        restoreDiagramState(root);\n                    }\n                }\n\n                var currentSliderValue = LocalStorageAdapter.get(LSKeys.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE);\n                if (currentSliderValue) {\n                    redrawFilteredDiagram(currentSliderValue, sorted);\n                } else {\n                    var basicConfig = {\n                        doFade: true,\n                        keepPrevState: true,\n                        noPrefixes: getPrefixesState()\n                    };\n                    drawDiagram(root, basicConfig);\n                    autoZoomToPreviousState();\n                }\n\n                prefixesWatch = scope.$watch('hidePrefixes', function (hidePrefixes) {\n                    if (angular.isUndefined(hidePrefixes) || initialPrefixesState) {\n                        initialPrefixesState = undefined;\n                        return;\n                    }\n                    // if digest overflows a possible fix might be wrapping this in $timeout\n                    $timeout(function () {\n                        savePrefixesState(hidePrefixes);\n                        restoreDiagramState(root, true);\n                    }, 50);\n                }, true);\n\n                currentClassCountWatch = scope.$watch('currentSliderValue', function (currentSliderValue) {\n                    redrawFilteredDiagram(currentSliderValue, sorted, true);\n                }, true);\n\n                // we handle this event for the cases where we already have searched for a given class and\n                // hit enter again on the already selected class in order again react and zoom to it again\n                // if we are not at the moment\n                var currentSearchedClass;\n                onEnterClassSearchBroadcast = scope.$on('onEnterKeypressSearchAction', function (event) {\n                    if (currentSearchedClass) {\n                        doFocus(currentSearchedClass);\n                    }\n                });\n\n                searchedClassBroadcast = scope.$on('searchedClass', function (event, searchedClass) {\n                    currentSearchedClass = flattenedClassData[searchedClass.name];\n                    if (currentSearchedClass) {\n                        doFocus(currentSearchedClass);\n                    }\n                });\n            }\n        }, true);\n    }\n}\n"],"sourceRoot":""}