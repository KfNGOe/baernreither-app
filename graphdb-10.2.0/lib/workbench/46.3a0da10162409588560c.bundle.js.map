{"version":3,"sources":["webpack:///./src/js/angular/resources/chart-models/chart-data.js","webpack:///./src/js/angular/resources/chart-models/performance/epool-chart.js"],"names":["ChartData","translateService","chart","interpolate","type","height","margin","left","right","x","d","y","clipEdge","noData","instant","showControls","duration","rightAlignYAxis","useInteractiveGuideline","xAxis","showMaxMin","tickFormat","d3","time","format","Date","yAxis","legend","maxKeyLength","color","scale","category10","range","title","enable","text","this","getTitle","subtitle","className","getSubTitle","chartOptions","subTitle","html","disableRangeUpdate","disableOldDataRemoval","getChartOptions","chartSetup","dataHolder","createDataHolder","firstLoad","Error","timestamp","newData","removeOldData","addNewData","isFirstLoad","updateRange","values","length","forEach","data","shift","multiplier","domainUpperBound","calculateMaxChartValueAndDivisions","yDomain","Math","max","filter","disabled","flatMap","getMaxValueForDataSeries","dataSeries","map","maxDataValue","Array","isArray","getMaxValueFromDataHolder","maxChartValue","round","DEFAULT_MULTIPLIER","ceil","MAXIMUM_DIVISIONS","divisions","EpoolChart","super","customChartOptions","yAxis1","axisLabel","axisLabelDistance","rotateYLabel","tickValues","getIntegerRangeForValues","yAxis2","y1Domain","y2Domain","Object","assign","key","performanceData","readsData","writesData","readsDiff","writesDiff","currentReads","entityPool","epoolReads","currentWrites","epoolWrites","push","yDomain1","getAxisDomain","yDomain2"],"mappings":"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","file":"46.3a0da10162409588560c.bundle.js","sourcesContent":["export class ChartData {\n    getChartOptions(translateService) {\n        return {\n            chart: {\n                interpolate: 'monotone',\n                type: 'lineChart',\n                height: 500,\n                margin: {\n                    left: 80,\n                    right: 80\n                },\n                x: function (d) {\n                    return d[0];\n                },\n                y: function (d) {\n                    return d[1];\n                },\n                clipEdge: true,\n                noData: translateService.instant('resource.no_data'),\n                showControls: false,\n                duration: 0,\n                rightAlignYAxis: false,\n                useInteractiveGuideline: true,\n                xAxis: {\n                    showMaxMin: false,\n                    tickFormat: function (d) {\n                        return d3.time.format('%X')(new Date(d));\n                    }\n                },\n                yAxis: {\n                    showMaxMin: false,\n                    tickFormat: function (d) {\n                        return d;\n                    }\n                },\n                legend: {\n                    maxKeyLength: 100\n                },\n                color: d3.scale.category10().range()\n            },\n            title: {\n                enable: true,\n                text: this.getTitle()\n            },\n            subtitle: {\n                className: 'chart-additional-info',\n                enable: true,\n                text: this.getSubTitle()\n            }\n        };\n    }\n\n    /**\n     * Must implement\n     * @return {string} the title name\n     */\n    getTitle() {\n        return 'No chart title set';\n    }\n\n    setTitle(title) {\n        this.chartOptions.title.enable = true;\n        this.chartOptions.title.text = title;\n    }\n\n    getSubTitle() {\n    }\n\n    setSubTitle(subTitle) {\n        this.chartOptions.subtitle.enable = true;\n        this.chartOptions.subtitle.html = subTitle;\n    }\n\n    /**\n     * Defines the default multiplier for chart overhead. The space above the maximum value.\n     */\n    static get DEFAULT_MULTIPLIER() {\n        return 1.2;\n    }\n\n    /**\n     * Defines the default divisions for chart. Used to calculate chart ticks.\n     */\n    static get MAXIMUM_DIVISIONS() {\n        return 10;\n    }\n\n    constructor(translateService, chartOptions, disableRangeUpdate, disableOldDataRemoval) {\n        this.disableRangeUpdate = disableRangeUpdate;\n        this.disableOldDataRemoval = disableOldDataRemoval;\n        this.translateService = translateService;\n        this.range = 150;\n        this.chartOptions = this.getChartOptions(translateService);\n        this.chartSetup(this.chartOptions);\n        this.dataHolder = this.createDataHolder();\n        this.firstLoad = true;\n    }\n\n    /**\n     * Provides chart options if custom setup needs to be done\n     * @param chartOptions\n     */\n    chartSetup(chartOptions) {\n    }\n\n    /**\n     * Returns the data holder array for the chart data.\n     * Must be implemented.\n     */\n    createDataHolder() {\n        throw new Error('Must implement data holder creation');\n    }\n\n    /**\n     * Adds data to the data holder\n     * @param timestamp time of the data\n     * @param newData the new data\n     */\n    addData(timestamp, newData) {\n        if (!this.disableOldDataRemoval) {\n            this.removeOldData(this.dataHolder, this.range);\n        }\n        this.addNewData(this.dataHolder, timestamp, newData, this.isFirstLoad());\n        if (!this.disableRangeUpdate) {\n            this.updateRange(this.dataHolder);\n        }\n        if (this.firstLoad) {\n            this.firstLoad = false;\n        }\n    }\n\n    /**\n     * Removes data from the data holder that is obsolete based on range property\n     * @param dataHolder data holder\n     * @param range the number of entries to keep\n     */\n    removeOldData(dataHolder, range) {\n        if (dataHolder[0].values.length > range) {\n            dataHolder.forEach((data) => data.values.shift());\n        }\n    }\n\n    /**\n     * Adds data to data holder\n     * Must be implemented.\n     * @param dataHolder\n     * @param timestamp\n     * @param data\n     * @param isFirstLoad\n     */\n    addNewData(dataHolder, timestamp, data, isFirstLoad) {\n    }\n\n    /**\n     * Updates the chart axis range, based on maximum value in data holder\n     * @param dataHolder\n     * @param multiplier\n     */\n    updateRange(dataHolder, multiplier) {\n        const [domainUpperBound] = ChartData.calculateMaxChartValueAndDivisions(dataHolder, multiplier);\n        this.chartOptions.chart.yDomain = [0, domainUpperBound];\n    }\n\n    isFirstLoad() {\n        return this.firstLoad;\n    }\n\n    /**\n     * Returns the maximum value in data holder\n     * @param dataHolder\n     * @return {number}\n     */\n    static getMaxValueFromDataHolder(dataHolder) {\n        return Math.max(...dataHolder.filter((data) => !data.disabled).flatMap((data) => ChartData.getMaxValueForDataSeries(data)));\n    }\n\n    /**\n     * Returns the maximum value in specific data series\n     * @param dataSeries\n     * @return {number}\n     */\n    static getMaxValueForDataSeries(dataSeries) {\n        return Math.max(...dataSeries.values.map((data) => data[1]));\n    }\n\n    /**\n     * Calculated maximum value for chart axis and divisions width\n     * @param dataHolder\n     * @param multiplier\n     * @return {(number|number)[]}\n     */\n    static calculateMaxChartValueAndDivisions(dataHolder, multiplier) {\n        let maxDataValue;\n\n        if (Array.isArray(dataHolder)) {\n            maxDataValue = ChartData.getMaxValueFromDataHolder(dataHolder);\n        } else {\n            maxDataValue = ChartData.getMaxValueForDataSeries(dataHolder);\n        }\n\n        const maxChartValue = Math.round(maxDataValue * (multiplier || ChartData.DEFAULT_MULTIPLIER)) || 1;\n        const div = Math.ceil(maxChartValue / ChartData.MAXIMUM_DIVISIONS);\n        return [maxChartValue, div];\n    }\n\n    /**\n     * Returnes a D3 range for chart axis based on maximum value and divisions width\n     * @param dataHolder\n     * @param multiplier\n     * @return {*}\n     */\n    static getIntegerRangeForValues(dataHolder, multiplier) {\n        const [maxChartValue, divisions] = ChartData.calculateMaxChartValueAndDivisions(dataHolder, multiplier);\n        return d3.range(0, maxChartValue + 1, divisions);\n    }\n}\n","import {ChartData} from \"../chart-data\";\n\nexport class EpoolChart extends ChartData {\n    constructor(translateService, chartOptions) {\n        super(translateService, chartOptions, false, false);\n    }\n    chartSetup(chartOptions) {\n        const customChartOptions = {\n            type: 'multiChart',\n            yAxis1: {\n                showMaxMin: false,\n                axisLabel: this.translateService.instant('resource.epool.reads'),\n                axisLabelDistance: -10,\n                rotateYLabel: true,\n                tickFormat: function(d) {\n                    return d;\n                },\n                tickValues: () => {\n                    return EpoolChart.getIntegerRangeForValues(this.dataHolder[0]);\n                }\n            },\n            yAxis2: {\n                showMaxMin: false,\n                axisLabel: this.translateService.instant('resource.epool.writes'),\n                axisLabelDistance: -10,\n                rotateYLabel: true,\n                tickFormat: function(d) {\n                    return d;\n                },\n                tickValues: () => {\n                    return EpoolChart.getIntegerRangeForValues(this.dataHolder[1]);\n                }\n            },\n            y1Domain: [0, 1],\n            y2Domain: [0, 1]\n        };\n        Object.assign(chartOptions.chart, customChartOptions);\n    }\n\n    getTitle() {\n        return this.translateService.instant('resource.epool.label');\n    }\n\n    createDataHolder() {\n        return [{\n            key: this.translateService.instant('resource.epool.reads'),\n            type: 'line',\n            yAxis: 1,\n            values: []\n        }, {\n            key: this.translateService.instant('resource.epool.writes'),\n            type: 'line',\n            yAxis: 2,\n            values: []\n        }];\n    }\n    addNewData(dataHolder, timestamp, data, isFirstLoad) {\n        const performanceData = data.performanceData;\n        const [readsData, writesData] = dataHolder;\n        let readsDiff = 0;\n        let writesDiff = 0;\n        const currentReads = performanceData.entityPool.epoolReads;\n        const currentWrites = performanceData.entityPool.epoolWrites;\n\n        if (!isFirstLoad) {\n            const lastReadsEntry = readsData.values[readsData.values.length - 1][2];\n            const lastWritesEntry = writesData.values[readsData.values.length - 1][2];\n            readsDiff = currentReads - lastReadsEntry;\n            writesDiff = currentWrites - lastWritesEntry;\n        }\n\n        readsData.values.push([timestamp, readsDiff, currentReads]);\n        writesData.values.push([timestamp, writesDiff, currentWrites]);\n    }\n    updateRange(dataHolder) {\n        this.chartOptions.chart.yDomain1 = this.getAxisDomain(dataHolder[0]);\n        this.chartOptions.chart.yDomain2 = this.getAxisDomain(dataHolder[1]);\n    }\n    getAxisDomain(dataHolder) {\n        const [domainUpperBound] = EpoolChart.calculateMaxChartValueAndDivisions(dataHolder);\n        return [0, domainUpperBound];\n    }\n}\n"],"sourceRoot":""}