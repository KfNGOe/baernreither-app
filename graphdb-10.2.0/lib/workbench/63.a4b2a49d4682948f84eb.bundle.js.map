{"version":3,"sources":["webpack:///./src/js/angular/core/directives/queryeditor/sparql-tab.directive.js"],"names":["sparqlTabDirective","$rootScope","LocalStorageAdapter","LSKeys","ModalService","restrict","template","replace","controller","$scope","$element","toastr","$translate","getQueryID","element","$","attr","selectTab","id","tab","state","on","e","$broadcast","deleteTab","preventDefault","stopPropagation","tabs","length","warning","instant","shiftKey","selectedTabId","openSimpleModal","title","message","result","then","filter","obj","set","TABS_STATE","idForDelete","angular","isUndefined","idx","i","findTabIndexByID","splice","currentQuery","deleteTabByID","document","find","focus","editCurrentTab","editCurrentlySelectedOnly","$show","$editableButtons","children","addClass","$el","name","currentTarget","$$currentValue","removeClass","selectThisTab","isTabChangeOk","module","directive","$inject"],"mappings":"0FAAA,YAWA,SAASA,EAAmBC,EAAYC,EAAqBC,EAAQC,GA4HjE,MAAO,CACHC,SAAU,KAEVC,SAAU,qeACVC,SAAS,EACTC,WAhIkB,CAAC,SAAU,WAAY,aAAc,eAAgB,SAAU,aAAc,SAAUC,EAAQC,EAAUT,EAAYG,EAAcO,EAAQC,GAG7J,SAASC,EAAWC,GAChB,OAAOC,EAAED,GAASE,KAAK,WA4B3B,SAASC,EAAUC,GACfH,EAAE,gBAAkBG,EAAK,MAAMC,IAAI,QAhCvCV,EAAOW,MAAQ,GAefL,EAAEL,GAAUW,GAAG,gBAAgB,SAAUC,GACrCrB,EAAWsB,WAAW,YAAaD,MAGvCb,EAAOe,UAgBP,SAAmBF,GAIf,GAHAA,EAAEG,iBACFH,EAAEI,kBAEEjB,EAAOkB,KAAKC,OAAS,EAErB,YADAjB,EAAOkB,QAAQjB,EAAWkB,QAAQ,4CAIlCR,EAAES,UACFtB,EAAOW,MAAMY,cAAgBnB,EAAWH,GAExCN,EAAa6B,gBAAgB,CACzBC,MAAOtB,EAAWkB,QAAQ,kBAC1BK,QAASvB,EAAWkB,QAAQ,gDAC5BD,SAAS,IACVO,OAAOC,MAAK,WA2DvB,IAAqCnB,IA1DGT,EAAOW,MAAMY,cA2DjDvB,EAAOkB,KAAOlB,EAAOkB,KAAKW,QAAO,SAAUC,GACvC,GAAIA,EAAIrB,KAAOA,EACX,OAAOqB,KAGftB,EAAUR,EAAOkB,KAAK,GAAGT,IACzBhB,EAAoBsC,IAAIrC,EAAOsC,WAAYhC,EAAOkB,MAClD1B,EAAWsB,WAAW,yBAA0Bd,EAAOkB,WA/DnDlB,EAAOW,MAAMsB,YAAc7B,EAAWH,GAEtCN,EAAa6B,gBAAgB,CACzBC,MAAOtB,EAAWkB,QAAQ,kBAC1BK,QAASvB,EAAWkB,QAAQ,0CAC5BD,SAAS,IACVO,OAAOC,MAAK,YA6BvB,SAAuBnB,GACnB,GAAIyB,QAAQC,YAAY1B,GACpB,KAAM,4CAEV,MAAM2B,EAxFV,SAA0B3B,GACtB,IAAK,IAAI4B,EAAI,EAAGA,EAAIrC,EAAOkB,KAAKC,OAAQkB,IAAK,CAEzC,GADYrC,EAAOkB,KAAKmB,GAChB5B,KAAOA,EACX,OAAO4B,GAoFHC,CAAiB7B,GAC7BT,EAAOkB,KAAKqB,OAAOH,EAAK,GAEpB3B,IAAOT,EAAOwC,aAAa/B,IACvBT,EAAOkB,KAAKC,OAAS,GAGjBX,EAFA4B,EAAM,EAEIpC,EAAOkB,KAAKkB,EAAM,GAAG3B,GAGrBT,EAAOkB,KAAK,GAAGT,IA1C7BgC,CAAczC,EAAOW,MAAMsB,iBAGnCC,QAAQ7B,QAAQqC,UAAUC,KAAK,oCAAoCC,SA7CvE5C,EAAO6C,eAgDP,WACI,GAAIzC,EAAWH,KAAcD,EAAOwC,aAAa/B,GAC7C,OAEJT,EAAO8C,0BAA0BC,QAEjC,MAAMC,EAAmB1C,EAAE,qBAC3B0C,EAAiBC,SAAS,oBAAoBC,SAAS,UACvDF,EAAiBC,SAAS,oBAAoBC,SAAS,UACvD5C,EAAE,sCAAsC4C,SAAS,mBAAmBtC,GAAG,UAAU,SAAUuC,GACvFnD,EAAOwC,aAAaY,KAAOD,EAAIE,cAAcC,kBAIjDhD,EAAE,6CACGiD,YAAY,0BACZL,SAAS,eACd5C,EAAE,iDACGiD,YAAY,8BACZL,SAAS,gBAlElBlD,EAAOwD,cAEP,SAAuB3C,GACnBA,EAAEG,iBACFH,EAAEI,kBACEjB,EAAOyD,eAAc,IACrBnD,EAAEL,GAAUS,IAAI,YAtChCwB,QACKwB,OAAO,0DAA2D,CAC/D,yBACA,gDAEHC,UAAU,YAAapE,GAE5BA,EAAmBqE,QAAU,CAAC,aAAc,sBAAuB,SAAU","file":"63.a4b2a49d4682948f84eb.bundle.js","sourcesContent":["import 'angular/utils/local-storage-adapter';\n\nangular\n    .module('graphdb.framework.core.directives.queryeditor.sparqltab', [\n        'graphdb.framework.core',\n        'graphdb.framework.utils.localstorageadapter'\n    ])\n    .directive('sparqlTab', sparqlTabDirective);\n\nsparqlTabDirective.$inject = ['$rootScope', 'LocalStorageAdapter', 'LSKeys', 'ModalService'];\n\nfunction sparqlTabDirective($rootScope, LocalStorageAdapter, LSKeys, ModalService) {\n    const SparqlTabCtrl = ['$scope', '$element', '$rootScope', 'ModalService', 'toastr', '$translate', function ($scope, $element, $rootScope, ModalService, toastr, $translate) {\n        $scope.state = {};\n\n        function getQueryID(element) {\n            return $(element).attr('data-id');\n        }\n\n        function findTabIndexByID(id) {\n            for (let i = 0; i < $scope.tabs.length; i++) {\n                const tab = $scope.tabs[i];\n                if (tab.id === id) {\n                    return i;\n                }\n            }\n        }\n\n        $($element).on('shown.bs.tab', function (e) {\n            $rootScope.$broadcast('tabAction', e);\n        });\n\n        $scope.deleteTab = deleteTab;\n        $scope.editCurrentTab = editCurrentTab;\n        $scope.selectThisTab = selectThisTab;\n\n        function selectThisTab(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if ($scope.isTabChangeOk(false)) {\n                $($element).tab('show');\n            }\n        }\n\n        function selectTab(id) {\n            $('a[data-id = \"' + id + '\"]').tab('show');\n        }\n\n        function deleteTab(e) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if ($scope.tabs.length < 2) {\n                toastr.warning($translate.instant('sparql.tab.directive.close.last.warning'));\n                return;\n            }\n\n            if (e.shiftKey) {\n                $scope.state.selectedTabId = getQueryID($element);\n\n                ModalService.openSimpleModal({\n                    title: $translate.instant('common.confirm'),\n                    message: $translate.instant('sparql.tab.directive.delete.all.tabs.warning'),\n                    warning: true\n                }).result.then(function () {\n                    deleteAllTabsExceptSelected($scope.state.selectedTabId);\n                });\n            } else {\n                $scope.state.idForDelete = getQueryID($element);\n\n                ModalService.openSimpleModal({\n                    title: $translate.instant('common.confirm'),\n                    message: $translate.instant('sparql.tab.directive.close.tab.warning'),\n                    warning: true\n                }).result.then(function () {\n                    deleteTabByID($scope.state.idForDelete);\n                });\n            }\n            angular.element(document).find('.CodeMirror textarea:first-child').focus();\n        }\n\n        function editCurrentTab() {\n            if (getQueryID($element) !== $scope.currentQuery.id) {\n                return;\n            }\n            $scope.editCurrentlySelectedOnly.$show();\n            //fix for buttons for edit\n            const $editableButtons = $(\".editable-buttons\");\n            $editableButtons.children(\".btn.btn-primary\").addClass('btn-sm');\n            $editableButtons.children(\".btn.btn-default\").addClass('btn-sm');\n            $('.editable-controls .editable-input').addClass('form-control-sm').on('change', function ($el) {\n                $scope.currentQuery.name = $el.currentTarget.$$currentValue;\n            });\n            //$('.editable-buttons').css('margin-top', '5px');\n            //$('.editable-input.editable-has-buttons').css('width', '50%');\n            $('.editable-buttons .glyphicon.glyphicon-ok')\n                .removeClass('glyphicon glyphicon-ok')\n                .addClass('fa fa-check');\n            $('.editable-buttons .glyphicon.glyphicon-remove')\n                .removeClass('glyphicon glyphicon-remove')\n                .addClass('fa fa-close');\n        }\n\n        function deleteTabByID(id) {\n            if (angular.isUndefined(id)) {\n                throw 'Delete by id was called with undefined id';\n            }\n            const idx = findTabIndexByID(id);\n            $scope.tabs.splice(idx, 1);\n\n            if (id === $scope.currentQuery.id) {\n                if ($scope.tabs.length > 0) {\n                    if (idx > 0) {\n                        // select previous tab if we deleted any but the first tab\n                        selectTab($scope.tabs[idx - 1].id);\n                    } else {\n                        // select first tab if we deleted the first tab\n                        selectTab($scope.tabs[0].id);\n                    }\n                }\n            }\n        }\n\n        function deleteAllTabsExceptSelected(id) {\n            $scope.tabs = $scope.tabs.filter(function (obj) {\n                if (obj.id === id) {\n                    return obj;\n                }\n            });\n            selectTab($scope.tabs[0].id);\n            LocalStorageAdapter.set(LSKeys.TABS_STATE, $scope.tabs);\n            $rootScope.$broadcast('deleteAllexeptSelected', $scope.tabs);\n        }\n    }];\n\n    return {\n        restrict: 'AE',\n        // for some reason when you extract this template in a file and use templateUrl it selects all tabs when editing the tab name, not only the currently selected one\n        template: '<a class=\"nav-link\" role=\"tab\" data-toggle=\"tab\" blur=\"submit\" editable-text=\"tab.name\" e-form=\"editCurrentlySelectedOnly\" ng-click=\"selectThisTab($event)\" ng-dblclick=\"editCurrentTab()\" ><span ng-class=\"{\\'text-muted\\': !tab.name}\">{{ tab.name || (\\'sparql.tab.directive.unnamed.tab.title\\' | translate)}}</span><button type=\"button\" ng-click=\"deleteTab($event)\" class=\"btn btn-link btn-sm secondary delete-sparql-tab-btn\" title=\"Delete tab\"><i class=\"icon-close\"></i></button></a>',\n        replace: true,\n        controller: SparqlTabCtrl\n    };\n}\n"],"sourceRoot":""}